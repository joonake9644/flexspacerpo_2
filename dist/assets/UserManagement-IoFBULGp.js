const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-VDPl71_X.js","./react-C1G-q6RG.js","./firebase-CpY9aKCX.js","./icons-DJqNYe3e.js","./index-CYlCz1vV.css"])))=>i.map(i=>d[i]);
import{b as fe,f as Z,_ as h,g as ge}from"./index-VDPl71_X.js";import{r as s,j as e}from"./react-C1G-q6RG.js";import{a as ye,R as je,C as we,E as ve,D as Ne,F as Ce}from"./firebase-CpY9aKCX.js";import{r as _e,p as Se,u as Ee,s as ke,t as Ae,A as De}from"./icons-DJqNYe3e.js";const Fe=({users:ee,setUsers:p})=>{const{users:R,loading:te}=fe(),y=R.length>0?R:ee||[],[ae,E]=s.useState(!1),[k,O]=s.useState(!1),[b,A]=s.useState(null),[j,D]=s.useState(null),[z,K]=s.useState(null),W={name:"",email:"",phone:"",password:"",role:"user"},[r,N]=s.useState(W),[V,q]=s.useState(""),[T,H]=s.useState(""),[P,$]=s.useState(""),[U,B]=s.useState(""),[M,G]=s.useState(null),[f,g]=s.useState(!1),[Ve,J]=s.useState(!1),[C,re]=s.useState(""),[F,se]=s.useState("name"),[I]=s.useState("all"),[c,le]=s.useState({key:"name",direction:"asc"}),u=ye();s.useEffect(()=>{k&&setTimeout(()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new je(u,"recaptcha-container",{size:"invisible",callback:()=>{}}))},100)},[k,u]);const ne=t=>{A(t),N({name:t.name,email:t.email,phone:t.phone||"",password:"",role:t.role}),E(!0)},ie=()=>{A(null),N(W),E(!0)},Q=()=>{E(!1),A(null)},oe=t=>{K(t),q(t.email),$(t.phone||""),H(""),B(""),G(null),O(!0)},X=()=>{O(!1),K(null),window.recaptchaVerifier&&window.recaptchaVerifier.clear()},w=t=>{const{name:a,value:n}=t.target;N(a==="phone"?l=>({...l,[a]:Z(n)}):l=>({...l,[a]:n}))},ce=async t=>{t.preventDefault(),J(!0);try{if(b){if(y.some(d=>d.email===r.email&&d.id!==b.id)){alert("이미 사용 중인 이메일입니다.");return}const{doc:a,updateDoc:n,serverTimestamp:l}=await h(async()=>{const{doc:d,updateDoc:m,serverTimestamp:S}=await import("./firebase-CpY9aKCX.js").then(o=>o.L);return{doc:d,updateDoc:m,serverTimestamp:S}},[],import.meta.url),{db:i}=await h(async()=>{const{db:d}=await import("./index-VDPl71_X.js").then(m=>m.e);return{db:d}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),v={name:r.name,email:r.email,phone:r.phone.replace(/-/g,"")||null,role:r.role,updatedAt:l()};await n(a(i,"users",b.id),v),p&&p(d=>d.map(m=>m.id===b.id?{...m,name:r.name,email:r.email,phone:r.phone.replace(/-/g,""),role:r.role}:m)),alert("사용자 정보가 수정되었습니다.")}else{if(y.some(o=>o.email===r.email)){alert("이미 등록된 이메일입니다.");return}if(!r.password){alert("신규 사용자는 비밀번호가 필요합니다.");return}const{createUserWithEmailAndPassword:a}=await h(async()=>{const{createUserWithEmailAndPassword:o}=await import("./firebase-CpY9aKCX.js").then(x=>x.K);return{createUserWithEmailAndPassword:o}},[],import.meta.url),{doc:n,setDoc:l,serverTimestamp:i}=await h(async()=>{const{doc:o,setDoc:x,serverTimestamp:L}=await import("./firebase-CpY9aKCX.js").then(be=>be.L);return{doc:o,setDoc:x,serverTimestamp:L}},[],import.meta.url),{auth:v,db:d}=await h(async()=>{const{auth:o,db:x}=await import("./index-VDPl71_X.js").then(L=>L.e);return{auth:o,db:x}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),S=(await a(v,r.email,r.password)).user;if(await l(n(d,"users",S.uid),{name:r.name,email:r.email,phone:r.phone.replace(/-/g,"")||null,role:r.role,isActive:!0,createdAt:i(),updatedAt:i()}),p){const o={id:S.uid,name:r.name,email:r.email,phone:r.phone.replace(/-/g,""),role:r.role};p(x=>[...x,o])}alert("새 사용자가 Firebase에 생성되었습니다.")}Q()}catch(a){console.error("User creation/update error:",a);const n=ge(a);alert(n)}finally{J(!1)}},de=t=>{if(t.role==="admin"&&y.filter(a=>a.role==="admin").length<=1){alert("마지막 관리자 계정은 삭제할 수 없습니다.");return}D(t)},me=async()=>{if(j){try{const{deleteDoc:t,doc:a}=await h(async()=>{const{deleteDoc:l,doc:i}=await import("./firebase-CpY9aKCX.js").then(v=>v.L);return{deleteDoc:l,doc:i}},[],import.meta.url),{db:n}=await h(async()=>{const{db:l}=await import("./index-VDPl71_X.js").then(i=>i.e);return{db:l}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);await t(a(n,"users",j.id)),alert("사용자가 삭제되었습니다."),p&&p(l=>l.filter(i=>i.id!==j.id))}catch(t){console.error("사용자 삭제 오류:",t),alert("사용자 삭제에 실패했습니다.")}D(null)}},ue=t=>{let a="asc";c&&c.key===t&&c.direction==="asc"&&(a="desc"),le({key:t,direction:a})},xe=async()=>{if(!P){alert("휴대폰 번호를 입력하세요.");return}g(!0);try{const t=window.recaptchaVerifier,a=await we(u,P,t);G(a),alert("인증 코드를 발송했습니다.")}catch(t){console.error("SMS Error:",t),alert("SMS 인증 코드 요청에 실패했습니다.")}finally{g(!1)}},he=async()=>{if(!U){alert("인증 코드를 입력하세요.");return}if(!M){alert("먼저 인증 코드를 요청하세요.");return}g(!0);try{await M.confirm(U),alert("휴대폰 인증이 완료되었습니다.")}catch(t){console.error("Verification Error:",t),alert("인증 코드가 잘못되었습니다.")}finally{g(!1)}},pe=async()=>{if(!V||!T){alert("새 이메일과 현재 비밀번호를 입력하세요.");return}if(u.currentUser){g(!0);try{const t=ve.credential(u.currentUser.email,T);await Ne(u.currentUser,t),await Ce(u.currentUser,V),alert("이메일 주소가 변경되었습니다. 새 주소로 인증 메일을 확인하세요."),X()}catch(t){console.error("Email Update Error:",t),alert("이메일 변경에 실패했습니다. 비밀번호를 확인하세요.")}finally{g(!1)}}},Y=s.useMemo(()=>{const t=y.filter(a=>I==="all"||a.role===I).filter(a=>{if(!C)return!0;const n=C.toLowerCase();return(a[F]?.toLowerCase()||"").includes(n)});return c!==null&&t.sort((a,n)=>{const l=a[c.key]||"",i=n[c.key]||"";return l<i?c.direction==="asc"?-1:1:l>i?c.direction==="asc"?1:-1:0}),t},[y,C,F,I,c]),_=({columnKey:t,title:a})=>e.jsx("th",{onClick:()=>ue(t),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:a}),c?.key===t&&e.jsx(De,{className:"w-4 h-4 ml-2"})]})});return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{id:"recaptcha-container"}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"회원 관리"}),e.jsx("p",{className:"text-gray-600",children:"사용자 추가, 수정, 삭제"})]}),e.jsxs("button",{onClick:ie,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{children:"새 사용자 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:F,onChange:t=>se(t.target.value),className:"border rounded-lg px-2 py-1 text-sm",children:[e.jsx("option",{value:"name",children:"이름"}),e.jsx("option",{value:"email",children:"이메일"}),e.jsx("option",{value:"phone",children:"전화번호"})]}),e.jsx("input",{value:C,onChange:t=>re(t.target.value),placeholder:"검색어 입력",className:"flex-1 outline-none"})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:te?e.jsxs("div",{className:"flex items-center justify-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"사용자 정보를 불러오는 중..."})]}):Y.length===0?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"등록된 사용자가 없습니다."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"새 사용자 추가 버튼을 클릭해서 사용자를 추가해보세요."})]})}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx(_,{columnKey:"name",title:"이름"}),e.jsx(_,{columnKey:"email",title:"이메일"}),e.jsx(_,{columnKey:"phone",title:"전화번호"}),e.jsx(_,{columnKey:"role",title:"권한"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Y.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.phone}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.role==="admin"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:t.role})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>oe(t),className:"p-2 text-gray-500 hover:text-green-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ne(t),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>de(t),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ae,{className:"w-4 h-4"})})]})]},t.id))})]})}),ae&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:b?"사용자 정보 수정":"새 사용자 추가"}),e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이름"}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:w,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이메일"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:w,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"전화번호"}),e.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:w,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["비밀번호 ",b&&"(변경시에만 입력)"]}),e.jsx("input",{type:"password",name:"password",value:r.password,onChange:w,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"권한"}),e.jsxs("select",{name:"role",value:r.role,onChange:w,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:Q,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:"저장"})]})]})]})}),k&&z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 space-y-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["계정 설정: ",z.name]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"휴대폰 인증"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"tel",value:P,onChange:t=>$(Z(t.target.value)),placeholder:"휴대폰 번호",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:xe,disabled:f,className:"py-3 px-4 bg-gray-200 rounded-xl hover:bg-gray-300 font-medium transition-colors disabled:opacity-50",children:f?"전송중...":"인증코드 받기"})]}),M&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:U,onChange:t=>B(t.target.value),placeholder:"인증 코드 6자리",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:he,disabled:f,className:"py-3 px-4 bg-green-500 text-white rounded-xl hover:bg-green-600 font-medium transition-colors disabled:opacity-50",children:f?"확인중...":"인증하기"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"이메일 주소 변경"}),e.jsx("input",{type:"email",value:V,onChange:t=>q(t.target.value),placeholder:"새 이메일 주소",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("input",{type:"password",value:T,onChange:t=>H(t.target.value),placeholder:"현재 비밀번호",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:pe,disabled:f,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors disabled:opacity-50",children:f?"변경중...":"이메일 변경"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"button",onClick:X,className:"py-3 px-6 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"닫기"})})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"사용자 삭제 확인"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["정말로 ",e.jsx("strong",{className:"text-red-600",children:j.name})," 사용자를 삭제하시겠습니까?"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>D(null),className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{onClick:me,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl hover:bg-red-600 font-medium transition-colors",children:"삭제"})]})]})})]})};export{Fe as default};
