import{r as u,j as e}from"./react-C1G-q6RG.js";import{A as b}from"./firebase-CVBrtIcl.js";import{f as y}from"./firebase-functions-ekMhbLJx.js";import{u as v}from"./index-JKx5WJQm.js";import{p as N,a as w,C as D,q as $,U as C,B as k}from"./icons-DJqNYe3e.js";const S=b(y,"createProgramApplication"),T=["일","월","화","수","목","금","토"],P=t=>{const l=new Date;l.setHours(0,0,0,0);const r=new Date(t.startDate);r.setHours(0,0,0,0);const i=new Date(t.endDate);return i.setHours(0,0,0,0),l>i?{text:"종료",dDay:null}:l>=r&&l<=i?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((r.getTime()-l.getTime())/(1e3*60*60*24))}},g=t=>`${(t.scheduleDays||[]).sort().map(l=>T[l]).join(", ")} ${t.startTime}-${t.endTime}`;u.memo(({p:t,status:l,onApply:r,applying:i,isAlreadyApplied:n,applicationStatus:x})=>e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.title}),l.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",l.dDay]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500 flex-wrap",children:[e.jsxs("span",{children:["강사: ",t.instructor]}),e.jsxs("span",{children:["기간: ",t.startDate," ~ ",t.endDate]}),e.jsxs("span",{children:["일정: ",g(t)]}),e.jsxs("span",{children:["비용: ",t.fee?`${t.fee.toLocaleString()}원`:"무료 / Free"]}),e.jsxs("span",{children:["정원: ",t.enrolled??0," / ",t.capacity]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${l.text==="종료"?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:l.text}),n&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${x==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:x==="approved"?"승인됨":"신청완료"}),l.text!=="종료"&&e.jsx("button",{disabled:i||n,onClick:()=>r(t.id),className:`px-4 py-2 rounded-xl font-medium transition-colors ${n?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:n?"신청완료":i?"신청중...":"신청하기"})]})]})}));const B=({currentUser:t,programs:l,applications:r,setApplications:i})=>{const{showNotification:n}=v(),[x,f]=u.useState(""),[h,p]=u.useState(null),m=u.useMemo(()=>l.filter(s=>s.title.toLowerCase().includes(x.toLowerCase())),[l,x]),j=u.useCallback(async s=>{const d=r.find(a=>a.programId===s&&a.userId===t.id&&(a.status==="pending"||a.status==="approved"));if(d){const a=d.status==="pending"?"대기중":"승인됨";n(`이미 이 프로그램에 신청하셨습니다. (현재 상태: ${a})`,"warning");return}p(s);try{const a=await S({programId:s});if(a?.data?.success){n("프로그램 신청이 완료되었습니다. 관리자 승인을 기다려주세요.","success");const o={id:a.data.applicationId,userId:t.id,programId:s,status:"pending",appliedAt:new Date,userName:t.name,userEmail:t.email,programTitle:l.find(c=>c.id===s)?.title||"Unknown Program"};i(c=>[o,...c])}else{const o=a?.data?.message||"신청에 실패했습니다. 잠시 후 다시 시도해주세요.";n(o,"error")}}catch(a){n(`신청 실패: ${a?.message||"네트워크 오류가 발생했습니다. 잠시 후 다시 시도해주세요."}`,"error")}finally{p(null)}},[n,t,l,i,r]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"프로그램"}),e.jsx("p",{className:"text-gray-600",children:"다양한 체육 프로그램에 참여해보세요"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"검색"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{value:x,onChange:s=>f(s.target.value),placeholder:"프로그램명, 강사명...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"종목"}),e.jsx("option",{value:"yoga",children:"요가"}),e.jsx("option",{value:"pilates",children:"필라테스"}),e.jsx("option",{value:"fitness",children:"피트니스"}),e.jsx("option",{value:"dance",children:"댄스"}),e.jsx("option",{value:"badminton",children:"배드민턴"}),e.jsx("option",{value:"pickleball",children:"피클볼"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"요일"}),e.jsx("option",{value:"월",children:"월요일"}),e.jsx("option",{value:"화",children:"화요일"}),e.jsx("option",{value:"수",children:"수요일"}),e.jsx("option",{value:"목",children:"목요일"}),e.jsx("option",{value:"금",children:"금요일"}),e.jsx("option",{value:"토",children:"토요일"}),e.jsx("option",{value:"일",children:"일요일"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"시간대"}),e.jsx("option",{value:"morning",children:"오전 (06:00-12:00)"}),e.jsx("option",{value:"afternoon",children:"오후 (12:00-18:00)"}),e.jsx("option",{value:"evening",children:"저녁 (18:00-22:00)"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"레벨"}),e.jsx("option",{value:"beginner",children:"초급"}),e.jsx("option",{value:"intermediate",children:"중급"}),e.jsx("option",{value:"advanced",children:"고급"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["진행중인 프로그램 (",m.length,"개)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-purple-600 bg-purple-50 rounded-lg",children:"필라테스"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg",children:"진행 중"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-green-600 bg-green-50 rounded-lg",children:"초급"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:m.map(s=>{const d=P(s),a=r.find(c=>c.programId===s.id&&c.userId===t.id&&(c.status==="pending"||c.status==="approved")),o=!!a;return e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.title}),d.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",d.dDay]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:s.description})]}),e.jsxs("div",{className:"ml-4 flex flex-col gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${d.text==="종료"?"bg-gray-100 text-gray-800":d.text==="진행중"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:d.text}),o&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a?.status==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:a?.status==="approved"?"승인됨":"신청완료"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsxs("span",{children:["강사: ",s.instructor]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsxs("span",{children:["기간: ",s.startDate," ~ ",s.endDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),e.jsxs("span",{children:["일정: ",g(s)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsxs("span",{children:["정원: ",s.enrolled??0," / ",s.capacity,"명"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:s.fee?`${s.fee.toLocaleString()}원`:"무료"}),d.text!=="종료"&&e.jsx("button",{disabled:h===s.id||o,onClick:()=>j(s.id),className:`px-6 py-2 rounded-xl font-medium transition-colors ${o?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50"}`,children:o?"신청완료":h===s.id?"신청중...":"신청하기"})]})]})},s.id)})}),m.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"검색 결과가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"다른 조건으로 검색해보세요."})]})]})};export{B as default};
