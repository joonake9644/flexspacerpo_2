const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DashboardCalendar-uDP7ybYC.js","./react-C1G-q6RG.js","./icons-C64KHKSF.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,R as wt,a as vt}from"./react-C1G-q6RG.js";import{g as Qe,i as Nt,a as ut,b as Dt,c as Ct,d as kt,e as St,f as Et,h as Tt,j as At,k as Pt,l as Mt,o as $t,s as Ze,m as Ie,n as ie,p as Oe,q as Ee,r as _t,u as Je,t as ve,v as oe,G as It,w as Ot,x as Te,y as Ne,z as Be,A as He,B as Rt,C as Ge,R as Ft,D as Lt,E as Vt,F as Bt,H as Ht,I as zt,J as qt,K as Gt}from"./firebase-DnP1Uaxu.js";import{U as ce,a as Kt,M as qe,P as Wt,L as ze,H as Ue,C as ae,B as xe,S as et,b as tt,X as xt,c as Yt,d as Xt,e as fe,f as Qt,g as Zt,h as Jt,i as Ut,j as es,k as ts,l as ht,m as Ke,T as We,n as Ye,o as ss,A as rs,I as as,p as ls,q as ns,r as os}from"./icons-C64KHKSF.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))x(m);new MutationObserver(m=>{for(const u of m)if(u.type==="childList")for(const n of u.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&x(n)}).observe(document,{childList:!0,subtree:!0});function d(m){const u={};return m.integrity&&(u.integrity=m.integrity),m.referrerPolicy&&(u.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?u.credentials="include":m.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function x(m){if(m.ep)return;m.ep=!0;const u=d(m);fetch(m.href,u)}})();const Ae={};console.log("Firebase Config Debug:",{hasApiKey:!0,hasAuthDomain:!0,hasProjectId:!0,NODE_ENV:"production"});const is={apiKey:"AIzaSyBvlPy3BOyrRCokGAHkzuX6IoVZNjWTU-0",authDomain:"flexspaceprowin.firebaseapp.com",projectId:"flexspaceprowin",storageBucket:"flexspaceprowin.firebasestorage.app",messagingSenderId:"545144229496",appId:"1:545144229496:web:a833b961cf4b8a7ce9678d",measurementId:"G-D81Q76VKZQ"};let Ce;try{Ce=Qe().length?Qe()[0]:Nt(is),console.log("Firebase initialized successfully")}catch(t){throw console.error("Firebase initialization failed:",t),t}const W=ut(Ce),U=Dt(Ce),gt=Ct(Ce),Pe=kt(Ce),cs=Ae?.VITE_USE_EMULATOR==="true";if(cs){const t=Ae?.VITE_EMULATOR_HOST||"127.0.0.1",r=Number(Ae?.VITE_EMULATOR_AUTH_PORT||9099),d=Number(Ae?.VITE_EMULATOR_FIRESTORE_PORT||8080),x=Number(Ae?.VITE_EMULATOR_STORAGE_PORT||9199);try{St(W,`http://${t}:${r}`,{disableWarnings:!0})}catch{}try{Et(U,t,d)}catch{}try{Tt(gt,t,x)}catch{}try{At(Pe,t,5001)}catch{}}Pt().then(t=>t?Mt(Ce):null).catch(()=>null);const ue=Object.freeze(Object.defineProperty({__proto__:null,auth:W,db:U,functions:Pe,storage:gt},Symbol.toStringTag,{value:"Module"})),ds=()=>{const[t,r]=o.useState(null),[d,x]=o.useState(!1),[m,u]=o.useState(!0);o.useEffect(()=>{u(!0);const h=$t(W,async a=>{try{if(!a){r(null),x(!1);return}x(a.emailVerified);const l=ie(U,"users",a.uid),c=await Ie(l);let w="user",C=a.displayName||(a.email?.split("@")[0]??"user"),I;if(c.exists()){const E=c.data();w=E.role||"user",C=E.name||C,I=E.phone}else{const E={name:C,email:a.email??"",phone:null,role:"user",isActive:!0,createdAt:oe(),updatedAt:oe()};await ve(l,E),console.log("새 사용자 정보를 users 컬렉션에 추가:",a.uid)}r({id:a.uid,name:C,email:a.email??"",phone:I,role:w})}catch(l){console.error("Auth state change error:",l),a&&r({id:a.uid,name:a.email?.split("@")[0]??"user",email:a.email??"",role:"user"})}finally{u(!1)}});return()=>h()},[]);const n=o.useCallback(async(h,a)=>{try{const l=await Ze(W,h,a),c=await Ie(ie(U,"users",l.user.uid)),C=(c.exists()?c.data():null)?.adminCreated===!0,I=h==="admin@flexspace.test"||h==="flexadmin@test.com"||h==="joonake@naver.com"||h==="uu@naver.com"||h==="kan@naver.com"||h==="kun6@naver.com"||h==="testuser964419@gmail.com";if(!l.user.emailVerified&&!C&&!I){try{await Oe(l.user,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(E){console.warn("이메일 인증 재전송 실패:",E)}throw await Ee(W),new Error("이메일 인증이 필요합니다. 새로운 인증 메일을 발송했습니다. 이메일함을 확인해주세요.")}return!0}catch(l){throw console.error("Login error:",l),l}},[]),p=o.useCallback(async(h,a)=>{try{const l=await Ze(W,h,a);if(!(h==="admin@flexspace.test"||h==="flexadmin@test.com"||h==="joonake@naver.com"||h==="uu@naver.com"||h==="kan@naver.com"||h==="kun6@naver.com"||h==="testuser964419@gmail.com")&&!l.user.emailVerified){try{await Oe(l.user,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(G){console.warn("관리자 이메일 인증 재전송 실패:",G)}throw await Ee(W),new Error("이메일 인증이 필요합니다. 새로운 인증 메일을 발송했습니다. 이메일함을 확인해주세요.")}const w=ie(U,"users",l.user.uid),C=await Ie(w),I=C.exists()?C.data():{},E=I.role;if(console.log("Admin login - User data:",{uid:l.user.uid,email:l.user.email,firestoreExists:C.exists(),role:E,allData:I}),E!=="admin")throw await Ee(W),new Error(`관리자 권한이 없습니다. 현재 권한: ${E||"없음"}`);return!0}catch(l){throw console.error("Admin login error:",l),l}},[]),D=o.useCallback(async h=>{try{const{name:a,email:l,phone:c,password:w}=h;if(!l||!w)throw new Error("이메일과 비밀번호가 필요합니다.");if(w.length<6)throw new Error("비밀번호는 6자 이상이어야 합니다.");const C=await _t(W,l,w);await Je(C.user,{displayName:a||l.split("@")[0]});const I=ie(U,"users",C.user.uid);await ve(I,{name:a||(l.split("@")[0]??"user"),email:l,phone:c||null,role:"user",isActive:!0,createdAt:oe(),updatedAt:oe()},{merge:!0});try{await Oe(C.user,{url:`${window.location.origin}/`,handleCodeInApp:!1}),console.log("이메일 인증 메일 전송 성공:",l)}catch(E){console.warn("이메일 인증 메일 전송 실패:",E)}return await Ee(W),!0}catch(a){throw console.error("Signup error:",a),a}},[]),b=o.useCallback(async()=>{try{const h=new It;h.addScope("email"),h.addScope("profile"),h.setCustomParameters({prompt:"select_account"});const l=(await Ot(W,h)).user;if(console.log("Google login success:",{uid:l.uid,email:l.email,displayName:l.displayName,emailVerified:l.emailVerified}),!l.email)throw new Error("Google 계정에서 이메일 정보를 가져올 수 없습니다.");const c=ie(U,"users",l.uid);let w={name:l.displayName||l.email.split("@")[0]||"user",email:l.email,phone:l.phoneNumber||null,role:"user",isActive:!0,updatedAt:oe()};try{(await Ie(c)).exists()?(await ve(c,w,{merge:!0}),console.log("Google 로그인: 기존 사용자 정보 업데이트됨:",l.uid)):(await ve(c,{...w,createdAt:oe()}),console.log("Google 로그인: 새 사용자 정보 저장됨:",l.uid))}catch(C){console.warn("Firestore 저장 실패, 하지만 로그인은 계속 진행:",C)}return!0}catch(h){throw console.error("Google login error:",h),h.code==="auth/popup-closed-by-user"||h.code==="auth/cancelled-popup-request"?new Error("Google 로그인이 취소되었습니다."):h.code==="auth/popup-blocked"?new Error("팝업이 차단되었습니다. 브라우저 설정에서 팝업을 허용해주세요."):h.code==="auth/network-request-failed"?new Error("네트워크 연결을 확인해주세요."):new Error(`Google 로그인 실패: ${h.message||"알 수 없는 오류"}`)}},[]),N=o.useCallback(async()=>{if(W.currentUser)return await Oe(W.currentUser),!0;throw new Error("로그인이 필요합니다.")},[]),y=o.useCallback(async(h,a)=>{if(W.currentUser){await Je(W.currentUser,{displayName:h,photoURL:a});const l=ie(U,"users",W.currentUser.uid);return await ve(l,{name:h||W.currentUser.displayName,updatedAt:oe()},{merge:!0}),!0}throw new Error("로그인이 필요합니다.")},[]),g=o.useCallback(async()=>{await Ee(W),r(null),x(!1)},[]);return o.useMemo(()=>({user:t,login:n,logout:g,signup:D,adminLogin:p,googleLogin:b,sendVerificationEmail:N,updateUserProfile:y,emailVerified:d,loading:m}),[t,n,g,D,p,b,N,y,d,m])},Me=()=>{const[t,r]=o.useState(!0),[d,x]=o.useState(!1),[m,u]=o.useState(null),n=o.useRef(null),p=o.useRef(null),D=o.useRef({}),[b,N]=o.useState([]),[y,g]=o.useState([]),[h,a]=o.useState([]),[l,c]=o.useState([]),[w,C]=o.useState([]),I=o.useCallback(()=>{x(!0),u(null),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{x(!1)},800)},[]),E=o.useCallback((P,X)=>{console.error(`Connection error for ${P}:`,X);const B=3,K=D.current[P]||0;if(K<B){D.current[P]=K+1,u(`${P} 연결 재시도 중... (${K+1}/${B})`);const T=Math.pow(2,K)*1e3;p.current=setTimeout(()=>{console.log(`Retrying connection for ${P} in ${T}ms`)},T)}else u(`${P} 연결 실패: 최대 재시도 횟수 초과`)},[]),G=o.useCallback(P=>{D.current[P]&&(console.log(`Connection restored for ${P}`),D.current[P]=0)},[]);return o.useEffect(()=>{const P=[];let X=0;const B=5,K=()=>{X++,X>=B&&(r(!1),console.log("모든 Firestore 컬렉션 초기 로딩 완료"))},T=(s,f,j)=>({onNext:S=>{G(s);const L=S.docs.map(M=>({id:M.id,...M.data()}));f(M=>{M.length>0&&I();const z=j?j(L):L;return console.log(`${s} 데이터 업데이트:`,{previousCount:M.length,newCount:z.length,hasChanges:M.length!==z.length}),z}),K()},onError:S=>{E(s,S),K()}}),F=T("users",c);P.push(Te(Ne(U,"users"),F.onNext,F.onError));const H=T("bookings",N,s=>s.filter((j,S,L)=>S===L.findIndex(M=>M.id===j.id)).sort((j,S)=>{const L=j.createdAt?.toDate?.()||new Date(0);return(S.createdAt?.toDate?.()||new Date(0)).getTime()-L.getTime()}));P.push(Te(Be(Ne(U,"bookings"),He("createdAt","desc")),H.onNext,H.onError));const i=T("programs",g);P.push(Te(Be(Ne(U,"programs"),He("startDate","asc")),i.onNext,i.onError));const A=T("applications",a,s=>s.sort((f,j)=>{const S=f.appliedAt?.toDate?.()||new Date(0);return(j.appliedAt?.toDate?.()||new Date(0)).getTime()-S.getTime()}));P.push(Te(Be(Ne(U,"program_applications"),He("appliedAt","desc")),A.onNext,A.onError));const k=T("facilities",C);return P.push(Te(Ne(U,"facilities"),k.onNext,k.onError)),()=>{console.log("Firestore 구독 정리 중..."),P.forEach(s=>s()),n.current&&clearTimeout(n.current),p.current&&clearTimeout(p.current),D.current={}}},[]),o.useMemo(()=>({loading:t,syncing:d,connectionError:m,bookings:b,setBookings:N,programs:y,setPrograms:g,applications:h,setApplications:a,users:l,setUsers:c,facilities:w,isDataReady:!t&&!m,hasActiveError:!!m,debugInfo:{loadedCollections:{users:l.length,bookings:b.length,programs:y.length,applications:h.length,facilities:w.length},retryStatus:D.current}}),[t,d,m,b,y,h,l,w])},st=t=>{const r=t.replace(/\D/g,"");return r.length<=3?r:r.length<=7?`${r.slice(0,3)}-${r.slice(3)}`:`${r.slice(0,3)}-${r.slice(3,7)}-${r.slice(7,11)}`},rt=t=>({"auth/user-not-found":"미가입자입니다. 회원가입을 해주세요.","auth/wrong-password":"비밀번호가 일치하지 않습니다.","auth/email-already-in-use":"이미 사용 중인 이메일입니다.","auth/weak-password":"비밀번호가 너무 간단합니다. 6자 이상 입력해주세요.","auth/invalid-email":"올바른 이메일 형식이 아닙니다.","auth/invalid-credential":"이메일 또는 비밀번호가 잘못되었습니다. 미가입자는 회원가입을 먼저 해주세요.","auth/invalid-login-credentials":"로그인 정보가 잘못되었습니다. 미가입자는 회원가입을 먼저 해주세요.","auth/too-many-requests":"로그인 시도가 너무 많습니다. 잠시 후 다시 시도하거나 브라우저 캐시를 삭제해 주세요.","firestore/permission-denied":"접근 권한이 없습니다.","firestore/unavailable":"서비스가 일시적으로 사용 불가합니다.","firestore/deadline-exceeded":"요청 시간이 초과되었습니다.","storage/unauthorized":"파일 업로드 권한이 없습니다.","storage/object-not-found":"파일을 찾을 수 없습니다.","storage/quota-exceeded":"저장소 용량이 초과되었습니다.","functions/permission-denied":"함수 실행 권한이 없습니다.","functions/unavailable":"서버 함수가 일시적으로 사용 불가합니다."})[t]||"로그인에 실패했습니다. 이메일/비밀번호를 확인하거나 회원가입을 먼저 진행해주세요.",De=t=>{const r=t instanceof Error?t.message:String(t),d=r.match(/auth\/([\w-]+)/);return d&&d[0]?rt(d[0]):rt(r)},pt=o.createContext(void 0),ms=({children:t})=>{const[r,d]=o.useState([]),x=o.useCallback(u=>{d(n=>n.filter(p=>p.id!==u))},[]),m=o.useCallback((u,n="info",p=5e3)=>{const D=Date.now();window.lastNotifications||(window.lastNotifications={});const b=window.lastNotifications[u]||0;if(D-b<1e3){console.log("중복 알림 차단:",u);return}window.lastNotifications[u]=D;const N=`notification-${D}-${Math.random()}`,y={id:N,message:u,type:n,duration:p};d(g=>n==="success"||n==="error"?[y]:[...g.slice(-2),y]),p>0&&setTimeout(()=>{x(N)},p)},[x]);return e.jsx(pt.Provider,{value:{notifications:r,showNotification:m,removeNotification:x},children:t})},$e=()=>{const t=o.useContext(pt);if(t===void 0)throw new Error("useNotification must be used within a NotificationProvider");return t},us=({email:t,setEmail:r,onSendLink:d,onCancel:x,submitting:m})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"forgot-password-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{id:"forgot-password-title",className:"text-xl font-bold text-gray-900 mb-2",children:"비밀번호 재설정 / Password Reset"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"가입 시 사용한 이메일 주소를 입력하세요. 재설정 링크를 보내드립니다."}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email","aria-label":"Email for password reset",value:t,onChange:u=>r(u.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:x,className:"flex-1 py-3 px-4 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all font-medium",children:"취소"}),e.jsx("button",{onClick:d,disabled:m,className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl border-2 border-transparent hover:bg-blue-600 hover:border-blue-700 transition-all font-medium",children:m?"전송 중...":"재설정 링크 보내기"})]})]})}),xs=({onConfirm:t,onCancel:r,errorText:d})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"agreement-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-2xl w-full mx-4",children:[e.jsx("h3",{id:"agreement-title",className:"text-xl font-bold text-gray-900 mb-4",children:"개인정보 수집 및 이용 동의"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"FlexSpace Pro 서비스 제공을 위해 아래와 같이 개인정보를 수집 및 이용합니다."}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"구분"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"수집 항목"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"수집 및 이용 목적"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"보유 및 이용 기간"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:"필수"}),e.jsx("td",{className:"px-4 py-3",children:"이름, 이메일"}),e.jsx("td",{className:"px-4 py-3",children:"회원 식별 및 관리, 서비스 제공 및 공지사항 전달"}),e.jsx("td",{className:"px-4 py-3",children:"회원 탈퇴 시까지"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:"선택"}),e.jsx("td",{className:"px-4 py-3",children:"전화번호"}),e.jsx("td",{className:"px-4 py-3",children:"체육관 대관 시 긴급 연락 및 알림"}),e.jsx("td",{className:"px-4 py-3",children:"회원 탈퇴 시까지"})]})]})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"※ 선택 항목을 동의하지 않아도 회원가입 및 기본 서비스 이용이 가능합니다. 단, 해당 정보가 필요한 일부 서비스(예: 대관 알림) 이용에 제한이 있을 수 있습니다."}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 font-medium",children:"필수 항목에 동의하지 않으면 회원가입이 제한됩니다."}),d&&e.jsx("p",{className:"text-sm text-red-600 mt-4 text-right",children:d}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-xl border",children:"취소"}),e.jsx("button",{onClick:t,className:"px-4 py-2 rounded-xl bg-blue-600 text-white",children:"동의하고 계속하기"})]})]})}),hs=({onLogin:t,onSignup:r,onAdminLogin:d,onGoogleLogin:x})=>{const{showNotification:m}=$e(),[u,n]=o.useState("login"),[p,D]=o.useState(""),[b,N]=o.useState(""),[y,g]=o.useState(""),[h,a]=o.useState(""),[l,c]=o.useState(""),[w,C]=o.useState(!1),[I,E]=o.useState(!1),[G,P]=o.useState(""),[X,B]=o.useState(!1),[K,T]=o.useState(""),F=async()=>{if(!G){m("이메일을 입력해주세요.","error");return}B(!0);try{await Rt(W,G),m("비밀번호 재설정 이메일을 보냈습니다. 이메일 함을 확인해주세요.","success"),E(!1)}catch(k){const s=De(k);m(s,"error")}finally{B(!1)}},H=async()=>{const k=l.replace(/-/g,"");B(!0),T("");try{const[s,f]=await r({name:p,email:b,password:y,phone:k});s?(C(!1),m(f||"회원가입이 완료되었습니다. 이메일 인증을 확인해주세요.","success"),n("login"),g(""),a("")):T(f||"회원가입에 실패했습니다. 입력 정보를 확인해주세요.")}finally{B(!1)}},i=async k=>{if(k.preventDefault(),u==="signup"){if(!p.trim()){m("이름을 입력해주세요.","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b)){m("유효하지 않은 이메일 형식입니다.","error");return}if(y.length<6){m("비밀번호는 6자 이상이어야 합니다.","error");return}if(y!==h){m("비밀번호가 일치하지 않습니다.","error");return}}if(u!=="signup"){if(!b.trim()){m("이메일을 입력해주세요.","error");return}if(!y.trim()){m("비밀번호를 입력해주세요.","error");return}}B(!0);try{if(u==="login"){const[s,f]=await t(b,y);s?m("로그인에 성공했습니다.","success"):(m(f||"로그인에 실패했습니다. 이메일/비밀번호를 확인해주세요.","error"),f&&(f.includes("미가입자")||f.includes("회원가입을 먼저"))&&setTimeout(()=>{n("signup"),m("회원가입 페이지로 이동합니다.","info")},2e3))}else if(u==="admin_login"){const[s,f]=await d(b,y);s?m("관리자로 로그인되었습니다.","success"):m(f||"관리자 로그인에 실패했습니다. 자격을 확인해주세요.","error")}else C(!0)}finally{B(!1)}},A=k=>{const s=k.replace(/[^0-9]/g,"");return s.length<=3?s:s.length<=7?`${s.slice(0,3)}-${s.slice(3)}`:`${s.slice(0,3)}-${s.slice(3,7)}-${s.slice(7,11)}`};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-gray-50 to-purple-50 p-4 animate-fade-in",children:[e.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-lg border border-gray-100 p-8 animate-slide-up",children:[e.jsxs("div",{className:"flex items-center mb-6 animate-fade-in-delay",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center mr-2 shadow-md animate-bounce-in",children:e.jsx(ce,{className:"w-6 h-6 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"FlexSpace Pro"})]}),e.jsxs("div",{className:"flex gap-2 mb-6 animate-fade-in-delay",children:[e.jsx("button",{type:"button",onClick:()=>n("login"),className:`flex-1 py-2 rounded-xl border transition-all duration-300 ${u==="login"?"bg-blue-50 text-blue-700 border-blue-200 shadow-sm":"bg-white hover:bg-gray-50"}`,children:"로그인"}),e.jsx("button",{type:"button",onClick:()=>n("signup"),className:`flex-1 py-2 rounded-xl border transition-all duration-300 ${u==="signup"?"bg-purple-50 text-purple-700 border-purple-200 shadow-sm":"bg-white hover:bg-gray-50"}`,children:"회원가입"}),e.jsx("button",{type:"button",onClick:()=>n("admin_login"),className:`flex-1 py-2 rounded-xl border transition-all duration-300 ${u==="admin_login"?"bg-green-50 text-green-700 border-green-200 shadow-sm":"bg-white hover:bg-gray-50"}`,children:"관리자"})]}),e.jsxs("form",{onSubmit:i,className:"animate-fade-in-delay",style:{animationDelay:"0.4s"},children:[u==="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Kt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 / Name",value:p,onChange:k=>D(k.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email",value:b,onChange:k=>N(k.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Wt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"tel",placeholder:"전화번호 (선택) / Phone (Optional)",value:l,onChange:k=>c(A(k.target.value)),maxLength:13,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(ze,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 / Password",value:y,onChange:k=>g(k.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(ze,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 확인 / Confirm Password",value:h,onChange:k=>a(k.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]})]}),u!=="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email",value:b,onChange:k=>N(k.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(ze,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 / Password",value:y,onChange:k=>g(k.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),u==="login"&&e.jsx("div",{className:"text-right mb-4",children:e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>{E(!0),P(b)},children:"비밀번호 재설정"})})]}),e.jsxs("button",{type:"submit",disabled:X,className:"w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl border-2 border-transparent hover:from-blue-600 hover:to-blue-700 hover:shadow-lg transition-all duration-300 font-semibold transform hover:scale-[1.02]",children:[u==="login"&&"로그인 / Login",u==="signup"&&"회원가입 / Sign Up",u==="admin_login"&&"관리자 로그인 / Admin Login"]})]}),u!=="admin_login"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-6 flex items-center animate-fade-in-delay",style:{animationDelay:"0.5s"},children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"px-4 text-sm text-gray-500",children:"또는"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsxs("button",{type:"button",onClick:async()=>{B(!0);try{const[k,s]=await x();k?m("Google 로그인에 성공했습니다.","success"):m(s||"Google 로그인에 실패했습니다.","error")}finally{B(!1)}},disabled:X,className:"w-full py-3 px-4 border border-gray-300 rounded-xl hover:bg-gray-50 hover:shadow-md transition-all duration-300 font-medium flex items-center justify-center gap-3 transform hover:scale-[1.02] animate-fade-in-delay",style:{animationDelay:"0.6s"},children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Google로 ",u==="login"?"로그인":"가입하기"]})]})]}),w&&e.jsx(xs,{onConfirm:H,onCancel:()=>C(!1),errorText:K}),I&&e.jsx(us,{email:G,setEmail:P,onSendLink:F,onCancel:()=>E(!1),submitting:X})]})},gs=({currentUser:t,activeTab:r,setActiveTab:d,onLogout:x})=>{const[m,u]=o.useState(!1),[n,p]=o.useState(!1),D=o.useRef(null),b="flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-200",N={dashboard:"bg-blue-50 text-blue-600 font-semibold",booking:"bg-blue-50 text-blue-600 font-semibold",program:"bg-purple-50 text-purple-600 font-semibold",admin:"bg-green-50 text-green-600 font-semibold",userManagement:"bg-yellow-50 text-yellow-700 font-semibold",facilities:"bg-indigo-50 text-indigo-600 font-semibold"},y="text-gray-600 hover:bg-gray-100 hover:text-gray-900 hover:-translate-y-px";o.useEffect(()=>{const h=a=>{D.current&&!D.current.contains(a.target)&&u(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]);const g=h=>{d(h),p(!1)};return e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-0 z-40",children:[e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:"FlexSpace Pro"})]}),e.jsxs("nav",{className:"hidden md:flex space-x-2",children:[e.jsxs("button",{onClick:()=>g("dashboard"),className:`${b} ${r==="dashboard"?N.dashboard:y}`,children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{children:"대시보드 / Dashboard"})]}),e.jsxs("button",{onClick:()=>g("booking"),className:`${b} ${r==="booking"?N.booking:y}`,children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"체육관 대관 / Booking"})]}),e.jsxs("button",{onClick:()=>g("program"),className:`${b} ${r==="program"?N.program:y}`,children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{children:"프로그램 / Program"})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>g("admin"),className:`${b} ${r==="admin"?N.admin:y}`,children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"운영 관리 / Operations"})]}),e.jsxs("button",{onClick:()=>g("facilities"),className:`${b} ${r==="facilities"?N.facilities:y}`,children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{children:"시설 관리 / Facilities"})]}),e.jsxs("button",{onClick:()=>g("userManagement"),className:`${b} ${r==="userManagement"?N.userManagement:y}`,children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:"회원 관리 / Users"})]})]})]}),e.jsx("button",{onClick:()=>p(!n),className:"md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors",children:n?e.jsx(xt,{className:"w-5 h-5"}):e.jsx(Yt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",ref:D,children:[e.jsxs("button",{onClick:()=>u(!m),className:"flex items-center space-x-2 cursor-pointer p-2 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("span",{className:"text-sm text-gray-600 font-medium hidden sm:block",children:[t.name," (",t.role==="admin"?"관리자":"사용자",")"]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600",children:t.name.charAt(0).toUpperCase()})]}),m&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 origin-top-right animate-on-load z-50",style:{animationName:"fadeInUp",animationDuration:"0.2s"},children:e.jsxs("div",{className:"py-1",role:"menu","aria-orientation":"vertical","aria-labelledby":"options-menu",children:[e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-700 border-b",children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.email})]}),e.jsx("div",{className:"py-1",children:e.jsxs("button",{onClick:x,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",role:"menuitem",children:[e.jsx(Xt,{className:"w-4 h-4 mr-2"}),"로그아웃 / Logout"]})})]})})]})]}),n&&e.jsx("div",{className:"md:hidden bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-2 space-y-1",children:[e.jsxs("button",{onClick:()=>g("dashboard"),className:`w-full text-left ${b} ${r==="dashboard"?N.dashboard:y}`,children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{children:"대시보드 / Dashboard"})]}),e.jsxs("button",{onClick:()=>g("booking"),className:`w-full text-left ${b} ${r==="booking"?N.booking:y}`,children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"체육관 대관 / Booking"})]}),e.jsxs("button",{onClick:()=>g("program"),className:`w-full text-left ${b} ${r==="program"?N.program:y}`,children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{children:"프로그램 / Program"})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>g("admin"),className:`w-full text-left ${b} ${r==="admin"?N.admin:y}`,children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"운영 관리 / Operations"})]}),e.jsxs("button",{onClick:()=>g("facilities"),className:`w-full text-left ${b} ${r==="facilities"?N.facilities:y}`,children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{children:"시설 관리 / Facilities"})]}),e.jsxs("button",{onClick:()=>g("userManagement"),className:`w-full text-left ${b} ${r==="userManagement"?N.userManagement:y}`,children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:"회원 관리 / Users"})]})]})]})})]})},ps="modulepreload",bs=function(t,r){return new URL(t,r).href},at={},Y=function(r,d,x){let m=Promise.resolve();if(d&&d.length>0){let b=function(N){return Promise.all(N.map(y=>Promise.resolve(y).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};const n=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),D=p?.nonce||p?.getAttribute("nonce");m=b(d.map(N=>{if(N=bs(N,x),N in at)return;at[N]=!0;const y=N.endsWith(".css"),g=y?'[rel="stylesheet"]':"";if(!!x)for(let l=n.length-1;l>=0;l--){const c=n[l];if(c.href===N&&(!y||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${N}"]${g}`))return;const a=document.createElement("link");if(a.rel=y?"stylesheet":ps,y||(a.as="script"),a.crossOrigin="",a.href=N,D&&a.setAttribute("nonce",D),document.head.appendChild(a),y)return new Promise((l,c)=>{a.addEventListener("load",l),a.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${N}`)))})}))}function u(n){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=n,window.dispatchEvent(p),!p.defaultPrevented)throw n}return m.then(n=>{for(const p of n||[])p.status==="rejected"&&u(p.reason);return r().catch(u)})},fs=o.lazy(()=>Y(()=>import("./DashboardCalendar-uDP7ybYC.js"),__vite__mapDeps([0,1,2]),import.meta.url)),ys=t=>{const r=new Date;r.setHours(0,0,0,0);const d=new Date(t.startDate);d.setHours(0,0,0,0);const x=new Date(t.endDate);return x.setHours(0,0,0,0),r>x?{text:"종료",dDay:null}:r>=d&&r<=x?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((d.getTime()-r.getTime())/(1e3*60*60*24))}},lt=({status:t})=>{const r={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"},cancelled:{text:"취소됨 / Cancelled",color:"bg-gray-100 text-gray-800"}},{text:d,color:x}=r[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${x}`,children:d})},bt=["일","월","화","수","목","금","토"],js=t=>{const{startDate:r,endDate:d,recurrenceRule:x}=t;if(r===d)return r;let m="";return x&&x.days.length>0&&(m=` (매주 / Every ${x.days.sort().map(u=>bt[u]).join(", ")})`),`${r} ~ ${d}${m}`},ws=t=>`${t.scheduleDays.sort().map(d=>bt[d]).join(",")} ${t.startTime}-${t.endTime}`,nt=({currentUser:t,bookings:r=[],applications:d=[],programs:x=[],setActiveTab:m,syncing:u=!1})=>{const{users:n}=Me(),p=o.useMemo(()=>{const a=new Date;a.setHours(0,0,0,0);const l=a.toISOString().split("T")[0];return r.filter(c=>!(c.status==="completed"||c.status==="cancelled"||c.status==="approved"&&c.endDate<l))},[r]),D=o.useMemo(()=>p.filter(a=>a.userId===t.id).sort((a,l)=>new Date(l.startDate).getTime()-new Date(a.startDate).getTime()),[p,t.id]),b=o.useMemo(()=>d.filter(a=>a.userId===t.id).sort((a,l)=>{const c=a.appliedAt?.toDate?a.appliedAt.toDate():new Date(a.appliedAt||0);return(l.appliedAt?.toDate?l.appliedAt.toDate():new Date(l.appliedAt||0)).getTime()-c.getTime()}),[d,t.id]),N=o.useMemo(()=>p.filter(a=>a.status==="pending"),[p]),y=o.useMemo(()=>d.filter(a=>a.status==="pending"),[d]),[g,h]=o.useState("month");return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:t.role==="admin"?"관리자 대시보드 / Admin Dashboard":"마이 대시보드 / My Dashboard"}),e.jsx("p",{className:"text-gray-600",children:t.role==="admin"?"체육관 운영 현황을 한눈에 확인하세요 / Check gym operational status at a glance":"나의 예약과 프로그램 신청 현황입니다 / View your booking and program application status"})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"동기화 중..."})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:t.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"대기중인 대관 / Pending Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:N.length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(ae,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"대기중인 프로그램 신청 / Pending Applications"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:y.length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center",children:e.jsx(fe,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"운영중인 프로그램 / Active Programs"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:x.filter(a=>{const l=new Date;return new Date(a.endDate)>=l}).length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(xe,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"총 이용자 수 / Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:n.length})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6 text-blue-600"})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"나의 대관 / My Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:D.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"나의 프로그램 신청 / My Applications"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:b.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"운영중인 프로그램 / Active Programs"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:x.length})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"최근 대관 신청 / Recent Bookings"}),e.jsxs("div",{className:"space-y-4",children:[(t.role==="admin"?p.slice(0,3):D.slice(0,3)).map(a=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100 border-l-4 border-blue-500",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.purpose}),e.jsx(lt,{status:a.status})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),a.organization&&`${a.organization} | `,js(a)," ",a.startTime,"-",a.endTime]}),t.role==="admin"&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"신청자: ",a.userName," (",a.userEmail,")"]}),e.jsxs("p",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(xe,{className:"w-4 h-4"}),a.category==="class"?"수업":a.category==="event"?"행사":a.category==="personal"?"개인":"동아리"," | ",a.numberOfParticipants,"명"]})]})]})})},a.id)),(t.role==="admin"?p:D).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"대관 신청 내역이 없습니다."})]}),(t.role==="admin"?p:D).length>3&&e.jsx("button",{onClick:()=>m("booking"),className:"w-full mt-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"전체 보기"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t.role==="admin"?"프로그램 신청 현황 / Program Applications":"내 프로그램 / My Programs"}),e.jsxs("div",{className:"space-y-4",children:[(t.role==="admin"?d.slice(0,3):b.slice(0,3)).map(a=>{const l=x.find(w=>w.id===a.programId),c=l?ys(l):null;return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100 border-l-4 border-purple-500",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:l?.title||a.programTitle||"Unknown Program"}),c&&c.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",c.dDay]}),e.jsx(lt,{status:a.status})]}),l&&e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"강사: ",l.instructor," | 기간: ",l.startDate," ~ ",l.endDate]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"일정: ",ws(l)]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"비용: ",l.fee?`${l.fee.toLocaleString()}원`:"무료"," | 정원: ",l.enrolled??0," / ",l.capacity,"명"]})]}),t.role==="admin"&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"신청자: ",a.userName," | 신청일: ",(a.appliedAt?.toDate?a.appliedAt.toDate():new Date(a.appliedAt||0)).toLocaleDateString()]})]})})},a.id)}),(t.role==="admin"?d:b).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"프로그램 신청 내역이 없습니다."})]}),(t.role==="admin"?d:b).length>3&&e.jsx("button",{onClick:()=>m("program"),className:"w-full mt-4 py-2 text-sm font-medium text-purple-600 hover:text-purple-800 transition-colors",children:"전체 보기"})]})]}),e.jsxs("div",{id:"dashboard-calendar-section",className:"mt-6 bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"전체 일정 캘린더 / Full Schedule Calendar"}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"text-gray-500",children:"캘린더 로딩 중..."}),children:e.jsx(fs,{bookings:t.role==="admin"?r:D,programs:x,view:g,setView:h})})]})]})},vs=({value:t,onChange:r,min:d=1,max:x})=>{const m=()=>{const p=t+1;(x===void 0||p<=x)&&r(p)},u=()=>{const p=t-1;(d===void 0||p>=d)&&r(p)},n=p=>{const D=parseInt(p.target.value.replace(/[^0-9]/g,""),10);isNaN(D)?p.target.value===""&&r(d):(d===void 0||D>=d)&&(x===void 0||D<=x)?r(D):d!==void 0&&D<d&&r(d)};return e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:t,onChange:n,className:"w-full p-3 border border-gray-200 rounded-xl text-center"}),e.jsxs("div",{className:"absolute right-2 flex flex-col",children:[e.jsx("button",{type:"button",onClick:m,className:"p-1 text-gray-500 hover:text-gray-800",children:e.jsx(Qt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:u,className:"p-1 text-gray-500 hover:text-gray-800",children:e.jsx(Zt,{className:"w-4 h-4"})})]})]})},Ns=Ge(Pe,"createBooking"),Ds=async(t,r,d)=>{const x={userId:d.id,userName:t.userName||d.name,userEmail:d.email,purpose:t.purpose,category:t.category,numberOfParticipants:t.numberOfParticipants,facilityId:t.facilityId,startDate:t.startDate,endDate:t.endDate,startTime:t.startTime,endTime:t.endTime,status:"pending",createdAt:oe(),updatedAt:oe()};return await ve(ie(U,"bookings",r),x),{bookingId:r}},Cs=o.memo(({status:t})=>{const r={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"},cancelled:{text:"취소됨 / Cancelled",color:"bg-gray-100 text-gray-800"}},{text:d,color:x}=r[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${x}`,children:d})}),ks=["일","월","화","수","목","금","토"],Ss=["일","월","화","수","목","금","토"],Es=t=>{const{startDate:r,endDate:d,recurrenceRule:x}=t;if(r===d)return r;let m="";return x&&x.days.length>0&&(m=` (매주 / Every ${x.days.sort().map(u=>ks[u]).join(", ")})`),`${r} ~ ${d}${m}`},ot=o.memo(({booking:t,facilities:r})=>{const d=r.find(x=>x.id===t.facilityId);return e.jsx("div",{className:"p-3 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.userName||"사용자"," | ",d?.name," | ",t.organization?`${t.organization} | `:"",Es(t)," ",t.startTime,"-",t.endTime]})]}),e.jsx(Cs,{status:t.status})]})})}),Ts=({currentUser:t,bookings:r,setBookings:d,syncing:x=!1})=>{const{facilities:m}=Me(),{showNotification:u}=$e(),[n,p]=o.useState({purpose:"",category:"personal",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00",facilityId:"",recurrenceRule:{days:[]},userName:t.name||""}),[D,b]=o.useState(!1),[N,y]=o.useState("list"),[g,h]=o.useState(new Date),[a,l]=o.useState(""),[c,w]=o.useState("all"),[C,I]=o.useState("all"),[E,G]=o.useState("all"),P=o.useMemo(()=>n.startDate!==n.endDate,[n.startDate,n.endDate]),X=o.useMemo(()=>{const i=new Date;i.setHours(0,0,0,0);const A=i.toISOString().split("T")[0];return r.filter(s=>!(!(s.userId===t.id||s.userEmail===t.email)||s.status==="completed"||s.status==="cancelled"||s.status==="approved"&&s.endDate<A)).filter(s=>!(a&&!s.purpose.toLowerCase().includes(a.toLowerCase())||c!=="all"&&s.status!==c||C!=="all"&&s.category!==C||E!=="all"&&s.facilityId!==E))},[r,t.id,t.email,a,c,C,E]),B=o.useMemo(()=>{const i=new Date;i.setHours(0,0,0,0);const A=i.toISOString().split("T")[0];return r.filter(s=>s.userId===t.id||s.userEmail===t.email?s.status==="completed"||s.status==="approved"&&s.endDate<A:!1).filter(s=>!(a&&!s.purpose.toLowerCase().includes(a.toLowerCase())||C!=="all"&&s.category!==C||E!=="all"&&s.facilityId!==E))},[r,t.id,t.email,a,C,E]),K=o.useCallback(()=>{const i=g.getFullYear(),A=g.getMonth(),k=new Date(i,A,1),s=new Date(k);s.setDate(s.getDate()-k.getDay());const f=[];for(let j=0;j<42;j++){const S=new Date(s);S.setDate(s.getDate()+j),f.push(S)}return f},[g]),T=o.useCallback(i=>{const A=i.toISOString().split("T")[0];return r.filter(s=>{if(!(s.userId===t.id||s.userEmail===t.email))return!1;const j=new Date(s.startDate+"T00:00:00"),S=new Date(s.endDate+"T00:00:00"),L=new Date(A+"T00:00:00");return L>=j&&L<=S?s.startDate!==s.endDate?s.recurrenceRule&&s.recurrenceRule.days&&s.recurrenceRule.days.length>0?s.recurrenceRule.days.includes(L.getDay()):!1:!0:!1})},[r,t.id,t.email]),F=o.useCallback(i=>{h(A=>{const k=new Date(A);return k.setMonth(A.getMonth()+(i==="next"?1:-1)),k})},[]),H=o.useCallback(async i=>{if(i.preventDefault(),D){console.log("이미 처리 중인 요청이 있습니다.");return}b(!0);const A=Date.now(),k=window.lastBookingSubmit||0;if(A-k<1e3){console.log("너무 빠른 연속 클릭 차단"),b(!1);return}window.lastBookingSubmit=A;try{if(!n.userName?.trim()){u("신청자 이름을 입력해주세요.","error");return}if(!n.purpose?.trim()){u("대관 목적을 입력해주세요.","error");return}if(n.purpose.trim().length<2){u("체육관 목적을 최소 2글자 이상 입력해 주세요.","error");return}if(!n.category||!n.startDate||!n.endDate||!n.startTime||!n.endTime){u("모든 필수 항목을 입력해주세요.","error");return}const s=new Date(n.startDate),f=new Date(n.endDate),j=new Date;if(j.setHours(0,0,0,0),s<j){u("시작일은 오늘 이후로 선택해주세요.","error");return}if(f<s){u("종료일은 시작일 이후로 선택해주세요.","error");return}if(n.startTime>=n.endTime){u("종료 시간은 시작 시간 이후로 선택해주세요.","error");return}if(!n.facilityId){u("시설을 선택해주세요.","error");return}if(P&&(!n.recurrenceRule?.days||n.recurrenceRule.days.length===0)){u("다중일 대관의 경우 반복 요일을 선택해주세요.","error");return}const S=m.find(Q=>Q.id===n.facilityId);if(!S){u("선택된 시설을 찾을 수 없습니다.","error");return}const L=S.bookingPolicy,M=L?.allowOverlap||!1,z=L?.maxConcurrent||1,V=r.filter(Q=>{if(Q.facilityId!==n.facilityId||Q.status!=="approved"&&Q.status!=="pending")return!1;const re=new Date(Q.startDate),he=new Date(Q.endDate),je=new Date(n.startDate),ge=new Date(n.endDate);if(!(re<=ge&&he>=je))return!1;const[we,de]=Q.startTime.split(":").map(Number),[v,_]=Q.endTime.split(":").map(Number),[Z,O]=n.startTime.split(":").map(Number),[J,me]=n.endTime.split(":").map(Number),se=we*60+de,ne=v*60+_,ke=Z*60+O,Se=J*60+me;return se<Se&&ne>ke});if(!M&&V.length>0){u(`현재 [${S.name}]은 단독 사용만 가능합니다. 같은 시간에 다른 예약이 있어 신청할 수 없습니다.`,"error");return}if(M&&V.length>=z){u(`현재 [${S.name}]은 ${z}팀 이상 제한으로 대관이 불가합니다.`,"error");return}const R={purpose:n.purpose,category:n.category,numberOfParticipants:n.numberOfParticipants||1,facilityId:S.id,startDate:n.startDate,endDate:n.endDate,startTime:n.startTime,endTime:n.endTime,...P&&n.recurrenceRule?.days&&n.recurrenceRule.days.length>0?{recurrenceRule:n.recurrenceRule}:{}},$=`booking-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;let q=!1,ee=null;const le=Date.now(),te=`${t.id}-${R.startDate}-${R.startTime}`,ye=window.lastBookingSubmits?.[te]||0;if(le-ye<3e3){u("잠시만 기다려주세요.","warning");return}window.lastBookingSubmits||(window.lastBookingSubmits={}),window.lastBookingSubmits[te]=le;try{const Q=Ns(R),re=new Promise((je,ge)=>setTimeout(()=>ge(new Error("타임아웃")),3e3)),he=await Promise.race([Q,re]);q=!0,ee={id:he?.data?.bookingId||$,userId:t.id,userName:n.userName||t.name,userEmail:t.email,...R,status:"pending",createdAt:new Date}}catch{try{await Ds(R,$,t),q=!0,ee={id:$,userId:t.id,userName:n.userName||t.name,userEmail:t.email,...R,status:"pending",createdAt:new Date}}catch{q=!1}}q?(p({purpose:"",category:"personal",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00",facilityId:"",recurrenceRule:{days:[]},userName:t.name||""}),u("대관 신청이 완료되었습니다!","success")):u("대관 신청에 실패했습니다.","error")}catch(s){console.error("대관 신청 최종 오류:",s),u("대관 신청 중 문제가 발생했습니다. 다시 시도해주세요.","error")}finally{b(!1)}},[n,m,u,t]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"체육관 대관 / Gym Booking"}),e.jsx("p",{className:"text-gray-600",children:"체육관 공간을 예약하고 관리하세요 / Book and manage gym spaces"}),x&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mt-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs",children:"동기화 중..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>y("list"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${N==="list"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Jt,{className:"w-4 h-4"}),"목록 / List"]}),e.jsxs("button",{onClick:()=>y("calendar"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${N==="calendar"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ae,{className:"w-4 h-4"}),"캘린더 / Calendar"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"검색 및 필터"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적 검색"}),e.jsx("input",{type:"text",className:"w-full p-2 border border-gray-200 rounded-lg",placeholder:"대관 목적을 입력하세요",value:a,onChange:i=>l(i.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"상태"}),e.jsxs("select",{className:"w-full p-2 border border-gray-200 rounded-lg bg-white",value:c,onChange:i=>w(i.target.value),children:[e.jsx("option",{value:"all",children:"전체"}),e.jsx("option",{value:"pending",children:"대기중"}),e.jsx("option",{value:"approved",children:"승인됨"}),e.jsx("option",{value:"rejected",children:"거절됨"}),e.jsx("option",{value:"cancelled",children:"취소됨"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-2 border border-gray-200 rounded-lg bg-white",value:C,onChange:i=>I(i.target.value),children:[e.jsx("option",{value:"all",children:"전체"}),e.jsx("option",{value:"personal",children:"개인"}),e.jsx("option",{value:"club",children:"동아리"}),e.jsx("option",{value:"event",children:"행사"}),e.jsx("option",{value:"class",children:"수업"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설"}),e.jsxs("select",{className:"w-full p-2 border border-gray-200 rounded-lg bg-white",value:E,onChange:i=>G(i.target.value),children:[e.jsx("option",{value:"all",children:"전체"}),m.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]})]}),e.jsx("div",{className:"flex justify-end mt-3",children:e.jsx("button",{onClick:()=>{l(""),w("all"),I("all"),G("all")},className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-50 rounded-lg transition-colors",children:"필터 초기화"})})]}),N==="list"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"진행중인 대관 / Active Bookings"}),e.jsxs("div",{className:"space-y-3 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[X.map(i=>e.jsx(ot,{booking:i,facilities:m},i.id)),X.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"진행중인 대관 신청이 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"완료된 대관 / Completed Bookings"}),e.jsxs("div",{className:"space-y-3 max-h-[600px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[B.map(i=>e.jsx(ot,{booking:i,facilities:m},i.id)),B.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"완료된 대관이 없습니다."})]})]})]})}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[g.getFullYear(),"년 ",g.getMonth()+1,"월"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>F("prev"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Ut,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>h(new Date),className:"px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"오늘"}),e.jsx("button",{onClick:()=>F("next"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(es,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-px mb-2",children:["일","월","화","수","목","금","토"].map(i=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500",children:i},i))}),e.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-200 rounded-lg overflow-hidden",children:K().map((i,A)=>{const k=T(i),s=i.getMonth()===g.getMonth(),f=i.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`bg-white p-2 min-h-[120px] ${s?"text-gray-900":"text-gray-400"} ${f?"bg-blue-50":""}`,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${f?"text-blue-600":""}`,children:i.getDate()}),e.jsxs("div",{className:"space-y-1",children:[k.slice(0,3).map(j=>e.jsx("div",{className:`text-xs px-2 py-1 rounded text-white text-center truncate ${j.status==="approved"?"bg-green-500":j.status==="pending"?"bg-orange-500":j.status==="rejected"?"bg-red-500":"bg-gray-500"}`,title:`${j.userName||"사용자"} - ${j.purpose} (${j.startTime}-${j.endTime})`,children:j.purpose},j.id)),k.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",k.length-3," more"]})]})]},A)})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"승인됨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"대기중"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"거절됨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded"}),e.jsx("span",{children:"완료됨"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"신규 대관 신청"}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"신청자 이름"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",placeholder:"신청자 이름을 입력하세요",value:n.userName||"",onChange:i=>p({...n,userName:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:n.purpose||"",onChange:i=>p({...n,purpose:i.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:n.category,onChange:i=>p({...n,category:i.target.value}),children:[e.jsx("option",{value:"personal",children:"개인"}),e.jsx("option",{value:"club",children:"동아리"}),e.jsx("option",{value:"event",children:"행사"}),e.jsx("option",{value:"class",children:"수업"})]})]}),e.jsx("div",{})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설 선택"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:n.facilityId||"",onChange:i=>p({...n,facilityId:i.target.value}),children:[e.jsx("option",{value:"",children:"시설을 선택해 주세요"}),m.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:n.startDate||"",onChange:i=>p({...n,startDate:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:n.endDate||"",onChange:i=>p({...n,endDate:i.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"반복 요일 (다중일 선택시)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ss.map((i,A)=>e.jsx("button",{type:"button",onClick:()=>p(k=>({...k,recurrenceRule:{days:k.recurrenceRule?.days?.includes(A)?k.recurrenceRule.days.filter(s=>s!==A):[...k.recurrenceRule?.days||[],A]}})),className:`p-2 rounded-lg border text-sm font-medium ${n.recurrenceRule?.days?.includes(A)?"bg-blue-500 text-white border-blue-500":"bg-white hover:bg-gray-100 border-gray-300"} ${P?"":"opacity-50 pointer-events-none"}`,children:i},i))}),!P&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"* 시작일과 종료일이 다를 때 활성화됩니다"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:n.startTime||"",onChange:i=>p({...n,startTime:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:n.endTime||"",onChange:i=>p({...n,endTime:i.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"인원"}),e.jsx(vs,{value:n.numberOfParticipants||1,onChange:i=>p({...n,numberOfParticipants:i})})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"submit",disabled:D,className:`w-full md:w-auto px-6 py-3 rounded-xl font-medium transition-all duration-200 transform ${D?"bg-gray-400 cursor-not-allowed scale-95":"bg-blue-600 hover:bg-blue-700 hover:scale-105 text-white shadow-lg hover:shadow-xl"}`,style:{pointerEvents:D?"none":"auto"},children:D?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"처리 중..."})]}):e.jsx("span",{className:"flex items-center gap-2",children:"📅 대관 신청"})})})]})]})]})]})},As=Ge(Pe,"createProgramApplication"),Ps=["일","월","화","수","목","금","토"],it=t=>{const r=new Date;r.setHours(0,0,0,0);const d=new Date(t.startDate);d.setHours(0,0,0,0);const x=new Date(t.endDate);return x.setHours(0,0,0,0),r>x?{text:"종료",dDay:null}:r>=d&&r<=x?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((d.getTime()-r.getTime())/(1e3*60*60*24))}},Ms=t=>`${(t.scheduleDays||[]).sort().map(r=>Ps[r]).join(", ")} ${t.startTime}-${t.endTime}`,ct=o.memo(({program:t,status:r,onApply:d,applying:x,isAlreadyApplied:m,userApplication:u})=>e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:t.title}),r.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",r.dDay]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:t.description})]}),e.jsxs("div",{className:"ml-4 flex flex-col gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${r.text==="종료"?"bg-gray-100 text-gray-800":r.text==="진행중"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:r.text}),m&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${u?.status==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:u?.status==="approved"?"승인됨":"신청완료"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsxs("span",{children:["강사: ",t.instructor]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:["기간: ",t.startDate," ~ ",t.endDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),e.jsxs("span",{children:["일정: ",Ms(t)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsxs("span",{children:["정원: ",t.enrolled??0," / ",t.capacity,"명"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:t.fee?`${t.fee.toLocaleString()}원`:"무료"}),r.text!=="종료"&&e.jsx("button",{disabled:x||m,onClick:()=>d(t.id),className:`px-6 py-2 rounded-xl font-medium transition-colors ${m?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50"}`,children:m?"신청완료":x?"신청중...":"신청하기"})]})]})})),$s=({currentUser:t,programs:r,applications:d,setApplications:x})=>{const{showNotification:m}=$e(),[u,n]=o.useState(""),[p,D]=o.useState(null),b=o.useMemo(()=>{const g=new Date;return g.setHours(0,0,0,0),r.filter(h=>{const a=new Date(h.endDate);a.setHours(0,0,0,0);const l=a>=g,c=h.title.toLowerCase().includes(u.toLowerCase());return l&&c})},[r,u]),N=o.useMemo(()=>{const g=new Date;return g.setHours(0,0,0,0),r.filter(h=>{const a=new Date(h.endDate);a.setHours(0,0,0,0);const l=a<g,c=h.title.toLowerCase().includes(u.toLowerCase());return l&&c})},[r,u]),y=o.useCallback(async g=>{const h=d.find(l=>l.programId===g&&l.userId===t.id&&(l.status==="pending"||l.status==="approved"));if(h){const l=h.status==="pending"?"대기중":"승인됨";m(`이미 이 프로그램에 신청하셨습니다. (현재 상태: ${l})`,"warning");return}D(g);const a={id:`temp-${Date.now()}`,userId:t.id,programId:g,status:"pending",appliedAt:new Date,userName:t.name,userEmail:t.email,programTitle:r.find(l=>l.id===g)?.title||"Unknown Program"};x(l=>[a,...l]),m("프로그램 신청이 완료되었습니다. 관리자 승인을 기다려주세요.","success");try{const l=await As({programId:g});if(l?.data?.success)x(c=>c.map(w=>w.id===a.id?{...w,id:l.data.applicationId}:w)),console.log("프로그램 신청 Firebase 저장 성공:",l.data.applicationId);else{x(w=>w.filter(C=>C.id!==a.id));const c=l?.data?.message||"신청에 실패했습니다. 잠시 후 다시 시도해주세요.";m(c,"error")}}catch(l){x(c=>c.filter(w=>w.id!==a.id)),m(`신청 실패: ${l?.message||"네트워크 오류가 발생했습니다. 잠시 후 다시 시도해주세요."}`,"error")}finally{D(null)}},[m,t,r,x,d]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"프로그램"}),e.jsx("p",{className:"text-gray-600",children:"다양한 체육 프로그램에 참여해보세요"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"프로그램 검색"}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ht,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{value:u,onChange:g=>n(g.target.value),placeholder:"프로그램명, 강사명으로 검색...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:["진행중 프로그램 (",b.length,"개)"]}),e.jsxs("div",{className:"space-y-4 max-h-[700px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[b.map(g=>{const h=it(g),a=d.find(c=>c.programId===g.id&&c.userId===t.id&&(c.status==="pending"||c.status==="approved")),l=!!a;return e.jsx(ct,{program:g,status:h,onApply:y,applying:p===g.id,isAlreadyApplied:l,userApplication:a},g.id)}),b.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"진행중인 프로그램이 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"새로운 프로그램을 기다려주세요."})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:["종료된 프로그램 (",N.length,"개)"]}),e.jsxs("div",{className:"space-y-4 max-h-[700px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[N.map(g=>{const h=it(g),a=d.find(c=>c.programId===g.id&&c.userId===t.id&&(c.status==="pending"||c.status==="approved")),l=!!a;return e.jsx(ct,{program:g,status:h,onApply:y,applying:p===g.id,isAlreadyApplied:l,userApplication:a},g.id)}),N.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"종료된 프로그램이 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"종료된 프로그램이 여기 표시됩니다."})]})]})]})]})]})},_s=o.lazy(()=>Y(()=>import("./DashboardCalendar-uDP7ybYC.js"),__vite__mapDeps([0,1,2]),import.meta.url));Ge(Pe,"updateReservationStatus");const ft=["일","월","화","수","목","금","토"],Is=t=>{const r=new Date;r.setHours(0,0,0,0);const d=new Date(t.startDate);d.setHours(0,0,0,0);const x=new Date(t.endDate);return x.setHours(0,0,0,0),r>x?{text:"종료",dDay:null}:r>=d&&r<=x?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((d.getTime()-r.getTime())/(1e3*60*60*24))}},Os=o.memo(({b:t,onAction:r})=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.userName," | ",t.startDate," ",t.startTime,"-",t.endTime]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(t.id,"approve"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>r(t.id,"reject"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})})),dt=o.memo(({p:t,onEdit:r,onDelete:d})=>{const x=Is(t);return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.title}),x.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",x.dDay]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.instructor," | ",t.startDate," ~ ",t.endDate," | ",t.startDate!==t.endDate?(t.scheduleDays||[]).slice().sort().map(m=>ft[m]).join(","):"단일"," | ",t.startTime," - ",t.endTime," | ",t.fee?`${t.fee.toLocaleString()}원`:"무료"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(t),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d(t),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg",children:e.jsx(We,{className:"w-4 h-4"})})]})]})});function Rs({currentUser:t,bookings:r,setBookings:d,applications:x,setApplications:m,programs:u,setPrograms:n,users:p,facilities:D}){const{showNotification:b}=$e(),[N,y]=o.useState(!1),[g,h]=o.useState(null),[a,l]=o.useState("month"),c={title:"",description:"",instructor:"",capacity:10,scheduleDays:[],startTime:"09:00",endTime:"10:00",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],level:"beginner",category:"yoga",fee:0},[w,C]=o.useState(c),I=o.useMemo(()=>w.startDate!==w.endDate,[w.startDate,w.endDate]),E=o.useMemo(()=>{const s=new Date;return s.setHours(0,0,0,0),u.filter(f=>{const j=new Date(f.endDate);return j.setHours(0,0,0,0),j>=s})},[u]),G=o.useMemo(()=>{const s=new Date;return s.setHours(0,0,0,0),u.filter(f=>{const j=new Date(f.endDate);return j.setHours(0,0,0,0),j<s})},[u]),P=o.useMemo(()=>{const s=[];for(let f=0;f<24;f++)for(let j=0;j<60;j+=10)s.push(`${String(f).padStart(2,"0")}:${String(j).padStart(2,"0")}`);return s},[]),X=o.useCallback(async()=>{const s={...g??{id:`program-${Date.now()}`},...w};g?(n(f=>f.map(j=>j.id===s.id?s:j)),b("프로그램이 수정되었습니다.","success")):(n(f=>[s,...f]),b("새 프로그램이 개설되었습니다.","success"));try{const{doc:f,setDoc:j,updateDoc:S,serverTimestamp:L}=await Y(async()=>{const{doc:V,setDoc:R,updateDoc:$,serverTimestamp:q}=await import("./firebase-DnP1Uaxu.js").then(ee=>ee.M);return{doc:V,setDoc:R,updateDoc:$,serverTimestamp:q}},[],import.meta.url),{db:M}=await Y(async()=>{const{db:V}=await Promise.resolve().then(()=>ue);return{db:V}},void 0,import.meta.url),z=new Date;g?(await S(f(M,"programs",s.id),{...s,updatedAt:z}),console.log("프로그램 수정 완료:",s.id)):(await j(f(M,"programs",s.id),{...s,createdAt:z,updatedAt:z}),console.log("새 프로그램 생성 완료:",s.id))}catch(f){console.warn("Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",f)}y(!1),h(null)},[w,g,n,b]),B=o.useCallback(async(s,f)=>{console.log("=== 대관 승인/거절 시작 ===",{bookingId:s,action:f});const j=f==="approve"?"approved":"rejected";try{console.log("1. 로컬 상태 업데이트 실행"),d(R=>R.map($=>$.id===s?{...$,status:j}:$)),b(`대관이 ${f==="approve"?"승인":"거절"}되었습니다.`,"success"),console.log("3. Firebase 저장 시작");const{doc:S,updateDoc:L,serverTimestamp:M}=await Y(async()=>{const{doc:R,updateDoc:$,serverTimestamp:q}=await import("./firebase-DnP1Uaxu.js").then(ee=>ee.M);return{doc:R,updateDoc:$,serverTimestamp:q}},[],import.meta.url),{db:z}=await Y(async()=>{const{db:R}=await Promise.resolve().then(()=>ue);return{db:R}},void 0,import.meta.url),V={status:j,updatedAt:M(),[f==="approve"?"approvedAt":"rejectedAt"]:M()};console.log("3-1. 업데이트할 데이터:",V),console.log("3-2. 대상 문서:",`bookings/${s}`),await L(S(z,"bookings",s),V),console.log("✅ Firebase 저장 성공 - 실시간 동기화 보장됨")}catch(S){console.error("❌ Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",S)}},[r,d,b]),K=o.useCallback(async(s,f)=>{const j=x;try{m(R=>R.map($=>$.id===s?{...$,status:f}:$));const{doc:S,updateDoc:L,serverTimestamp:M}=await Y(async()=>{const{doc:R,updateDoc:$,serverTimestamp:q}=await import("./firebase-DnP1Uaxu.js").then(ee=>ee.M);return{doc:R,updateDoc:$,serverTimestamp:q}},[],import.meta.url),{db:z}=await Y(async()=>{const{db:R}=await Promise.resolve().then(()=>ue);return{db:R}},void 0,import.meta.url),V=new Date;await L(S(z,"program_applications",s),{status:f,updatedAt:V,[f==="approved"?"approvedAt":"rejectedAt"]:V}),console.log("프로그램 신청 상태 Firebase 저장 성공:",s,f),b(`프로그램 신청이 ${f==="approved"?"승인":"거절"}되었습니다.`,"success")}catch(S){console.error("프로그램 신청 상태 업데이트 실패:",S),m(j),b("프로그램 신청 상태 변경에 실패했습니다. 다시 시도해주세요.","error")}},[x,m,b]),T=o.useMemo(()=>r.filter(s=>s.status==="pending"),[r]),F=o.useMemo(()=>x.filter(s=>s.status==="pending"),[x]),H=o.useMemo(()=>p.length,[p]),[i,A]=o.useState({name:"",category:"class",purpose:"",facilityId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"}),k=o.useCallback(async()=>{if(!i.name||i.name.trim().length===0){b("신청자 이름을 입력해주세요.","error");return}if(!i.purpose||i.purpose.trim().length===0){b("대관 목적을 입력해주세요.","error");return}if(!i.facilityId){b("시설을 선택해주세요.","error");return}const s=new Date(i.startDate+"T00:00:00");if(new Date(i.endDate+"T00:00:00")<s){b("종료일은 시작일 이후로 선택해주세요.","error");return}if(i.startTime>=i.endTime){b("종료 시간은 시작 시간 이후로 선택해주세요.","error");return}const j=D.find($=>$.id===i.facilityId);if(!j){b("선택된 시설을 찾을 수 없습니다.","error");return}const S=j.bookingPolicy,L=S?.allowOverlap||!1,M=S?.maxConcurrent||1,z=r.filter($=>{if($.facilityId!==i.facilityId||$.status!=="approved")return!1;const q=new Date($.startDate),ee=new Date($.endDate),le=new Date(i.startDate),te=new Date(i.endDate);if(!(q<=te&&ee>=le))return!1;const[Q,re]=$.startTime.split(":").map(Number),[he,je]=$.endTime.split(":").map(Number),[ge,_e]=i.startTime.split(":").map(Number),[we,de]=i.endTime.split(":").map(Number),v=Q*60+re,_=he*60+je,Z=ge*60+_e,O=we*60+de;return v<O&&_>Z});if(!L&&z.length>0){b("이 시설은 단독 사용만 가능합니다. 같은 시간에 다른 예약이 있어 등록할 수 없습니다.","error");return}if(L&&z.length>=M){b(`이 시설은 최대 ${M}팀까지 동시 사용 가능합니다. 현재 ${z.length}팀이 예약되어 있어 추가 등록이 불가합니다.`,"error");return}const V=`booking-${Date.now()}`,R={id:V,userId:t.id,userName:i.name,userEmail:t.email,facilityId:i.facilityId,startDate:i.startDate,endDate:i.endDate,startTime:i.startTime,endTime:i.endTime,purpose:i.purpose,category:i.category,status:"approved",numberOfParticipants:1,createdAt:new Date};d($=>{const q=[R,...$];return console.log("📅 관리자 대관 등록 완료 - 캘린더 업데이트:",{bookingId:V,purpose:R.purpose,status:R.status,totalBookings:q.length}),q}),b("대관이 승인되어 등록되었습니다. 캘린더에서 확인 가능합니다.","success");try{const{doc:$,setDoc:q,serverTimestamp:ee}=await Y(async()=>{const{doc:te,setDoc:ye,serverTimestamp:Q}=await import("./firebase-DnP1Uaxu.js").then(re=>re.M);return{doc:te,setDoc:ye,serverTimestamp:Q}},[],import.meta.url),{db:le}=await Y(async()=>{const{db:te}=await Promise.resolve().then(()=>ue);return{db:te}},void 0,import.meta.url);await q($(le,"bookings",V),{...R,createdAt:ee(),updatedAt:ee(),approvedAt:ee()}),console.log("대관 신청 Firebase 저장 성공:",V)}catch($){console.warn("Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",$)}A({name:"",category:"class",purpose:"",facilityId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"})},[i,t,d,b,D,r]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"운영 관리"}),e.jsx("p",{className:"text-gray-600",children:"대관 및 프로그램 신청을 관리하고, 체육관 직접 등록을 할 수 있습니다"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기중인 대관"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:T.length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(ae,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기중인 프로그램 신청"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:F.length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center",children:e.jsx(fe,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"운영중인 프로그램"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:E.length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(xe,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"총 이용자 수"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:H})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"수강생/팀 직접 등록"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"아래 폼을 사용하여 대관을 등록하세요"})]}),e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"신청자 이름"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",placeholder:"예: 관리자 등록",value:i.name,onChange:s=>A({...i,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",placeholder:"대관 목적을 입력하세요",value:i.purpose,onChange:s=>A({...i,purpose:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:i.category,onChange:s=>A({...i,category:s.target.value}),children:[e.jsx("option",{value:"class",children:"수업"}),e.jsx("option",{value:"event",children:"행사"}),e.jsx("option",{value:"club",children:"동아리"}),e.jsx("option",{value:"personal",children:"개인"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설 선택"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:i.facilityId,onChange:s=>A({...i,facilityId:s.target.value}),children:[e.jsx("option",{value:"",children:"시설을 선택해 주세요"}),D.map(s=>{const f=s.bookingPolicy,j=f?.allowOverlap?`(공유사용, 최대 ${f.maxConcurrent||1}팀)`:"(단독사용)";return e.jsxs("option",{value:s.id,children:[s.name," ",j]},s.id)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:i.startDate,onChange:s=>A({...i,startDate:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:i.endDate,onChange:s=>A({...i,endDate:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:i.startTime,onChange:s=>A({...i,startTime:s.target.value}),children:[e.jsx("option",{value:"09:00",children:"09:00"}),e.jsx("option",{value:"10:00",children:"10:00"}),e.jsx("option",{value:"11:00",children:"11:00"}),e.jsx("option",{value:"14:00",children:"14:00"}),e.jsx("option",{value:"15:00",children:"15:00"}),e.jsx("option",{value:"16:00",children:"16:00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:i.endTime,onChange:s=>A({...i,endTime:s.target.value}),children:[e.jsx("option",{value:"10:00",children:"10:00"}),e.jsx("option",{value:"11:00",children:"11:00"}),e.jsx("option",{value:"12:00",children:"12:00"}),e.jsx("option",{value:"15:00",children:"15:00"}),e.jsx("option",{value:"16:00",children:"16:00"}),e.jsx("option",{value:"17:00",children:"17:00"})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"취소"}),e.jsx("button",{onClick:k,className:"px-6 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:"등록하기"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-50 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["사용자 대관 신청 대기 (",T.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:T.length>0?T.map(s=>e.jsx(Os,{b:s,onAction:B},s.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"대기중인 신청이 없습니다."})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["대기중인 프로그램 신청 (",F.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:F.length>0?F.map(s=>{const f=u.find(j=>j.id===s.programId);return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:f?.title||s.programTitle}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["신청자: ",s.userName," | 신청일: ",s.appliedAt?.toDate?.()?.toLocaleDateString()||"N/A"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>K(s.id,"approved"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>K(s.id,"rejected"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})},s.id)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"대기중인 신청이 없습니다."})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"프로그램 관리"})]}),e.jsxs("button",{onClick:()=>{h(null),C(c),y(!0)},className:"flex items-center gap-2 text-sm font-medium text-purple-600 hover:text-purple-800 px-4 py-2 rounded-lg hover:bg-purple-50",children:[e.jsx(Ye,{className:"w-4 h-4"})," 새 프로그램 추가"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:["진행중 프로그램 (",E.length,"개)"]}),e.jsxs("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[E.map(s=>e.jsx(dt,{p:s,onEdit:f=>{h(f),C(f),y(!0)},onDelete:f=>n(j=>j.filter(S=>S.id!==f.id))},s.id)),E.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"진행중인 프로그램이 없습니다."})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-semibold text-gray-800 mb-3",children:["종료된 프로그램 (",G.length,"개)"]}),e.jsxs("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[G.map(s=>e.jsx(dt,{p:s,onEdit:f=>{h(f),C(f),y(!0)},onDelete:f=>n(j=>j.filter(S=>S.id!==f.id))},s.id)),G.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"종료된 프로그램이 없습니다."})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"전체 대관 캘린더"})]}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"text-center py-8 text-gray-500",children:"캘린더 로딩 중..."}),children:e.jsx(_s,{bookings:r,programs:u,view:a,setView:l})})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:g?"프로그램 수정":"새 프로그램 개설"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"제목"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:w.title,onChange:s=>C({...w,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"강사"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:w.instructor,onChange:s=>C({...w,instructor:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명"}),e.jsx("textarea",{className:"w-full p-3 border border-gray-200 rounded-xl",rows:3,value:w.description,onChange:s=>C({...w,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:w.startDate,onChange:s=>C({...w,startDate:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:w.endDate,onChange:s=>C({...w,endDate:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"반복 요일"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ft.map((s,f)=>e.jsx("button",{type:"button",onClick:()=>C(j=>({...j,scheduleDays:j.scheduleDays.includes(f)?j.scheduleDays.filter(S=>S!==f):[...j.scheduleDays,f]})),className:`p-2 rounded-lg border text-sm font-medium ${w.scheduleDays.includes(f)?"bg-purple-500 text-white border-purple-500":"bg-white hover:bg-gray-100 border-gray-300"} ${I?"":"opacity-50 pointer-events-none"}`,children:s},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:w.startTime,onChange:s=>C({...w,startTime:s.target.value}),children:P.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:w.endTime,onChange:s=>C({...w,endTime:s.target.value}),children:P.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"정원"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:w.capacity,onChange:s=>C({...w,capacity:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"금액"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:w.fee||0,onChange:s=>C({...w,fee:parseInt(s.target.value)||0})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl border",onClick:()=>{y(!1),h(null)},children:"취소"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-purple-600 text-white",onClick:X,children:g?"수정하기":"개설하기"})]})]})})]})}const Fs=({users:t,setUsers:r})=>{const{users:d,loading:x}=Me(),m=d.length>0?d:t||[],[u,n]=o.useState(!1),[p,D]=o.useState(!1),[b,N]=o.useState(null),[y,g]=o.useState(null),[h,a]=o.useState(null),l={name:"",email:"",phone:"",password:"",role:"user"},[c,w]=o.useState(l),[C,I]=o.useState(""),[E,G]=o.useState(""),[P,X]=o.useState(""),[B,K]=o.useState(""),[T,F]=o.useState(null),[H,i]=o.useState(!1),[A,k]=o.useState(!1),[s,f]=o.useState(""),[j,S]=o.useState("name"),[L]=o.useState("all"),[M,z]=o.useState({key:"name",direction:"asc"}),V=ut();o.useEffect(()=>{p&&setTimeout(()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new Ft(V,"recaptcha-container",{size:"invisible",callback:()=>{}}))},100)},[p,V]);const R=v=>{N(v),w({name:v.name,email:v.email,phone:v.phone||"",password:"",role:v.role}),n(!0)},$=()=>{N(null),w(l),n(!0)},q=()=>{n(!1),N(null)},ee=v=>{a(v),I(v.email),X(v.phone||""),G(""),K(""),F(null),D(!0)},le=()=>{D(!1),a(null),window.recaptchaVerifier&&window.recaptchaVerifier.clear()},te=v=>{const{name:_,value:Z}=v.target;w(_==="phone"?O=>({...O,[_]:st(Z)}):O=>({...O,[_]:Z}))},ye=async v=>{v.preventDefault(),k(!0);try{if(b){if(m.some(se=>se.email===c.email&&se.id!==b.id)){alert("이미 사용 중인 이메일입니다.");return}const{doc:_,updateDoc:Z,serverTimestamp:O}=await Y(async()=>{const{doc:se,updateDoc:ne,serverTimestamp:ke}=await import("./firebase-DnP1Uaxu.js").then(Se=>Se.M);return{doc:se,updateDoc:ne,serverTimestamp:ke}},[],import.meta.url),{db:J}=await Y(async()=>{const{db:se}=await Promise.resolve().then(()=>ue);return{db:se}},void 0,import.meta.url),me={name:c.name,email:c.email,phone:c.phone.replace(/-/g,"")||null,role:c.role,updatedAt:O()};await Z(_(J,"users",b.id),me),r&&r(se=>se.map(ne=>ne.id===b.id?{...ne,name:c.name,email:c.email,phone:c.phone.replace(/-/g,""),role:c.role}:ne)),alert("사용자 정보가 수정되었습니다.")}else{if(m.some(O=>O.email===c.email)){alert("이미 등록된 이메일입니다.");return}if(!c.password){alert("신규 사용자는 비밀번호가 필요합니다.");return}const{httpsCallable:_}=await Y(async()=>{const{httpsCallable:O}=await import("./firebase-DnP1Uaxu.js").then(J=>J.N);return{httpsCallable:O}},[],import.meta.url),{functions:Z}=await Y(async()=>{const{functions:O}=await Promise.resolve().then(()=>ue);return{functions:O}},void 0,import.meta.url);try{const J=await _(Z,"createUserByAdmin")({name:c.name,email:c.email,phone:c.phone.replace(/-/g,"")||null,password:c.password,role:c.role});if(J.data.success){if(alert(`새 사용자 '${c.name}'이 생성되었습니다.

관리자가 생성한 계정이므로 이메일 인증 없이 바로 로그인할 수 있습니다.`),r){const me={id:J.data.uid,name:c.name,email:c.email,phone:c.phone.replace(/-/g,""),role:c.role};r(se=>[...se,me])}}else throw new Error(J.data.error||"사용자 생성에 실패했습니다.")}catch(O){console.warn("Cloud Functions 사용자 생성 실패, 직접 생성 방식으로 전환:",O);const{createUserWithEmailAndPassword:J,sendEmailVerification:me,updateProfile:se,signOut:ne}=await Y(async()=>{const{createUserWithEmailAndPassword:pe,sendEmailVerification:be,updateProfile:Le,signOut:Ve}=await import("./firebase-DnP1Uaxu.js").then(jt=>jt.L);return{createUserWithEmailAndPassword:pe,sendEmailVerification:be,updateProfile:Le,signOut:Ve}},[],import.meta.url),{doc:ke,setDoc:Se,serverTimestamp:Xe}=await Y(async()=>{const{doc:pe,setDoc:be,serverTimestamp:Le}=await import("./firebase-DnP1Uaxu.js").then(Ve=>Ve.M);return{doc:pe,setDoc:be,serverTimestamp:Le}},[],import.meta.url),{auth:Re,db:yt}=await Y(async()=>{const{auth:pe,db:be}=await Promise.resolve().then(()=>ue);return{auth:pe,db:be}},void 0,import.meta.url);if(!Re.currentUser)throw new Error("관리자 로그인이 필요합니다.");const Fe=(await J(Re,c.email,c.password)).user;if(await se(Fe,{displayName:c.name||c.email.split("@")[0]}),await Se(ke(yt,"users",Fe.uid),{name:c.name,email:c.email,phone:c.phone.replace(/-/g,"")||null,role:c.role,isActive:!0,adminCreated:!0,createdAt:Xe(),updatedAt:Xe()}),console.log("관리자가 직접 생성한 사용자이므로 이메일 인증 메일을 발송하지 않습니다."),await ne(Re),alert(`새 사용자 '${c.name}'이 생성되었습니다.

⚠️ 새 사용자 생성으로 인해 자동 로그아웃되었습니다.
관리자 계정으로 다시 로그인해주세요.

생성된 사용자는 이메일 인증 없이 바로 로그인할 수 있습니다.`),r){const pe={id:Fe.uid,name:c.name,email:c.email,phone:c.phone.replace(/-/g,""),role:c.role};r(be=>[...be,pe])}}}q()}catch(_){console.error("User creation/update error:",_);const Z=De(_);alert(Z)}finally{k(!1)}},Q=v=>{if(v.role==="admin"&&m.filter(_=>_.role==="admin").length<=1){alert("마지막 관리자 계정은 삭제할 수 없습니다.");return}g(v)},re=async()=>{if(y){try{const{deleteDoc:v,doc:_}=await Y(async()=>{const{deleteDoc:O,doc:J}=await import("./firebase-DnP1Uaxu.js").then(me=>me.M);return{deleteDoc:O,doc:J}},[],import.meta.url),{db:Z}=await Y(async()=>{const{db:O}=await Promise.resolve().then(()=>ue);return{db:O}},void 0,import.meta.url);await v(_(Z,"users",y.id)),alert("사용자가 삭제되었습니다."),r&&r(O=>O.filter(J=>J.id!==y.id))}catch(v){console.error("사용자 삭제 오류:",v),alert("사용자 삭제에 실패했습니다.")}g(null)}},he=v=>{let _="asc";M&&M.key===v&&M.direction==="asc"&&(_="desc"),z({key:v,direction:_})},je=async()=>{if(!P){alert("휴대폰 번호를 입력하세요.");return}i(!0);try{const v=window.recaptchaVerifier,_=await Lt(V,P,v);F(_),alert("인증 코드를 발송했습니다.")}catch(v){console.error("SMS Error:",v),alert("SMS 인증 코드 요청에 실패했습니다.")}finally{i(!1)}},ge=async()=>{if(!B){alert("인증 코드를 입력하세요.");return}if(!T){alert("먼저 인증 코드를 요청하세요.");return}i(!0);try{await T.confirm(B),alert("휴대폰 인증이 완료되었습니다.")}catch(v){console.error("Verification Error:",v),alert("인증 코드가 잘못되었습니다.")}finally{i(!1)}},_e=async()=>{if(!C||!E){alert("새 이메일과 현재 비밀번호를 입력하세요.");return}if(V.currentUser){i(!0);try{const v=Vt.credential(V.currentUser.email,E);await Bt(V.currentUser,v),await Ht(V.currentUser,C),alert("이메일 주소가 변경되었습니다. 새 주소로 인증 메일을 확인하세요."),le()}catch(v){console.error("Email Update Error:",v),alert("이메일 변경에 실패했습니다. 비밀번호를 확인하세요.")}finally{i(!1)}}},we=o.useMemo(()=>{const v=m.filter(_=>L==="all"||_.role===L).filter(_=>{if(!s)return!0;const Z=s.toLowerCase();return(_[j]?.toLowerCase()||"").includes(Z)});return M!==null&&v.sort((_,Z)=>{const O=_[M.key]||"",J=Z[M.key]||"";return O<J?M.direction==="asc"?-1:1:O>J?M.direction==="asc"?1:-1:0}),v},[m,s,j,L,M]),de=({columnKey:v,title:_})=>e.jsx("th",{onClick:()=>he(v),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:_}),M?.key===v&&e.jsx(rs,{className:"w-4 h-4 ml-2"})]})});return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{id:"recaptcha-container"}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"회원 관리"}),e.jsx("p",{className:"text-gray-600",children:"사용자 추가, 수정, 삭제"})]}),e.jsxs("button",{onClick:$,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"새 사용자 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:j,onChange:v=>S(v.target.value),className:"border rounded-lg px-2 py-1 text-sm",children:[e.jsx("option",{value:"name",children:"이름"}),e.jsx("option",{value:"email",children:"이메일"}),e.jsx("option",{value:"phone",children:"전화번호"})]}),e.jsx("input",{value:s,onChange:v=>f(v.target.value),placeholder:"검색어 입력",className:"flex-1 outline-none"})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:x?e.jsxs("div",{className:"flex items-center justify-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"사용자 정보를 불러오는 중..."})]}):we.length===0?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"등록된 사용자가 없습니다."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"새 사용자 추가 버튼을 클릭해서 사용자를 추가해보세요."})]})}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx(de,{columnKey:"name",title:"이름"}),e.jsx(de,{columnKey:"email",title:"이메일"}),e.jsx(de,{columnKey:"phone",title:"전화번호"}),e.jsx(de,{columnKey:"role",title:"권한"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:we.map(v=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:v.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v.phone}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${v.role==="admin"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:v.role})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>ee(v),className:"p-2 text-gray-500 hover:text-green-600 rounded-lg transition-all hover:scale-110",children:e.jsx(ss,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>R(v),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Q(v),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(We,{className:"w-4 h-4"})})]})]},v.id))})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:b?"사용자 정보 수정":"새 사용자 추가"}),e.jsxs("form",{onSubmit:ye,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이름"}),e.jsx("input",{type:"text",name:"name",value:c.name,onChange:te,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이메일"}),e.jsx("input",{type:"email",name:"email",value:c.email,onChange:te,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"전화번호"}),e.jsx("input",{type:"tel",name:"phone",value:c.phone,onChange:te,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["비밀번호 ",b&&"(변경시에만 입력)"]}),e.jsx("input",{type:"password",name:"password",value:c.password,onChange:te,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"권한"}),e.jsxs("select",{name:"role",value:c.role,onChange:te,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:q,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:"저장"})]})]})]})}),p&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 space-y-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["계정 설정: ",h.name]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"휴대폰 인증"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"tel",value:P,onChange:v=>X(st(v.target.value)),placeholder:"휴대폰 번호",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:je,disabled:H,className:"py-3 px-4 bg-gray-200 rounded-xl hover:bg-gray-300 font-medium transition-colors disabled:opacity-50",children:H?"전송중...":"인증코드 받기"})]}),T&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:B,onChange:v=>K(v.target.value),placeholder:"인증 코드 6자리",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:ge,disabled:H,className:"py-3 px-4 bg-green-500 text-white rounded-xl hover:bg-green-600 font-medium transition-colors disabled:opacity-50",children:H?"확인중...":"인증하기"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"이메일 주소 변경"}),e.jsx("input",{type:"email",value:C,onChange:v=>I(v.target.value),placeholder:"새 이메일 주소",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("input",{type:"password",value:E,onChange:v=>G(v.target.value),placeholder:"현재 비밀번호",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:_e,disabled:H,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors disabled:opacity-50",children:H?"변경중...":"이메일 변경"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"button",onClick:le,className:"py-3 px-6 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"닫기"})})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"사용자 삭제 확인"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["정말로 ",e.jsx("strong",{className:"text-red-600",children:y.name})," 사용자를 삭제하시겠습니까?"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>g(null),className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{onClick:re,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl hover:bg-red-600 font-medium transition-colors",children:"삭제"})]})]})})]})},Ls=()=>{const{facilities:t}=Me(),[r,d]=o.useState(!1),[x,m]=o.useState(null),u={name:"",type:"gym",capacity:1,bufferMinutes:0,bookingPolicy:{allowOverlap:!1,maxConcurrent:1,timeSlotMinutes:60}},[n,p]=o.useState(u),D=()=>{m(null),p(u),d(!0)},b=a=>{m(a),p({...a,bookingPolicy:a.bookingPolicy||{allowOverlap:!1,maxConcurrent:1,timeSlotMinutes:60}}),d(!0)},N=()=>{d(!1),m(null)},y=a=>{const{name:l,value:c,type:w}=a.target,C=w==="number";p(I=>({...I,[l]:C?Number(c):c}))},g=async a=>{if(a.preventDefault(),!n.name||n.capacity<=0){alert("시설 이름과 수용 인원을 확인해주세요.");return}try{if(x){const l=ie(U,"facilities",x.id);await qt(l,n),alert("시설 정보가 성공적으로 수정되었습니다.")}else await Gt(Ne(U,"facilities"),n),alert("새 시설이 추가되었습니다.");N()}catch(l){console.error("Error saving facility: ",l),alert("처리 중 오류가 발생했습니다.")}},h=async a=>{if(window.confirm("정말로 이 시설을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{await zt(ie(U,"facilities",a)),alert("시설이 삭제되었습니다.")}catch(l){console.error("Error deleting facility: ",l),alert("삭제 중 오류가 발생했습니다.")}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"시설 관리"}),e.jsx("p",{className:"text-gray-600",children:"체육관 시설을 추가, 수정, 삭제합니다."})]}),e.jsxs("button",{onClick:D,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"새 시설 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"이름"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"종류"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수용 인원"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"버퍼(분)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"중복 정책"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(a=>{const l=a.bookingPolicy,c=l?.allowOverlap?`🔄 중복허용 (최대${l.maxConcurrent||1}팀)`:"🚫 단독사용";return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.capacity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.bufferMinutes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l?.allowOverlap?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:c})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>b(a),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>h(a.id),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(We,{className:"w-4 h-4"})})]})]},a.id)})})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:x?"시설 정보 수정":"새 시설 추가"}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시설 이름"}),e.jsx("input",{type:"text",name:"name",value:n.name,onChange:y,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"수용 인원"}),e.jsx("input",{type:"number",name:"capacity",value:n.capacity,onChange:y,required:!0,min:1,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"버퍼 시간 (분)"}),e.jsx("input",{type:"number",name:"bufferMinutes",value:n.bufferMinutes,onChange:y,required:!0,min:0,className:"w-full p-3 border border-gray-200 rounded-xl"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시설 종류"}),e.jsxs("select",{name:"type",value:n.type,onChange:y,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"gym",children:"체육관"}),e.jsx("option",{value:"court",children:"코트"}),e.jsx("option",{value:"field",children:"운동장"}),e.jsx("option",{value:"pool",children:"수영장"}),e.jsx("option",{value:"room",children:"다목적실"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-3",children:"중복 사용 설정"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:n.bookingPolicy?.allowOverlap||!1,onChange:a=>p(l=>({...l,bookingPolicy:{...l.bookingPolicy,allowOverlap:a.target.checked,maxConcurrent:a.target.checked?l.bookingPolicy?.maxConcurrent||2:1}})),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"중복 사용 허용 (같은 시간에 여러 팀 사용 가능)"})]}),n.bookingPolicy?.allowOverlap&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"최대 동시 사용 팀"}),e.jsx("input",{type:"number",min:"2",max:"10",value:n.bookingPolicy?.maxConcurrent||2,onChange:a=>p(l=>({...l,bookingPolicy:{...l.bookingPolicy,maxConcurrent:parseInt(a.target.value)}})),className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"같은 시간에 이용할 수 있는 최대 팀 수"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:N,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:x?"수정하기":"추가하기"})]})]})]})})]})},Vs={success:e.jsx(os,{className:"w-6 h-6 text-green-500"}),error:e.jsx(ns,{className:"w-6 h-6 text-red-500"}),warning:e.jsx(ls,{className:"w-6 h-6 text-yellow-500"}),info:e.jsx(as,{className:"w-6 h-6 text-blue-500"})},Bs=({notification:t,onRemove:r})=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden mb-4 animate-on-load",style:{animationName:"fadeInRight"},children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:Vs[t.type]}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.message})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{onClick:()=>r(t.id),className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(xt,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})}),Hs=()=>{const{notifications:t,removeNotification:r}=$e();return e.jsx("div",{className:"fixed inset-0 flex items-end justify-end px-4 py-6 pointer-events-none sm:p-6 z-50",children:e.jsx("div",{className:"w-full max-w-sm",children:t.map(d=>e.jsx(Bs,{notification:d,onRemove:r},d.id))})})};function zs(){const{user:t,login:r,logout:d,signup:x,adminLogin:m,googleLogin:u,loading:n}=ds(),{loading:p,syncing:D,bookings:b,setBookings:N,programs:y,setPrograms:g,applications:h,setApplications:a,users:l,setUsers:c,facilities:w}=Me(),[C,I]=o.useState("dashboard");o.useEffect(()=>{t&&!p&&I("dashboard")},[t,p]);const E=async(T,F)=>{try{if(!T.trim()||!F.trim())throw new Error("이메일과 비밀번호를 입력해주세요.");return await r(T,F),[!0,null]}catch(H){return console.error("Login failed:",H),[!1,De(H)]}},G=async(T,F)=>{try{if(!T.trim()||!F.trim())throw new Error("이메일과 비밀번호를 입력해주세요.");return await m(T,F),[!0,null]}catch(H){return console.error("Admin login failed:",H),[!1,De(H)]}},P=async T=>{try{const{name:F,email:H,password:i}=T;if(!F?.trim())throw new Error("이름을 입력해주세요.");if(!H?.trim())throw new Error("이메일을 입력해주세요.");if(!i?.trim())throw new Error("비밀번호를 입력해주세요.");return await x(T),[!0,"회원가입이 완료되었습니다. 이메일 인증을 확인해주세요."]}catch(F){return console.error("Signup failed:",F),[!1,De(F)]}},X=async()=>{try{return await u(),[!0,null]}catch(T){return console.error("Google login failed:",T),[!1,De(T)]}},B=async()=>{await d(),I("dashboard")},K=()=>{if(!t)return null;try{switch(C){case"dashboard":return e.jsx(nt,{currentUser:t,bookings:b,applications:h,programs:y,setActiveTab:I,syncing:D});case"booking":return e.jsx(Ts,{currentUser:t,bookings:b,setBookings:N,syncing:D});case"program":return e.jsx($s,{currentUser:t,programs:y,setPrograms:g,applications:h,setApplications:a});case"admin":return e.jsx(Rs,{currentUser:t,bookings:b,setBookings:N,applications:h,setApplications:a,programs:y,setPrograms:g,users:l,facilities:w});case"userManagement":return e.jsx(Fs,{users:l,setUsers:c});case"facilities":return e.jsx(Ls,{});default:return e.jsx(nt,{currentUser:t,bookings:b,applications:h,programs:y,setActiveTab:I,syncing:D})}}catch(T){return console.error("Component rendering error:",T),e.jsx("div",{className:"min-h-96 bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"화면을 불러오는 중 오류가 발생했습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"다른 메뉴를 선택하거나 페이지를 새로고침해주세요."}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>I("dashboard"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"대시보드로 이동"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"새로고침"})]})]})})}};return p||n?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Hs,{}),t?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(gs,{currentUser:t,activeTab:C,setActiveTab:I,onLogout:B}),e.jsx("main",{children:K()})]}):e.jsx(hs,{onLogin:E,onSignup:P,onAdminLogin:G,onGoogleLogin:X})]})}const mt=document.getElementById("root");mt?wt.createRoot(mt).render(e.jsx(vt.StrictMode,{children:e.jsx(ms,{children:e.jsx(zs,{})})})):console.error("Failed to find the root element");
