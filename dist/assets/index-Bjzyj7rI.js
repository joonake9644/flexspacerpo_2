const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DashboardCalendar-BaHUwOCs.js","./react-C1G-q6RG.js","./icons-CTQcQIqG.js"])))=>i.map(i=>d[i]);
import{r as l,j as e,R as vt,a as Nt}from"./react-C1G-q6RG.js";import{g as Ke,i as Dt,a as it,b as Ct,c as St,d as Be,e as kt,f as Et,h as Tt,j as Pt,k as At,l as _t,o as Mt,s as Je,m as De,n as se,p as Ce,q as ge,r as $t,u as Xe,t as pe,v as oe,G as It,w as Ot,x as be,y as ue,z as Le,A as Fe,B as Lt,C as Se,R as Ft,D as Rt,E as Vt,F as Bt,H as zt,I as Ht,J as qt,K as Gt}from"./firebase-DnP1Uaxu.js";import{U as ee,a as Wt,M as Ve,P as Ut,L as Re,b as Kt,B as Jt,c as Xt,H as Ye,C as Y,d as de,S as Ze,e as Qe,X as ot,f as Yt,g as Zt,h as ce,i as Qt,j as es,k as ts,l as ss,m as rs,n as ct,o as as,p as ze,T as He,q as qe,r as ls,A as ns,I as is,s as os,t as cs,u as ds}from"./icons-CTQcQIqG.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))h(c);new MutationObserver(c=>{for(const m of c)if(m.type==="childList")for(const o of m.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&h(o)}).observe(document,{childList:!0,subtree:!0});function i(c){const m={};return c.integrity&&(m.integrity=c.integrity),c.referrerPolicy&&(m.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?m.credentials="include":c.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function h(c){if(c.ep)return;c.ep=!0;const m=i(c);fetch(c.href,m)}})();const fe={};console.log("Firebase Config Debug:",{hasApiKey:!0,hasAuthDomain:!0,hasProjectId:!0,NODE_ENV:"production"});const ms={apiKey:"AIzaSyBvlPy3BOyrRCokGAHkzuX6IoVZNjWTU-0",authDomain:"flexspaceprowin.firebaseapp.com",projectId:"flexspaceprowin",storageBucket:"flexspaceprowin.firebasestorage.app",messagingSenderId:"545144229496",appId:"1:545144229496:web:a833b961cf4b8a7ce9678d",measurementId:"G-D81Q76VKZQ"};let me;try{me=Ke().length?Ke()[0]:Dt(ms),console.log("Firebase initialized successfully")}catch(t){throw console.error("Firebase initialization failed:",t),t}const B=it(me),G=Ct(me),dt=St(me),mt=Be(me),xs=fe?.VITE_USE_EMULATOR==="true";if(xs){const t=fe?.VITE_EMULATOR_HOST||"127.0.0.1",s=Number(fe?.VITE_EMULATOR_AUTH_PORT||9099),i=Number(fe?.VITE_EMULATOR_FIRESTORE_PORT||8080),h=Number(fe?.VITE_EMULATOR_STORAGE_PORT||9199);try{kt(B,`http://${t}:${s}`,{disableWarnings:!0})}catch{}try{Et(G,t,i)}catch{}try{Tt(dt,t,h)}catch{}try{Pt(mt,t,5001)}catch{}}At().then(t=>t?_t(me):null).catch(()=>null);const xt=me,re=Object.freeze(Object.defineProperty({__proto__:null,auth:B,db:G,default:xt,functions:mt,storage:dt},Symbol.toStringTag,{value:"Module"})),us=()=>{const[t,s]=l.useState(null),[i,h]=l.useState(!1),[c,m]=l.useState(!0);l.useEffect(()=>{m(!0);const a=Mt(B,async n=>{try{if(!n){s(null),h(!1);return}h(n.emailVerified);const d=se(G,"users",n.uid),p=await De(d);let v="user",S=n.displayName||(n.email?.split("@")[0]??"user"),E;if(p.exists()){const u=p.data();v=u.role||"user",S=u.name||S,E=u.phone}else{const u={name:S,email:n.email??"",phone:null,role:"user",isActive:!0,createdAt:oe(),updatedAt:oe()};await pe(d,u),console.log("새 사용자 정보를 users 컬렉션에 추가:",n.uid)}s({id:n.uid,name:S,email:n.email??"",phone:E,role:v})}catch(d){console.error("Auth state change error:",d),n&&s({id:n.uid,name:n.email?.split("@")[0]??"user",email:n.email??"",role:"user"})}finally{m(!1)}});return()=>a()},[]);const o=l.useCallback(async(a,n)=>{try{const d=await Je(B,a,n),p=await De(se(G,"users",d.user.uid)),S=(p.exists()?p.data():null)?.adminCreated===!0;if(!d.user.emailVerified&&!S){try{await Ce(d.user,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(E){console.warn("이메일 인증 재전송 실패:",E)}throw await ge(B),new Error("이메일 인증이 필요합니다. 새로운 인증 메일을 발송했습니다. 이메일함을 확인해주세요.")}return!0}catch(d){throw console.error("Login error:",d),d}},[]),b=l.useCallback(async(a,n)=>{try{const d=await Je(B,a,n);if(!(a==="admin@flexspace.test"||a==="flexadmin@test.com"||a==="joonake@naver.com"||a==="uu@naver.com")&&!d.user.emailVerified){try{await Ce(d.user,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(T){console.warn("관리자 이메일 인증 재전송 실패:",T)}throw await ge(B),new Error("이메일 인증이 필요합니다. 새로운 인증 메일을 발송했습니다. 이메일함을 확인해주세요.")}const v=se(G,"users",d.user.uid),S=await De(v),E=S.exists()?S.data():{},u=E.role;if(console.log("Admin login - User data:",{uid:d.user.uid,email:d.user.email,firestoreExists:S.exists(),role:u,allData:E}),u!=="admin")throw await ge(B),new Error(`관리자 권한이 없습니다. 현재 권한: ${u||"없음"}`);return!0}catch(d){throw console.error("Admin login error:",d),d}},[]),C=l.useCallback(async a=>{try{const{name:n,email:d,phone:p,password:v}=a;if(!d||!v)throw new Error("이메일과 비밀번호가 필요합니다.");if(v.length<6)throw new Error("비밀번호는 6자 이상이어야 합니다.");const S=await $t(B,d,v);await Xe(S.user,{displayName:n||d.split("@")[0]});const E=se(G,"users",S.user.uid);await pe(E,{name:n||(d.split("@")[0]??"user"),email:d,phone:p||null,role:"user",isActive:!0,createdAt:oe(),updatedAt:oe()},{merge:!0});try{await Ce(S.user,{url:`${window.location.origin}/`,handleCodeInApp:!1}),console.log("이메일 인증 메일 전송 성공:",d)}catch(u){console.warn("이메일 인증 메일 전송 실패:",u)}return await ge(B),!0}catch(n){throw console.error("Signup error:",n),n}},[]),f=l.useCallback(async()=>{try{const a=new It;a.addScope("email"),a.addScope("profile"),a.setCustomParameters({prompt:"select_account"});const d=(await Ot(B,a)).user;if(console.log("Google login success:",{uid:d.uid,email:d.email,displayName:d.displayName,emailVerified:d.emailVerified}),!d.email)throw new Error("Google 계정에서 이메일 정보를 가져올 수 없습니다.");const p=se(G,"users",d.uid);let v={name:d.displayName||d.email.split("@")[0]||"user",email:d.email,phone:d.phoneNumber||null,role:"user",isActive:!0,updatedAt:oe()};try{(await De(p)).exists()?(await pe(p,v,{merge:!0}),console.log("Google 로그인: 기존 사용자 정보 업데이트됨:",d.uid)):(await pe(p,{...v,createdAt:oe()}),console.log("Google 로그인: 새 사용자 정보 저장됨:",d.uid))}catch(S){console.warn("Firestore 저장 실패, 하지만 로그인은 계속 진행:",S)}return!0}catch(a){throw console.error("Google login error:",a),a.code==="auth/popup-closed-by-user"||a.code==="auth/cancelled-popup-request"?new Error("Google 로그인이 취소되었습니다."):a.code==="auth/popup-blocked"?new Error("팝업이 차단되었습니다. 브라우저 설정에서 팝업을 허용해주세요."):a.code==="auth/network-request-failed"?new Error("네트워크 연결을 확인해주세요."):new Error(`Google 로그인 실패: ${a.message||"알 수 없는 오류"}`)}},[]),w=l.useCallback(async()=>{if(B.currentUser)return await Ce(B.currentUser),!0;throw new Error("로그인이 필요합니다.")},[]),x=l.useCallback(async(a,n)=>{if(B.currentUser){await Xe(B.currentUser,{displayName:a,photoURL:n});const d=se(G,"users",B.currentUser.uid);return await pe(d,{name:a||B.currentUser.displayName,updatedAt:oe()},{merge:!0}),!0}throw new Error("로그인이 필요합니다.")},[]),y=l.useCallback(async()=>{await ge(B),s(null),h(!1)},[]);return l.useMemo(()=>({user:t,login:o,logout:y,signup:C,adminLogin:b,googleLogin:f,sendVerificationEmail:w,updateUserProfile:x,emailVerified:i,loading:c}),[t,o,y,C,b,f,w,x,i,c])},ye=()=>{const[t,s]=l.useState(!0),[i,h]=l.useState(!1),c=l.useRef(null),[m,o]=l.useState([]),[b,C]=l.useState([]),[f,w]=l.useState([]),[x,y]=l.useState([]),[a,n]=l.useState([]),d=()=>{h(!0),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{h(!1)},500)};return l.useEffect(()=>{const p=[];let v=0;const S=5,E=()=>{v++,v>=S&&s(!1)};return p.push(be(ue(G,"users"),u=>{const T=u.docs.map(N=>({id:N.id,...N.data()}));y(N=>(N.length>0&&d(),T)),E()},u=>{console.error("Error fetching users:",u),E()})),p.push(be(Le(ue(G,"bookings"),Fe("createdAt","desc")),u=>{const T=u.docs.map(N=>({id:N.id,...N.data()}));o(N=>(N.length>0&&d(),T)),E()},u=>{console.error("Error fetching bookings:",u),E()})),p.push(be(Le(ue(G,"programs"),Fe("startDate","asc")),u=>{const T=u.docs.map(N=>({id:N.id,...N.data()}));C(N=>(N.length>0&&d(),T)),E()},u=>{console.error("Error fetching programs:",u),E()})),p.push(be(Le(ue(G,"program_applications"),Fe("appliedAt","desc")),u=>{const T=u.docs.map(N=>({id:N.id,...N.data()}));w(N=>(N.length>0&&d(),T)),E()},u=>{console.error("Error fetching applications:",u),E()})),p.push(be(ue(G,"facilities"),u=>{const T=u.docs.map(N=>({id:N.id,...N.data()}));n(N=>(N.length>0&&d(),T)),E()},u=>{console.error("Error fetching facilities:",u),E()})),()=>{p.forEach(u=>u()),c.current&&clearTimeout(c.current)}},[]),l.useMemo(()=>({loading:t,syncing:i,bookings:m,setBookings:o,programs:b,setPrograms:C,applications:f,setApplications:w,users:x,setUsers:y,facilities:a}),[t,i,m,b,f,x,a])},et=t=>{const s=t.replace(/\D/g,"");return s.length<=3?s:s.length<=7?`${s.slice(0,3)}-${s.slice(3)}`:`${s.slice(0,3)}-${s.slice(3,7)}-${s.slice(7,11)}`},tt=t=>({"auth/user-not-found":"미가입자입니다. 회원가입을 해주세요.","auth/wrong-password":"비밀번호가 일치하지 않습니다.","auth/email-already-in-use":"이미 사용 중인 이메일입니다.","auth/weak-password":"비밀번호가 너무 간단합니다. 6자 이상 입력해주세요.","auth/invalid-email":"올바른 이메일 형식이 아닙니다.","auth/invalid-credential":"이메일 또는 비밀번호가 잘못되었습니다. 미가입자는 회원가입을 먼저 해주세요.","auth/invalid-login-credentials":"로그인 정보가 잘못되었습니다. 미가입자는 회원가입을 먼저 해주세요.","auth/too-many-requests":"로그인 시도가 너무 많습니다. 잠시 후 다시 시도하거나 브라우저 캐시를 삭제해 주세요.","firestore/permission-denied":"접근 권한이 없습니다.","firestore/unavailable":"서비스가 일시적으로 사용 불가합니다.","firestore/deadline-exceeded":"요청 시간이 초과되었습니다.","storage/unauthorized":"파일 업로드 권한이 없습니다.","storage/object-not-found":"파일을 찾을 수 없습니다.","storage/quota-exceeded":"저장소 용량이 초과되었습니다.","functions/permission-denied":"함수 실행 권한이 없습니다.","functions/unavailable":"서버 함수가 일시적으로 사용 불가합니다."})[t]||"로그인에 실패했습니다. 이메일/비밀번호를 확인하거나 회원가입을 먼저 진행해주세요.",he=t=>{const s=t instanceof Error?t.message:String(t),i=s.match(/auth\/([\w-]+)/);return i&&i[0]?tt(i[0]):tt(s)},ut=l.createContext(void 0),hs=({children:t})=>{const[s,i]=l.useState([]),h=l.useCallback(m=>{i(o=>o.filter(b=>b.id!==m))},[]),c=l.useCallback((m,o="info",b=5e3)=>{const C=`notification-${Date.now()}-${Math.random()}`,f={id:C,message:m,type:o,duration:b};i(w=>[...w,f]),b>0&&setTimeout(()=>{h(C)},b)},[h]);return e.jsx(ut.Provider,{value:{notifications:s,showNotification:c,removeNotification:h},children:t})},je=()=>{const t=l.useContext(ut);if(t===void 0)throw new Error("useNotification must be used within a NotificationProvider");return t},gs=({email:t,setEmail:s,onSendLink:i,onCancel:h,submitting:c})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"forgot-password-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{id:"forgot-password-title",className:"text-xl font-bold text-gray-900 mb-2",children:"비밀번호 재설정 / Password Reset"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"가입 시 사용한 이메일 주소를 입력하세요. 재설정 링크를 보내드립니다."}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email","aria-label":"Email for password reset",value:t,onChange:m=>s(m.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:h,className:"flex-1 py-3 px-4 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all font-medium",children:"취소"}),e.jsx("button",{onClick:i,disabled:c,className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl border-2 border-transparent hover:bg-blue-600 hover:border-blue-700 transition-all font-medium",children:c?"전송 중...":"재설정 링크 보내기"})]})]})}),ps=({onConfirm:t,onCancel:s,errorText:i})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"agreement-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-2xl w-full mx-4",children:[e.jsx("h3",{id:"agreement-title",className:"text-xl font-bold text-gray-900 mb-4",children:"개인정보 수집 및 이용 동의"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"FlexSpace Pro 서비스 제공을 위해 아래와 같이 개인정보를 수집 및 이용합니다."}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"구분"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"수집 항목"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"수집 및 이용 목적"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"보유 및 이용 기간"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:"필수"}),e.jsx("td",{className:"px-4 py-3",children:"이름, 이메일"}),e.jsx("td",{className:"px-4 py-3",children:"회원 식별 및 관리, 서비스 제공 및 공지사항 전달"}),e.jsx("td",{className:"px-4 py-3",children:"회원 탈퇴 시까지"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:"선택"}),e.jsx("td",{className:"px-4 py-3",children:"전화번호"}),e.jsx("td",{className:"px-4 py-3",children:"체육관 대관 시 긴급 연락 및 알림"}),e.jsx("td",{className:"px-4 py-3",children:"회원 탈퇴 시까지"})]})]})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"※ 선택 항목을 동의하지 않아도 회원가입 및 기본 서비스 이용이 가능합니다. 단, 해당 정보가 필요한 일부 서비스(예: 대관 알림) 이용에 제한이 있을 수 있습니다."}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 font-medium",children:"필수 항목에 동의하지 않으면 회원가입이 제한됩니다."}),i&&e.jsx("p",{className:"text-sm text-red-600 mt-4 text-right",children:i}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 rounded-xl border",children:"취소"}),e.jsx("button",{onClick:t,className:"px-4 py-2 rounded-xl bg-blue-600 text-white",children:"동의하고 계속하기"})]})]})}),bs=({onLogin:t,onSignup:s,onAdminLogin:i,onGoogleLogin:h})=>{const{showNotification:c}=je(),[m,o]=l.useState("login"),[b,C]=l.useState(""),[f,w]=l.useState(""),[x,y]=l.useState(""),[a,n]=l.useState(""),[d,p]=l.useState(""),[v,S]=l.useState(!1),[E,u]=l.useState(!1),[T,N]=l.useState(""),[R,P]=l.useState(!1),[_,A]=l.useState(""),V=async()=>{if(!T){c("이메일을 입력해주세요.","error");return}P(!0);try{await Lt(B,T),c("비밀번호 재설정 이메일을 보냈습니다. 이메일 함을 확인해주세요.","success"),u(!1)}catch(r){const g=he(r);c(g,"error")}finally{P(!1)}},D=async()=>{const r=d.replace(/-/g,"");P(!0),A("");try{const[g,k]=await s({name:b,email:f,password:x,phone:r});g?(S(!1),c(k||"회원가입이 완료되었습니다. 이메일 인증을 확인해주세요.","success"),o("login"),y(""),n("")):A(k||"회원가입에 실패했습니다. 입력 정보를 확인해주세요.")}finally{P(!1)}},I=async r=>{if(r.preventDefault(),m==="signup"){if(!b.trim()){c("이름을 입력해주세요.","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f)){c("유효하지 않은 이메일 형식입니다.","error");return}if(x.length<6){c("비밀번호는 6자 이상이어야 합니다.","error");return}if(x!==a){c("비밀번호가 일치하지 않습니다.","error");return}}if(m!=="signup"){if(!f.trim()){c("이메일을 입력해주세요.","error");return}if(!x.trim()){c("비밀번호를 입력해주세요.","error");return}}P(!0);try{if(m==="login"){const[g,k]=await t(f,x);g?c("로그인에 성공했습니다.","success"):(c(k||"로그인에 실패했습니다. 이메일/비밀번호를 확인해주세요.","error"),k&&(k.includes("미가입자")||k.includes("회원가입을 먼저"))&&setTimeout(()=>{o("signup"),c("회원가입 페이지로 이동합니다.","info")},2e3))}else if(m==="admin_login"){const[g,k]=await i(f,x);g?c("관리자로 로그인되었습니다.","success"):c(k||"관리자 로그인에 실패했습니다. 자격을 확인해주세요.","error")}else S(!0)}finally{P(!1)}},te=r=>{const g=r.replace(/[^0-9]/g,"");return g.length<=3?g:g.length<=7?`${g.slice(0,3)}-${g.slice(3)}`:`${g.slice(0,3)}-${g.slice(3,7)}-${g.slice(7,11)}`};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:[e.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-sm border border-gray-100 p-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center mr-2",children:e.jsx(ee,{className:"w-6 h-6 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"FlexSpace Pro"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{type:"button",onClick:()=>o("login"),className:`flex-1 py-2 rounded-xl border ${m==="login"?"bg-blue-50 text-blue-700 border-blue-200":"bg-white"}`,children:"로그인"}),e.jsx("button",{type:"button",onClick:()=>o("signup"),className:`flex-1 py-2 rounded-xl border ${m==="signup"?"bg-purple-50 text-purple-700 border-purple-200":"bg-white"}`,children:"회원가입"}),e.jsx("button",{type:"button",onClick:()=>o("admin_login"),className:`flex-1 py-2 rounded-xl border ${m==="admin_login"?"bg-green-50 text-green-700 border-green-200":"bg-white"}`,children:"관리자"})]}),e.jsxs("form",{onSubmit:I,children:[m==="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Wt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 / Name",value:b,onChange:r=>C(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email",value:f,onChange:r=>w(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ut,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"tel",placeholder:"전화번호 (선택) / Phone (Optional)",value:d,onChange:r=>p(te(r.target.value)),maxLength:13,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Re,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 / Password",value:x,onChange:r=>y(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(Re,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 확인 / Confirm Password",value:a,onChange:r=>n(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]})]}),m!=="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ve,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email",value:f,onChange:r=>w(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(Re,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 / Password",value:x,onChange:r=>y(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),m==="login"&&e.jsx("div",{className:"text-right mb-4",children:e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>{u(!0),N(f)},children:"비밀번호 재설정"})})]}),e.jsxs("button",{type:"submit",disabled:R,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl border-2 border-transparent hover:bg-blue-600 hover:border-blue-700 transition-all font-semibold",children:[m==="login"&&"로그인 / Login",m==="signup"&&"회원가입 / Sign Up",m==="admin_login"&&"관리자 로그인 / Admin Login"]})]}),m!=="admin_login"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-6 flex items-center",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"px-4 text-sm text-gray-500",children:"또는"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsxs("button",{type:"button",onClick:async()=>{P(!0);try{const[r,g]=await h();r?c("Google 로그인에 성공했습니다.","success"):c(g||"Google 로그인에 실패했습니다.","error")}finally{P(!1)}},disabled:R,className:"w-full py-3 px-4 border border-gray-300 rounded-xl hover:bg-gray-50 transition-all font-medium flex items-center justify-center gap-3",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Google로 ",m==="login"?"로그인":"가입하기"]})]})]}),v&&e.jsx(ps,{onConfirm:D,onCancel:()=>S(!1),errorText:_}),E&&e.jsx(gs,{email:T,setEmail:N,onSendLink:V,onCancel:()=>u(!1),submitting:R})]})},fs=Be();function ys(t){const s="=".repeat((4-t.length%4)%4),i=(t+s).replace(/\-/g,"+").replace(/_/g,"/"),h=window.atob(i),c=new Uint8Array(h.length);for(let m=0;m<h.length;++m)c[m]=h.charCodeAt(m);return c}const js=Se(fs,"subscribeToPush");function ws(){const[t,s]=l.useState(!1),[i,h]=l.useState(!1),[c,m]=l.useState(null),[o,b]=l.useState(null),[C,f]=l.useState(!0);return l.useEffect(()=>{"serviceWorker"in navigator&&"PushManager"in window?(s(!0),navigator.serviceWorker.ready.then(x=>{x.pushManager.getSubscription().then(y=>{y&&(h(!0),m(y)),f(!1)})})):f(!1)},[]),{isSupported:t,isSubscribed:i,subscription:c,subscribe:async()=>{if(!t){b(new Error("?몄떆 ?뚮┝??吏?먮릺吏 ?딅뒗 釉뚮씪?곗??낅땲??"));return}try{const x=await navigator.serviceWorker.register("/sw.js"),y="BPUSPTkxzpJSvhJ4krhwlP0K6U0p_B9xJ3fSgyDWpb4VdbceR571GFI9eOH4tgh4I64IXO9ZywTS4ihtabf1z_8",a=await x.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ys(y)});return await js({subscription:a.toJSON()}),m(a),h(!0),b(null),a}catch(x){throw console.error("?몄떆 援щ룆 ?ㅽ뙣:",x),b(x),x}},error:o,loading:C}}const vs=()=>{const{isSubscribed:t,subscribe:s,loading:i,error:h}=ws();return i?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 flex items-center",disabled:!0,children:[e.jsx(Kt,{className:"w-4 h-4 mr-2 animate-spin"}),"알림 상태 확인 중..."]}):t?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 flex items-center",disabled:!0,children:[e.jsx(Jt,{className:"w-4 h-4 mr-2"}),"알림이 활성화되었습니다"]}):h?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-red-700 flex items-center",disabled:!0,children:[e.jsx(XCircle,{className:"w-4 h-4 mr-2"}),"알림을 활성화할 수 없습니다"]}):e.jsxs("button",{onClick:s,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(Xt,{className:"w-4 h-4 mr-2"}),"알림 활성화하기"]})},Ns=({currentUser:t,activeTab:s,setActiveTab:i,onLogout:h})=>{const[c,m]=l.useState(!1),[o,b]=l.useState(!1),C=l.useRef(null),f="flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-200",w={dashboard:"bg-blue-50 text-blue-600 font-semibold",booking:"bg-blue-50 text-blue-600 font-semibold",program:"bg-purple-50 text-purple-600 font-semibold",admin:"bg-green-50 text-green-600 font-semibold",userManagement:"bg-yellow-50 text-yellow-700 font-semibold",facilities:"bg-indigo-50 text-indigo-600 font-semibold"},x="text-gray-600 hover:bg-gray-100 hover:text-gray-900 hover:-translate-y-px";l.useEffect(()=>{const a=n=>{C.current&&!C.current.contains(n.target)&&m(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const y=a=>{i(a),b(!1)};return e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-0 z-40",children:[e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(ee,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:"FlexSpace Pro"})]}),e.jsxs("nav",{className:"hidden md:flex space-x-2",children:[e.jsxs("button",{onClick:()=>y("dashboard"),className:`${f} ${s==="dashboard"?w.dashboard:x}`,children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{children:"대시보드 / Dashboard"})]}),e.jsxs("button",{onClick:()=>y("booking"),className:`${f} ${s==="booking"?w.booking:x}`,children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"체육관 대관 / Booking"})]}),e.jsxs("button",{onClick:()=>y("program"),className:`${f} ${s==="program"?w.program:x}`,children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"프로그램 / Program"})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y("admin"),className:`${f} ${s==="admin"?w.admin:x}`,children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{children:"운영 관리 / Operations"})]}),e.jsxs("button",{onClick:()=>y("facilities"),className:`${f} ${s==="facilities"?w.facilities:x}`,children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{children:"시설 관리 / Facilities"})]}),e.jsxs("button",{onClick:()=>y("userManagement"),className:`${f} ${s==="userManagement"?w.userManagement:x}`,children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"회원 관리 / Users"})]})]})]}),e.jsx("button",{onClick:()=>b(!o),className:"md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors",children:o?e.jsx(ot,{className:"w-5 h-5"}):e.jsx(Yt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",ref:C,children:[e.jsxs("button",{onClick:()=>m(!c),className:"flex items-center space-x-2 cursor-pointer p-2 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("span",{className:"text-sm text-gray-600 font-medium hidden sm:block",children:[t.name," (",t.role==="admin"?"관리자":"사용자",")"]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600",children:t.name.charAt(0).toUpperCase()})]}),c&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 origin-top-right animate-on-load",style:{animationName:"fadeInUp",animationDuration:"0.2s"},children:e.jsxs("div",{className:"py-1",role:"menu","aria-orientation":"vertical","aria-labelledby":"options-menu",children:[e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-700 border-b",children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.email})]}),e.jsxs("div",{className:"py-1",children:[e.jsx(vs,{}),e.jsxs("button",{onClick:h,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",role:"menuitem",children:[e.jsx(Zt,{className:"w-4 h-4 mr-2"}),"로그아웃 / Logout"]})]})]})})]})]}),o&&e.jsx("div",{className:"md:hidden bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-2 space-y-1",children:[e.jsxs("button",{onClick:()=>y("dashboard"),className:`w-full text-left ${f} ${s==="dashboard"?w.dashboard:x}`,children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{children:"대시보드 / Dashboard"})]}),e.jsxs("button",{onClick:()=>y("booking"),className:`w-full text-left ${f} ${s==="booking"?w.booking:x}`,children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"체육관 대관 / Booking"})]}),e.jsxs("button",{onClick:()=>y("program"),className:`w-full text-left ${f} ${s==="program"?w.program:x}`,children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"프로그램 / Program"})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y("admin"),className:`w-full text-left ${f} ${s==="admin"?w.admin:x}`,children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{children:"운영 관리 / Operations"})]}),e.jsxs("button",{onClick:()=>y("facilities"),className:`w-full text-left ${f} ${s==="facilities"?w.facilities:x}`,children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{children:"시설 관리 / Facilities"})]}),e.jsxs("button",{onClick:()=>y("userManagement"),className:`w-full text-left ${f} ${s==="userManagement"?w.userManagement:x}`,children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"회원 관리 / Users"})]})]})]})})]})},Ds="modulepreload",Cs=function(t,s){return new URL(t,s).href},st={},z=function(s,i,h){let c=Promise.resolve();if(i&&i.length>0){let f=function(w){return Promise.all(w.map(x=>Promise.resolve(x).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};const o=document.getElementsByTagName("link"),b=document.querySelector("meta[property=csp-nonce]"),C=b?.nonce||b?.getAttribute("nonce");c=f(i.map(w=>{if(w=Cs(w,h),w in st)return;st[w]=!0;const x=w.endsWith(".css"),y=x?'[rel="stylesheet"]':"";if(!!h)for(let d=o.length-1;d>=0;d--){const p=o[d];if(p.href===w&&(!x||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${w}"]${y}`))return;const n=document.createElement("link");if(n.rel=x?"stylesheet":Ds,x||(n.as="script"),n.crossOrigin="",n.href=w,C&&n.setAttribute("nonce",C),document.head.appendChild(n),x)return new Promise((d,p)=>{n.addEventListener("load",d),n.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${w}`)))})}))}function m(o){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=o,window.dispatchEvent(b),!b.defaultPrevented)throw o}return c.then(o=>{for(const b of o||[])b.status==="rejected"&&m(b.reason);return s().catch(m)})},Ss=l.lazy(()=>z(()=>import("./DashboardCalendar-BaHUwOCs.js"),__vite__mapDeps([0,1,2]),import.meta.url)),ks=t=>{const s=new Date;s.setHours(0,0,0,0);const i=new Date(t.startDate);i.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=i&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((i.getTime()-s.getTime())/(1e3*60*60*24))}},rt=({status:t})=>{const s={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"},cancelled:{text:"취소됨 / Cancelled",color:"bg-gray-100 text-gray-800"}},{text:i,color:h}=s[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${h}`,children:i})},ht=["일","월","화","수","목","금","토"],Es=t=>{const{startDate:s,endDate:i,recurrenceRule:h}=t;if(s===i)return s;let c="";return h&&h.days.length>0&&(c=` (매주 / Every ${h.days.sort().map(m=>ht[m]).join(", ")})`),`${s} ~ ${i}${c}`},Ts=t=>`${t.scheduleDays.sort().map(i=>ht[i]).join(",")} ${t.startTime}-${t.endTime}`,at=({currentUser:t,bookings:s=[],applications:i=[],programs:h=[],setActiveTab:c,syncing:m=!1})=>{const{users:o}=ye(),b=l.useMemo(()=>s.filter(a=>a.userId===t.id).sort((a,n)=>new Date(n.startDate).getTime()-new Date(a.startDate).getTime()),[s,t.id]),C=l.useMemo(()=>i.filter(a=>a.userId===t.id).sort((a,n)=>{const d=a.appliedAt?.toDate?a.appliedAt.toDate():new Date(a.appliedAt||0);return(n.appliedAt?.toDate?n.appliedAt.toDate():new Date(n.appliedAt||0)).getTime()-d.getTime()}),[i,t.id]),f=l.useMemo(()=>s.filter(a=>a.status==="pending"),[s]),w=l.useMemo(()=>i.filter(a=>a.status==="pending"),[i]),[x,y]=l.useState("month");return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:t.role==="admin"?"관리자 대시보드 / Admin Dashboard":"마이 대시보드 / My Dashboard"}),e.jsx("p",{className:"text-gray-600",children:t.role==="admin"?"체육관 운영 현황을 한눈에 확인하세요 / Check gym operational status at a glance":"나의 예약과 프로그램 신청 현황입니다 / View your booking and program application status"})]}),m&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"동기화 중..."})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:t.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"대기중인 대관 / Pending Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:f.length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"대기중인 프로그램 신청 / Pending Applications"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:w.length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"운영중인 프로그램 / Active Programs"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.filter(a=>{const n=new Date;return new Date(a.endDate)>=n}).length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"총 이용자 수 / Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:o.length})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center",children:e.jsx(ee,{className:"w-6 h-6 text-blue-600"})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"나의 대관 / My Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:b.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"나의 프로그램 신청 / My Applications"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:C.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"운영중인 프로그램 / Active Programs"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.length})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"최근 대관 신청 / Recent Bookings"}),e.jsxs("div",{className:"space-y-4",children:[(t.role==="admin"?s.slice(0,3):b.slice(0,3)).map(a=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100 border-l-4 border-blue-500",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a.purpose}),e.jsx(rt,{status:a.status})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),a.organization&&`${a.organization} | `,Es(a)," ",a.startTime,"-",a.endTime]}),t.role==="admin"&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"신청자: ",a.userName," (",a.userEmail,")"]}),e.jsxs("p",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(de,{className:"w-4 h-4"}),a.category==="class"?"수업":a.category==="event"?"행사":a.category==="personal"?"개인":"동아리"," | ",a.numberOfParticipants,"명"]})]})]})})},a.id)),(t.role==="admin"?s:b).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"대관 신청 내역이 없습니다."})]}),(t.role==="admin"?s:b).length>3&&e.jsx("button",{onClick:()=>c("booking"),className:"w-full mt-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"전체 보기"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t.role==="admin"?"프로그램 신청 현황 / Program Applications":"내 프로그램 / My Programs"}),e.jsxs("div",{className:"space-y-4",children:[(t.role==="admin"?i.slice(0,3):C.slice(0,3)).map(a=>{const n=h.find(p=>p.id===a.programId),d=n?ks(n):null;return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100 border-l-4 border-purple-500",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:n?.title||a.programTitle||"Unknown Program"}),d&&d.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",d.dDay]}),e.jsx(rt,{status:a.status})]}),n&&e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"강사: ",n.instructor," | 기간: ",n.startDate," ~ ",n.endDate]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"일정: ",Ts(n)]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),"비용: ",n.fee?`${n.fee.toLocaleString()}원`:"무료"," | 정원: ",n.enrolled??0," / ",n.capacity,"명"]})]}),t.role==="admin"&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"신청자: ",a.userName," | 신청일: ",(a.appliedAt?.toDate?a.appliedAt.toDate():new Date(a.appliedAt||0)).toLocaleDateString()]})]})})},a.id)}),(t.role==="admin"?i:C).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"프로그램 신청 내역이 없습니다."})]}),(t.role==="admin"?i:C).length>3&&e.jsx("button",{onClick:()=>c("program"),className:"w-full mt-4 py-2 text-sm font-medium text-purple-600 hover:text-purple-800 transition-colors",children:"전체 보기"})]})]}),e.jsxs("div",{id:"dashboard-calendar-section",className:"mt-6 bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"전체 일정 캘린더 / Full Schedule Calendar"}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"text-gray-500",children:"캘린더 로딩 중..."}),children:e.jsx(Ss,{bookings:t.role==="admin"?s:b,programs:h,view:x,setView:y})})]})]})},Ge=Be(xt),Ps=({value:t,onChange:s,min:i=1,max:h})=>{const c=()=>{const b=t+1;(h===void 0||b<=h)&&s(b)},m=()=>{const b=t-1;(i===void 0||b>=i)&&s(b)},o=b=>{const C=parseInt(b.target.value.replace(/[^0-9]/g,""),10);isNaN(C)?b.target.value===""&&s(i):(i===void 0||C>=i)&&(h===void 0||C<=h)?s(C):i!==void 0&&C<i&&s(i)};return e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:t,onChange:o,className:"w-full p-3 border border-gray-200 rounded-xl text-center"}),e.jsxs("div",{className:"absolute right-2 flex flex-col",children:[e.jsx("button",{type:"button",onClick:c,className:"p-1 text-gray-500 hover:text-gray-800",children:e.jsx(Qt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:m,className:"p-1 text-gray-500 hover:text-gray-800",children:e.jsx(es,{className:"w-4 h-4"})})]})]})},As=Se(Ge,"createBooking"),_s=l.memo(({status:t})=>{const s={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"},cancelled:{text:"취소됨 / Cancelled",color:"bg-gray-100 text-gray-800"}},{text:i,color:h}=s[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${h}`,children:i})}),Ms=["일","월","화","수","목","금","토"],$s=t=>{const{startDate:s,endDate:i,recurrenceRule:h}=t;if(s===i)return s;let c="";return h&&h.days.length>0&&(c=` (매주 / Every ${h.days.sort().map(m=>Ms[m]).join(", ")})`),`${s} ~ ${i}${c}`},lt=l.memo(({booking:t})=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.organization?`${t.organization} | `:"",$s(t)," ",t.startTime,"-",t.endTime]})]}),e.jsx(_s,{status:t.status})]})})),Is=({currentUser:t,bookings:s,setBookings:i,syncing:h=!1})=>{const{facilities:c}=ye(),{showNotification:m}=je(),[o,b]=l.useState({purpose:"",category:"training",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00",facilityId:""}),[C,f]=l.useState(!1),[w,x]=l.useState("list"),[y,a]=l.useState(new Date),n=l.useMemo(()=>s.filter(u=>u.userId===t.id&&u.status!=="completed"),[s,t.id]),d=l.useMemo(()=>s.filter(u=>u.userId===t.id&&u.status==="completed"),[s,t.id]),p=l.useCallback(()=>{const u=y.getFullYear(),T=y.getMonth(),N=new Date(u,T,1),R=new Date(N);R.setDate(R.getDate()-N.getDay());const P=[];for(let _=0;_<42;_++){const A=new Date(R);A.setDate(R.getDate()+_),P.push(A)}return P},[y]),v=l.useCallback(u=>(u.toISOString().split("T")[0],s.filter(T=>{const N=new Date(T.startDate),R=new Date(T.endDate);return u>=N&&u<=R})),[s]),S=l.useCallback(u=>{a(T=>{const N=new Date(T);return N.setMonth(T.getMonth()+(u==="next"?1:-1)),N})},[]),E=l.useCallback(async u=>{u.preventDefault(),f(!0),m("대관 신청을 처리 중입니다...","info");try{if(!o.purpose||o.purpose.trim().length===0){m("대관 목적을 입력해주세요.","error");return}if(o.purpose.trim().length<2){m("대관 목적은 최소 2자 이상 입력해주세요.","error");return}if(!o.category||!o.startDate||!o.endDate||!o.startTime||!o.endTime){m("모든 필수 항목을 입력해주세요.","error");return}const T=new Date(o.startDate),N=new Date(o.endDate),R=new Date;if(R.setHours(0,0,0,0),T<R){m("시작일은 오늘 이후로 선택해주세요.","error");return}if(N<T){m("종료일은 시작일 이후로 선택해주세요.","error");return}if(o.startTime>=o.endTime){m("종료 시간은 시작 시간 이후로 선택해주세요.","error");return}if(!o.facilityId){m("시설을 선택해주세요.","error");return}const P=c.find(g=>g.id===o.facilityId);if(!P){m("선택된 시설을 찾을 수 없습니다.","error");return}const _=P.bookingPolicy,A=_?.allowOverlap||!1,V=_?.maxConcurrent||1,D=s.filter(g=>{if(g.facilityId!==o.facilityId||g.status!=="approved")return!1;const k=new Date(g.startDate),O=new Date(g.endDate),H=new Date(o.startDate),W=new Date(o.endDate);if(!(k<=W&&O>=H))return!1;const[U,M]=g.startTime.split(":").map(Number),[K,Z]=g.endTime.split(":").map(Number),[xe,ke]=o.startTime.split(":").map(Number),[we,ae]=o.endTime.split(":").map(Number),Ee=U*60+M,Te=K*60+Z,Pe=xe*60+ke,Ae=we*60+ae;return Ee<Ae&&Te>Pe});if(!A&&D.length>0){m("이 시설은 단독 사용만 가능합니다. 같은 시간에 다른 예약이 있어 신청할 수 없습니다.","error");return}if(A&&D.length>=V){m(`이 시설은 최대 ${V}팀까지 동시 사용 가능합니다. 현재 ${D.length}팀이 예약되어 있어 추가 신청이 불가합니다.`,"error");return}const I={purpose:o.purpose,category:o.category,numberOfParticipants:o.numberOfParticipants||1,facilityId:P.id,startDate:o.startDate,endDate:o.endDate,startTime:o.startTime,endTime:o.endTime},te=`booking-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r={id:te,...I,userId:t.id,userName:t.name,userEmail:t.email,status:"pending",createdAt:new Date};i(g=>[r,...g]),m("대관 신청이 완료되었습니다! 관리자 승인 후 확정됩니다.","success"),b({purpose:"",category:"training",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00",facilityId:""}),console.log("대관 신청 요청 데이터:",I);try{const g=await As(I);console.log("대관 신청 Firebase 저장 성공:",g),g?.data?.bookingId&&g.data.bookingId!==te&&i(k=>k.map(O=>O.id===te?{...O,id:g.data.bookingId}:O))}catch(g){console.warn("Firebase Function 호출 실패 (사용자는 이미 성공 피드백 받음):",g)}}catch(T){const N=T instanceof Error?T.message:"예약 실패: 알 수 없는 오류";m(N,"error")}finally{f(!1)}},[o,c,m,t,i]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"체육관 대관 / Gym Booking"}),e.jsx("p",{className:"text-gray-600",children:"체육관 공간을 예약하고 관리하세요 / Book and manage gym spaces"}),h&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mt-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs",children:"동기화 중..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>x("list"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="list"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ts,{className:"w-4 h-4"}),"목록 / List"]}),e.jsxs("button",{onClick:()=>x("calendar"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="calendar"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Y,{className:"w-4 h-4"}),"캘린더 / Calendar"]})]})]}),w==="list"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"진행중인 대관 / Active Bookings"}),e.jsxs("div",{className:"space-y-3",children:[n.map(u=>e.jsx(lt,{booking:u},u.id)),n.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"진행중인 대관 신청이 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"완료된 대관 / Completed Bookings"}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:[d.map(u=>e.jsx(lt,{booking:u},u.id)),d.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"완료된 대관이 없습니다."})]})]})]})}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[y.getFullYear(),"년 ",y.getMonth()+1,"월"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>S("prev"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(ss,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>a(new Date),className:"px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"오늘"}),e.jsx("button",{onClick:()=>S("next"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(rs,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-px mb-2",children:["일","월","화","수","목","금","토"].map(u=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500",children:u},u))}),e.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-200 rounded-lg overflow-hidden",children:p().map((u,T)=>{const N=v(u),R=u.getMonth()===y.getMonth(),P=u.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`bg-white p-2 min-h-[120px] ${R?"text-gray-900":"text-gray-400"} ${P?"bg-blue-50":""}`,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${P?"text-blue-600":""}`,children:u.getDate()}),e.jsxs("div",{className:"space-y-1",children:[N.slice(0,3).map(_=>e.jsx("div",{className:`text-xs px-2 py-1 rounded text-white text-center truncate ${_.status==="approved"?"bg-green-500":_.status==="pending"?"bg-orange-500":_.status==="rejected"?"bg-red-500":"bg-gray-500"}`,title:`${_.purpose} (${_.startTime}-${_.endTime})`,children:_.purpose},_.id)),N.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",N.length-3," more"]})]})]},T)})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"승인됨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"대기중"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"거절됨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded"}),e.jsx("span",{children:"완료됨"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"신규 대관 신청"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:o.purpose||"",onChange:u=>b({...o,purpose:u.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:o.category,onChange:u=>b({...o,category:u.target.value}),children:[e.jsx("option",{value:"training",children:"훈련"}),e.jsx("option",{value:"class",children:"수업"}),e.jsx("option",{value:"event",children:"행사"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설 선택"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:o.facilityId||"",onChange:u=>b({...o,facilityId:u.target.value}),children:[e.jsx("option",{value:"",children:"시설을 선택해 주세요"}),c.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]}),e.jsx("div",{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:o.startDate||"",onChange:u=>b({...o,startDate:u.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:o.endDate||"",onChange:u=>b({...o,endDate:u.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:o.startTime||"",onChange:u=>b({...o,startTime:u.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:o.endTime||"",onChange:u=>b({...o,endTime:u.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"인원"}),e.jsx(Ps,{value:o.numberOfParticipants||1,onChange:u=>b({...o,numberOfParticipants:u})})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"submit",disabled:C,className:`w-full md:w-auto px-4 py-3 rounded-xl font-medium transition-all duration-200 ${C?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:C?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"신청 중..."]}):"대관 신청"})})]})]})]})]})},Os=Se(Ge,"createProgramApplication"),Ls=["일","월","화","수","목","금","토"],Fs=t=>{const s=new Date;s.setHours(0,0,0,0);const i=new Date(t.startDate);i.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=i&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((i.getTime()-s.getTime())/(1e3*60*60*24))}},gt=t=>`${(t.scheduleDays||[]).sort().map(s=>Ls[s]).join(", ")} ${t.startTime}-${t.endTime}`;l.memo(({p:t,status:s,onApply:i,applying:h,isAlreadyApplied:c,applicationStatus:m})=>e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.title}),s.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",s.dDay]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500 flex-wrap",children:[e.jsxs("span",{children:["강사: ",t.instructor]}),e.jsxs("span",{children:["기간: ",t.startDate," ~ ",t.endDate]}),e.jsxs("span",{children:["일정: ",gt(t)]}),e.jsxs("span",{children:["비용: ",t.fee?`${t.fee.toLocaleString()}원`:"무료 / Free"]}),e.jsxs("span",{children:["정원: ",t.enrolled??0," / ",t.capacity]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.text==="종료"?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:s.text}),c&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${m==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:m==="approved"?"승인됨":"신청완료"}),s.text!=="종료"&&e.jsx("button",{disabled:h||c,onClick:()=>i(t.id),className:`px-4 py-2 rounded-xl font-medium transition-colors ${c?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:c?"신청완료":h?"신청중...":"신청하기"})]})]})}));const Rs=({currentUser:t,programs:s,applications:i,setApplications:h})=>{const{showNotification:c}=je(),[m,o]=l.useState(""),[b,C]=l.useState(null),f=l.useMemo(()=>s.filter(x=>x.title.toLowerCase().includes(m.toLowerCase())),[s,m]),w=l.useCallback(async x=>{const y=i.find(a=>a.programId===x&&a.userId===t.id&&(a.status==="pending"||a.status==="approved"));if(y){const a=y.status==="pending"?"대기중":"승인됨";c(`이미 이 프로그램에 신청하셨습니다. (현재 상태: ${a})`,"warning");return}C(x);try{const a=await Os({programId:x});if(a?.data?.success){c("프로그램 신청이 완료되었습니다. 관리자 승인을 기다려주세요.","success");const n={id:a.data.applicationId,userId:t.id,programId:x,status:"pending",appliedAt:new Date,userName:t.name,userEmail:t.email,programTitle:s.find(d=>d.id===x)?.title||"Unknown Program"};h(d=>[n,...d])}else{const n=a?.data?.message||"신청에 실패했습니다. 잠시 후 다시 시도해주세요.";c(n,"error")}}catch(a){c(`신청 실패: ${a?.message||"네트워크 오류가 발생했습니다. 잠시 후 다시 시도해주세요."}`,"error")}finally{C(null)}},[c,t,s,h,i]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"프로그램"}),e.jsx("p",{className:"text-gray-600",children:"다양한 체육 프로그램에 참여해보세요"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"검색"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ct,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{value:m,onChange:x=>o(x.target.value),placeholder:"프로그램명, 강사명...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"종목"}),e.jsx("option",{value:"yoga",children:"요가"}),e.jsx("option",{value:"pilates",children:"필라테스"}),e.jsx("option",{value:"fitness",children:"피트니스"}),e.jsx("option",{value:"dance",children:"댄스"}),e.jsx("option",{value:"badminton",children:"배드민턴"}),e.jsx("option",{value:"pickleball",children:"피클볼"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"요일"}),e.jsx("option",{value:"월",children:"월요일"}),e.jsx("option",{value:"화",children:"화요일"}),e.jsx("option",{value:"수",children:"수요일"}),e.jsx("option",{value:"목",children:"목요일"}),e.jsx("option",{value:"금",children:"금요일"}),e.jsx("option",{value:"토",children:"토요일"}),e.jsx("option",{value:"일",children:"일요일"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"시간대"}),e.jsx("option",{value:"morning",children:"오전 (06:00-12:00)"}),e.jsx("option",{value:"afternoon",children:"오후 (12:00-18:00)"}),e.jsx("option",{value:"evening",children:"저녁 (18:00-22:00)"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"레벨"}),e.jsx("option",{value:"beginner",children:"초급"}),e.jsx("option",{value:"intermediate",children:"중급"}),e.jsx("option",{value:"advanced",children:"고급"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["진행중인 프로그램 (",f.length,"개)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-purple-600 bg-purple-50 rounded-lg",children:"필라테스"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg",children:"진행 중"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-green-600 bg-green-50 rounded-lg",children:"초급"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:f.map(x=>{const y=Fs(x),a=i.find(d=>d.programId===x.id&&d.userId===t.id&&(d.status==="pending"||d.status==="approved")),n=!!a;return e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:x.title}),y.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",y.dDay]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:x.description})]}),e.jsxs("div",{className:"ml-4 flex flex-col gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${y.text==="종료"?"bg-gray-100 text-gray-800":y.text==="진행중"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:y.text}),n&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${a?.status==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:a?.status==="approved"?"승인됨":"신청완료"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsxs("span",{children:["강사: ",x.instructor]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:["기간: ",x.startDate," ~ ",x.endDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsxs("span",{children:["일정: ",gt(x)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsxs("span",{children:["정원: ",x.enrolled??0," / ",x.capacity,"명"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:x.fee?`${x.fee.toLocaleString()}원`:"무료"}),y.text!=="종료"&&e.jsx("button",{disabled:b===x.id||n,onClick:()=>w(x.id),className:`px-6 py-2 rounded-xl font-medium transition-colors ${n?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50"}`,children:n?"신청완료":b===x.id?"신청중...":"신청하기"})]})]})},x.id)})}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"검색 결과가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"다른 조건으로 검색해보세요."})]})]})},Vs=l.lazy(()=>z(()=>import("./DashboardCalendar-BaHUwOCs.js"),__vite__mapDeps([0,1,2]),import.meta.url)),Bs=Se(Ge,"updateReservationStatus"),pt=["일","월","화","수","목","금","토"],zs=t=>{const s=new Date;s.setHours(0,0,0,0);const i=new Date(t.startDate);i.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=i&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((i.getTime()-s.getTime())/(1e3*60*60*24))}},Hs=l.memo(({b:t,onAction:s})=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.userName," | ",t.startDate," ",t.startTime,"-",t.endTime]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t.id,"approve"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>s(t.id,"reject"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})})),qs=l.memo(({p:t,onEdit:s,onDelete:i})=>{const h=zs(t);return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.title}),h.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",h.dDay]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.instructor," | ",t.startDate," ~ ",t.endDate," | ",t.startDate!==t.endDate?(t.scheduleDays||[]).slice().sort().map(c=>pt[c]).join(","):"단일"," | ",t.startTime," - ",t.endTime," | ",t.fee?`${t.fee.toLocaleString()}원`:"무료"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg",children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>i(t),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg",children:e.jsx(He,{className:"w-4 h-4"})})]})]})});function Gs({currentUser:t,bookings:s,setBookings:i,applications:h,setApplications:c,programs:m,setPrograms:o,users:b,facilities:C}){const{showNotification:f}=je(),[w,x]=l.useState(!1),[y,a]=l.useState(null),[n,d]=l.useState("month"),p={title:"",description:"",instructor:"",capacity:10,scheduleDays:[],startTime:"09:00",endTime:"10:00",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],level:"beginner",category:"yoga",fee:0},[v,S]=l.useState(p),E=l.useMemo(()=>v.startDate!==v.endDate,[v.startDate,v.endDate]),u=l.useMemo(()=>{const r=[];for(let g=0;g<24;g++)for(let k=0;k<60;k+=10)r.push(`${String(g).padStart(2,"0")}:${String(k).padStart(2,"0")}`);return r},[]),T=l.useCallback(async()=>{const r={...y??{id:`program-${Date.now()}`},...v};y?(o(g=>g.map(k=>k.id===r.id?r:k)),f("프로그램이 수정되었습니다.","success")):(o(g=>[r,...g]),f("새 프로그램이 개설되었습니다.","success"));try{const{doc:g,setDoc:k,updateDoc:O,serverTimestamp:H}=await z(async()=>{const{doc:L,setDoc:U,updateDoc:M,serverTimestamp:K}=await import("./firebase-DnP1Uaxu.js").then(Z=>Z.M);return{doc:L,setDoc:U,updateDoc:M,serverTimestamp:K}},[],import.meta.url),{db:W}=await z(async()=>{const{db:L}=await Promise.resolve().then(()=>re);return{db:L}},void 0,import.meta.url);y?(await O(g(W,"programs",r.id),{...r,updatedAt:H()}),console.log("프로그램 수정 완료:",r.id)):(await k(g(W,"programs",r.id),{...r,createdAt:H(),updatedAt:H()}),console.log("새 프로그램 생성 완료:",r.id))}catch(g){console.warn("Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",g)}x(!1),a(null)},[v,y,o,f]),N=l.useCallback(async(r,g)=>{const k=g==="approve"?"approved":"rejected",O=s;try{i(M=>M.map(K=>K.id===r?{...K,status:k}:K));const{doc:H,updateDoc:W,serverTimestamp:L}=await z(async()=>{const{doc:M,updateDoc:K,serverTimestamp:Z}=await import("./firebase-DnP1Uaxu.js").then(xe=>xe.M);return{doc:M,updateDoc:K,serverTimestamp:Z}},[],import.meta.url),{db:U}=await z(async()=>{const{db:M}=await Promise.resolve().then(()=>re);return{db:M}},void 0,import.meta.url);await W(H(U,"bookings",r),{status:k,updatedAt:L(),[g==="approve"?"approvedAt":"rejectedAt"]:L()}),console.log("대관 상태 Firebase 저장 성공:",r,k),f(`대관이 ${g==="approve"?"승인":"거절"}되었습니다.`,"success");try{await Bs({reservationId:r,status:k}),console.log("Firebase Function 호출 성공:",r,k)}catch(M){console.warn("Firebase Function 호출 실패 (데이터는 이미 저장됨):",M)}}catch(H){console.error("대관 상태 업데이트 실패:",H),i(O),f("대관 상태 변경에 실패했습니다. 다시 시도해주세요.","error")}},[s,i,f]),R=l.useCallback(async(r,g)=>{const k=h;try{c(U=>U.map(M=>M.id===r?{...M,status:g}:M)),f(`프로그램 신청이 ${g==="approved"?"승인":"거절"}되었습니다.`,"success");const{doc:O,updateDoc:H,serverTimestamp:W}=await z(async()=>{const{doc:U,updateDoc:M,serverTimestamp:K}=await import("./firebase-DnP1Uaxu.js").then(Z=>Z.M);return{doc:U,updateDoc:M,serverTimestamp:K}},[],import.meta.url),{db:L}=await z(async()=>{const{db:U}=await Promise.resolve().then(()=>re);return{db:U}},void 0,import.meta.url);await H(O(L,"program_applications",r),{status:g,updatedAt:W(),[g==="approved"?"approvedAt":"rejectedAt"]:W()}),console.log("프로그램 신청 상태 Firebase 저장 성공:",r,g)}catch(O){console.error("프로그램 신청 상태 업데이트 실패:",O),c(k),f("프로그램 신청 상태 변경에 실패했습니다. 다시 시도해주세요.","error")}},[h,c,f]),P=l.useMemo(()=>s.filter(r=>r.status==="pending"),[s]),_=l.useMemo(()=>h.filter(r=>r.status==="pending"),[h]),A=l.useMemo(()=>m.filter(r=>{const g=new Date;return new Date(r.endDate)>=g}),[m]),V=l.useMemo(()=>b.length,[b]),[D,I]=l.useState({name:"",category:"class",purpose:"",facilityId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"}),te=l.useCallback(async()=>{if(!D.name||D.name.trim().length===0){f("신청자 이름을 입력해주세요.","error");return}if(!D.purpose||D.purpose.trim().length===0){f("대관 목적을 입력해주세요.","error");return}if(!D.facilityId){f("시설을 선택해주세요.","error");return}const r=`booking-${Date.now()}`,g={id:r,userId:t.id,userName:D.name,userEmail:t.email,facilityId:D.facilityId,startDate:D.startDate,endDate:D.endDate,startTime:D.startTime,endTime:D.endTime,purpose:D.purpose,category:D.category,status:"approved",numberOfParticipants:1,createdAt:new Date};i(k=>[g,...k]),f("대관이 승인되어 등록되었습니다.","success");try{const{doc:k,setDoc:O,serverTimestamp:H}=await z(async()=>{const{doc:L,setDoc:U,serverTimestamp:M}=await import("./firebase-DnP1Uaxu.js").then(K=>K.M);return{doc:L,setDoc:U,serverTimestamp:M}},[],import.meta.url),{db:W}=await z(async()=>{const{db:L}=await Promise.resolve().then(()=>re);return{db:L}},void 0,import.meta.url);await O(k(W,"bookings",r),{...g,createdAt:H(),updatedAt:H(),approvedAt:H()}),console.log("대관 신청 Firebase 저장 성공:",r)}catch(k){console.warn("Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",k)}I({name:"",category:"class",purpose:"",facilityId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"})},[D,t,i,f]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"운영 관리"}),e.jsx("p",{className:"text-gray-600",children:"대관 및 프로그램 신청을 관리하고, 체육관 직접 등록을 할 수 있습니다"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기중인 대관"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:P.length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기중인 프로그램 신청"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:_.length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center",children:e.jsx(ce,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"운영중인 프로그램"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:A.length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"총 이용자 수"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:V})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center",children:e.jsx(ee,{className:"w-6 h-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"수강생/팀 직접 등록"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"아래 폼을 사용하여 대관을 등록하세요"})]}),e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"신청자 이름"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",placeholder:"예: 관리자 등록",value:D.name,onChange:r=>I({...D,name:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",placeholder:"대관 목적을 입력하세요",value:D.purpose,onChange:r=>I({...D,purpose:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:D.category,onChange:r=>I({...D,category:r.target.value}),children:[e.jsx("option",{value:"class",children:"수업"}),e.jsx("option",{value:"event",children:"행사"}),e.jsx("option",{value:"club",children:"동아리"}),e.jsx("option",{value:"personal",children:"개인"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설 선택"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:D.facilityId,onChange:r=>I({...D,facilityId:r.target.value}),children:[e.jsx("option",{value:"",children:"시설을 선택해 주세요"}),C.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:D.startDate,onChange:r=>I({...D,startDate:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:D.endDate,onChange:r=>I({...D,endDate:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:D.startTime,onChange:r=>I({...D,startTime:r.target.value}),children:[e.jsx("option",{value:"09:00",children:"09:00"}),e.jsx("option",{value:"10:00",children:"10:00"}),e.jsx("option",{value:"11:00",children:"11:00"}),e.jsx("option",{value:"14:00",children:"14:00"}),e.jsx("option",{value:"15:00",children:"15:00"}),e.jsx("option",{value:"16:00",children:"16:00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:D.endTime,onChange:r=>I({...D,endTime:r.target.value}),children:[e.jsx("option",{value:"10:00",children:"10:00"}),e.jsx("option",{value:"11:00",children:"11:00"}),e.jsx("option",{value:"12:00",children:"12:00"}),e.jsx("option",{value:"15:00",children:"15:00"}),e.jsx("option",{value:"16:00",children:"16:00"}),e.jsx("option",{value:"17:00",children:"17:00"})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"취소"}),e.jsx("button",{onClick:te,className:"px-6 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:"등록하기"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-50 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["사용자 대관 신청 대기 (",P.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:P.length>0?P.map(r=>e.jsx(Hs,{b:r,onAction:N},r.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"대기중인 신청이 없습니다."})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["대기중인 프로그램 신청 (",_.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:_.length>0?_.map(r=>{const g=m.find(k=>k.id===r.programId);return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:g?.title||r.programTitle}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["신청자: ",r.userName," | 신청일: ",r.appliedAt?.toDate?.()?.toLocaleDateString()||"N/A"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>R(r.id,"approved"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>R(r.id,"rejected"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})},r.id)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"대기중인 신청이 없습니다."})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(ce,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"프로그램 관리"})]}),e.jsxs("button",{onClick:()=>{a(null),S(p),x(!0)},className:"flex items-center gap-2 text-sm font-medium text-purple-600 hover:text-purple-800 px-4 py-2 rounded-lg hover:bg-purple-50",children:[e.jsx(qe,{className:"w-4 h-4"})," 새 프로그램 추가"]})]}),e.jsxs("div",{className:"space-y-3",children:[m.map(r=>e.jsx(qs,{p:r,onEdit:g=>{a(g),S(g),x(!0)},onDelete:g=>o(k=>k.filter(O=>O.id!==g.id))},r.id)),m.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"등록된 프로그램이 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"전체 대관 캘린더"})]}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"text-center py-8 text-gray-500",children:"캘린더 로딩 중..."}),children:e.jsx(Vs,{bookings:s,programs:m,view:n,setView:d})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:y?"프로그램 수정":"새 프로그램 개설"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"제목"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:v.title,onChange:r=>S({...v,title:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"강사"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:v.instructor,onChange:r=>S({...v,instructor:r.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명"}),e.jsx("textarea",{className:"w-full p-3 border border-gray-200 rounded-xl",rows:3,value:v.description,onChange:r=>S({...v,description:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:v.startDate,onChange:r=>S({...v,startDate:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:v.endDate,onChange:r=>S({...v,endDate:r.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"반복 요일"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:pt.map((r,g)=>e.jsx("button",{type:"button",onClick:()=>S(k=>({...k,scheduleDays:k.scheduleDays.includes(g)?k.scheduleDays.filter(O=>O!==g):[...k.scheduleDays,g]})),className:`p-2 rounded-lg border text-sm font-medium ${v.scheduleDays.includes(g)?"bg-purple-500 text-white border-purple-500":"bg-white hover:bg-gray-100 border-gray-300"} ${E?"":"opacity-50 pointer-events-none"}`,children:r},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:v.startTime,onChange:r=>S({...v,startTime:r.target.value}),children:u.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:v.endTime,onChange:r=>S({...v,endTime:r.target.value}),children:u.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"정원"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:v.capacity,onChange:r=>S({...v,capacity:parseInt(r.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"금액"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:v.fee||0,onChange:r=>S({...v,fee:parseInt(r.target.value)||0})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl border",onClick:()=>{x(!1),a(null)},children:"취소"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-purple-600 text-white",onClick:T,children:y?"수정하기":"개설하기"})]})]})})]})}const Ws=({users:t,setUsers:s})=>{const{users:i,loading:h}=ye(),c=i.length>0?i:t||[],[m,o]=l.useState(!1),[b,C]=l.useState(!1),[f,w]=l.useState(null),[x,y]=l.useState(null),[a,n]=l.useState(null),d={name:"",email:"",phone:"",password:"",role:"user"},[p,v]=l.useState(d),[S,E]=l.useState(""),[u,T]=l.useState(""),[N,R]=l.useState(""),[P,_]=l.useState(""),[A,V]=l.useState(null),[D,I]=l.useState(!1),[te,r]=l.useState(!1),[g,k]=l.useState(""),[O,H]=l.useState("name"),[W]=l.useState("all"),[L,U]=l.useState({key:"name",direction:"asc"}),M=it();l.useEffect(()=>{b&&setTimeout(()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new Ft(M,"recaptcha-container",{size:"invisible",callback:()=>{}}))},100)},[b,M]);const K=j=>{w(j),v({name:j.name,email:j.email,phone:j.phone||"",password:"",role:j.role}),o(!0)},Z=()=>{w(null),v(d),o(!0)},xe=()=>{o(!1),w(null)},ke=j=>{n(j),E(j.email),R(j.phone||""),T(""),_(""),V(null),C(!0)},we=()=>{C(!1),n(null),window.recaptchaVerifier&&window.recaptchaVerifier.clear()},ae=j=>{const{name:$,value:J}=j.target;v($==="phone"?F=>({...F,[$]:et(J)}):F=>({...F,[$]:J}))},Ee=async j=>{j.preventDefault(),r(!0);try{if(f){if(c.some(X=>X.email===p.email&&X.id!==f.id)){alert("이미 사용 중인 이메일입니다.");return}const{doc:$,updateDoc:J,serverTimestamp:F}=await z(async()=>{const{doc:X,updateDoc:ne,serverTimestamp:_e}=await import("./firebase-DnP1Uaxu.js").then(Me=>Me.M);return{doc:X,updateDoc:ne,serverTimestamp:_e}},[],import.meta.url),{db:q}=await z(async()=>{const{db:X}=await Promise.resolve().then(()=>re);return{db:X}},void 0,import.meta.url),le={name:p.name,email:p.email,phone:p.phone.replace(/-/g,"")||null,role:p.role,updatedAt:F()};await J($(q,"users",f.id),le),s&&s(X=>X.map(ne=>ne.id===f.id?{...ne,name:p.name,email:p.email,phone:p.phone.replace(/-/g,""),role:p.role}:ne)),alert("사용자 정보가 수정되었습니다.")}else{if(c.some(F=>F.email===p.email)){alert("이미 등록된 이메일입니다.");return}if(!p.password){alert("신규 사용자는 비밀번호가 필요합니다.");return}const{httpsCallable:$}=await z(async()=>{const{httpsCallable:F}=await import("./firebase-DnP1Uaxu.js").then(q=>q.N);return{httpsCallable:F}},[],import.meta.url),{functions:J}=await z(async()=>{const{functions:F}=await Promise.resolve().then(()=>re);return{functions:F}},void 0,import.meta.url);try{const q=await $(J,"createUserByAdmin")({name:p.name,email:p.email,phone:p.phone.replace(/-/g,"")||null,password:p.password,role:p.role});if(q.data.success){if(alert(`새 사용자 '${p.name}'이 생성되었습니다.

관리자가 생성한 계정이므로 이메일 인증 없이 바로 로그인할 수 있습니다.`),s){const le={id:q.data.uid,name:p.name,email:p.email,phone:p.phone.replace(/-/g,""),role:p.role};s(X=>[...X,le])}}else throw new Error(q.data.error||"사용자 생성에 실패했습니다.")}catch(F){console.warn("Cloud Functions 사용자 생성 실패, 직접 생성 방식으로 전환:",F);const{createUserWithEmailAndPassword:q,sendEmailVerification:le,updateProfile:X,signOut:ne}=await z(async()=>{const{createUserWithEmailAndPassword:Q,sendEmailVerification:ie,updateProfile:Ie,signOut:Oe}=await import("./firebase-DnP1Uaxu.js").then(wt=>wt.L);return{createUserWithEmailAndPassword:Q,sendEmailVerification:ie,updateProfile:Ie,signOut:Oe}},[],import.meta.url),{doc:_e,setDoc:Me,serverTimestamp:Ue}=await z(async()=>{const{doc:Q,setDoc:ie,serverTimestamp:Ie}=await import("./firebase-DnP1Uaxu.js").then(Oe=>Oe.M);return{doc:Q,setDoc:ie,serverTimestamp:Ie}},[],import.meta.url),{auth:$e,db:jt}=await z(async()=>{const{auth:Q,db:ie}=await Promise.resolve().then(()=>re);return{auth:Q,db:ie}},void 0,import.meta.url);if(!$e.currentUser)throw new Error("관리자 로그인이 필요합니다.");const Ne=(await q($e,p.email,p.password)).user;await X(Ne,{displayName:p.name||p.email.split("@")[0]}),await Me(_e(jt,"users",Ne.uid),{name:p.name,email:p.email,phone:p.phone.replace(/-/g,"")||null,role:p.role,isActive:!0,adminCreated:!0,createdAt:Ue(),updatedAt:Ue()});try{await le(Ne,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(Q){console.warn("이메일 인증 메일 전송 실패:",Q)}if(await ne($e),alert(`새 사용자 '${p.name}'이 생성되었습니다.

⚠️ 새 사용자 생성으로 인해 자동 로그아웃되었습니다.
관리자 계정으로 다시 로그인해주세요.

생성된 사용자는 이메일 인증 없이 바로 로그인할 수 있습니다.`),s){const Q={id:Ne.uid,name:p.name,email:p.email,phone:p.phone.replace(/-/g,""),role:p.role};s(ie=>[...ie,Q])}}}xe()}catch($){console.error("User creation/update error:",$);const J=he($);alert(J)}finally{r(!1)}},Te=j=>{if(j.role==="admin"&&c.filter($=>$.role==="admin").length<=1){alert("마지막 관리자 계정은 삭제할 수 없습니다.");return}y(j)},Pe=async()=>{if(x){try{const{deleteDoc:j,doc:$}=await z(async()=>{const{deleteDoc:F,doc:q}=await import("./firebase-DnP1Uaxu.js").then(le=>le.M);return{deleteDoc:F,doc:q}},[],import.meta.url),{db:J}=await z(async()=>{const{db:F}=await Promise.resolve().then(()=>re);return{db:F}},void 0,import.meta.url);await j($(J,"users",x.id)),alert("사용자가 삭제되었습니다."),s&&s(F=>F.filter(q=>q.id!==x.id))}catch(j){console.error("사용자 삭제 오류:",j),alert("사용자 삭제에 실패했습니다.")}y(null)}},Ae=j=>{let $="asc";L&&L.key===j&&L.direction==="asc"&&($="desc"),U({key:j,direction:$})},bt=async()=>{if(!N){alert("휴대폰 번호를 입력하세요.");return}I(!0);try{const j=window.recaptchaVerifier,$=await Rt(M,N,j);V($),alert("인증 코드를 발송했습니다.")}catch(j){console.error("SMS Error:",j),alert("SMS 인증 코드 요청에 실패했습니다.")}finally{I(!1)}},ft=async()=>{if(!P){alert("인증 코드를 입력하세요.");return}if(!A){alert("먼저 인증 코드를 요청하세요.");return}I(!0);try{await A.confirm(P),alert("휴대폰 인증이 완료되었습니다.")}catch(j){console.error("Verification Error:",j),alert("인증 코드가 잘못되었습니다.")}finally{I(!1)}},yt=async()=>{if(!S||!u){alert("새 이메일과 현재 비밀번호를 입력하세요.");return}if(M.currentUser){I(!0);try{const j=Vt.credential(M.currentUser.email,u);await Bt(M.currentUser,j),await zt(M.currentUser,S),alert("이메일 주소가 변경되었습니다. 새 주소로 인증 메일을 확인하세요."),we()}catch(j){console.error("Email Update Error:",j),alert("이메일 변경에 실패했습니다. 비밀번호를 확인하세요.")}finally{I(!1)}}},We=l.useMemo(()=>{const j=c.filter($=>W==="all"||$.role===W).filter($=>{if(!g)return!0;const J=g.toLowerCase();return($[O]?.toLowerCase()||"").includes(J)});return L!==null&&j.sort(($,J)=>{const F=$[L.key]||"",q=J[L.key]||"";return F<q?L.direction==="asc"?-1:1:F>q?L.direction==="asc"?1:-1:0}),j},[c,g,O,W,L]),ve=({columnKey:j,title:$})=>e.jsx("th",{onClick:()=>Ae(j),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:$}),L?.key===j&&e.jsx(ns,{className:"w-4 h-4 ml-2"})]})});return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{id:"recaptcha-container"}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"회원 관리"}),e.jsx("p",{className:"text-gray-600",children:"사용자 추가, 수정, 삭제"})]}),e.jsxs("button",{onClick:Z,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"새 사용자 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:O,onChange:j=>H(j.target.value),className:"border rounded-lg px-2 py-1 text-sm",children:[e.jsx("option",{value:"name",children:"이름"}),e.jsx("option",{value:"email",children:"이메일"}),e.jsx("option",{value:"phone",children:"전화번호"})]}),e.jsx("input",{value:g,onChange:j=>k(j.target.value),placeholder:"검색어 입력",className:"flex-1 outline-none"})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:h?e.jsxs("div",{className:"flex items-center justify-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"사용자 정보를 불러오는 중..."})]}):We.length===0?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"등록된 사용자가 없습니다."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"새 사용자 추가 버튼을 클릭해서 사용자를 추가해보세요."})]})}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx(ve,{columnKey:"name",title:"이름"}),e.jsx(ve,{columnKey:"email",title:"이메일"}),e.jsx(ve,{columnKey:"phone",title:"전화번호"}),e.jsx(ve,{columnKey:"role",title:"권한"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:We.map(j=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:j.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j.phone}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${j.role==="admin"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:j.role})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>ke(j),className:"p-2 text-gray-500 hover:text-green-600 rounded-lg transition-all hover:scale-110",children:e.jsx(ls,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>K(j),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>Te(j),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(He,{className:"w-4 h-4"})})]})]},j.id))})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:f?"사용자 정보 수정":"새 사용자 추가"}),e.jsxs("form",{onSubmit:Ee,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이름"}),e.jsx("input",{type:"text",name:"name",value:p.name,onChange:ae,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이메일"}),e.jsx("input",{type:"email",name:"email",value:p.email,onChange:ae,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"전화번호"}),e.jsx("input",{type:"tel",name:"phone",value:p.phone,onChange:ae,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["비밀번호 ",f&&"(변경시에만 입력)"]}),e.jsx("input",{type:"password",name:"password",value:p.password,onChange:ae,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"권한"}),e.jsxs("select",{name:"role",value:p.role,onChange:ae,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:xe,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:"저장"})]})]})]})}),b&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 space-y-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["계정 설정: ",a.name]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"휴대폰 인증"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"tel",value:N,onChange:j=>R(et(j.target.value)),placeholder:"휴대폰 번호",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:bt,disabled:D,className:"py-3 px-4 bg-gray-200 rounded-xl hover:bg-gray-300 font-medium transition-colors disabled:opacity-50",children:D?"전송중...":"인증코드 받기"})]}),A&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:P,onChange:j=>_(j.target.value),placeholder:"인증 코드 6자리",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:ft,disabled:D,className:"py-3 px-4 bg-green-500 text-white rounded-xl hover:bg-green-600 font-medium transition-colors disabled:opacity-50",children:D?"확인중...":"인증하기"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"이메일 주소 변경"}),e.jsx("input",{type:"email",value:S,onChange:j=>E(j.target.value),placeholder:"새 이메일 주소",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("input",{type:"password",value:u,onChange:j=>T(j.target.value),placeholder:"현재 비밀번호",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:yt,disabled:D,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors disabled:opacity-50",children:D?"변경중...":"이메일 변경"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"button",onClick:we,className:"py-3 px-6 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"닫기"})})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"사용자 삭제 확인"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["정말로 ",e.jsx("strong",{className:"text-red-600",children:x.name})," 사용자를 삭제하시겠습니까?"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>y(null),className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{onClick:Pe,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl hover:bg-red-600 font-medium transition-colors",children:"삭제"})]})]})})]})},Us=()=>{const{facilities:t}=ye(),[s,i]=l.useState(!1),[h,c]=l.useState(null),m={name:"",type:"gym",capacity:1,bufferMinutes:0,bookingPolicy:{allowOverlap:!1,maxConcurrent:1,timeSlotMinutes:60}},[o,b]=l.useState(m),C=()=>{c(null),b(m),i(!0)},f=n=>{c(n),b({...n,bookingPolicy:n.bookingPolicy||{allowOverlap:!1,maxConcurrent:1,timeSlotMinutes:60}}),i(!0)},w=()=>{i(!1),c(null)},x=n=>{const{name:d,value:p,type:v}=n.target,S=v==="number";b(E=>({...E,[d]:S?Number(p):p}))},y=async n=>{if(n.preventDefault(),!o.name||o.capacity<=0){alert("시설 이름과 수용 인원을 확인해주세요.");return}try{if(h){const d=se(G,"facilities",h.id);await qt(d,o),alert("시설 정보가 성공적으로 수정되었습니다.")}else await Gt(ue(G,"facilities"),o),alert("새 시설이 추가되었습니다.");w()}catch(d){console.error("Error saving facility: ",d),alert("처리 중 오류가 발생했습니다.")}},a=async n=>{if(window.confirm("정말로 이 시설을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{await Ht(se(G,"facilities",n)),alert("시설이 삭제되었습니다.")}catch(d){console.error("Error deleting facility: ",d),alert("삭제 중 오류가 발생했습니다.")}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"시설 관리"}),e.jsx("p",{className:"text-gray-600",children:"체육관 시설을 추가, 수정, 삭제합니다."})]}),e.jsxs("button",{onClick:C,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(qe,{className:"w-5 h-5"}),e.jsx("span",{children:"새 시설 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"이름"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"종류"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수용 인원"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"버퍼(분)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"중복 정책"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(n=>{const d=n.bookingPolicy,p=d?.allowOverlap?`🔄 중복허용 (최대${d.maxConcurrent||1}팀)`:"🚫 단독사용";return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:n.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.capacity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:n.bufferMinutes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${d?.allowOverlap?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:p})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>f(n),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>a(n.id),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(He,{className:"w-4 h-4"})})]})]},n.id)})})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:h?"시설 정보 수정":"새 시설 추가"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시설 이름"}),e.jsx("input",{type:"text",name:"name",value:o.name,onChange:x,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"수용 인원"}),e.jsx("input",{type:"number",name:"capacity",value:o.capacity,onChange:x,required:!0,min:1,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"버퍼 시간 (분)"}),e.jsx("input",{type:"number",name:"bufferMinutes",value:o.bufferMinutes,onChange:x,required:!0,min:0,className:"w-full p-3 border border-gray-200 rounded-xl"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시설 종류"}),e.jsxs("select",{name:"type",value:o.type,onChange:x,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"gym",children:"체육관"}),e.jsx("option",{value:"court",children:"코트"}),e.jsx("option",{value:"field",children:"운동장"}),e.jsx("option",{value:"pool",children:"수영장"}),e.jsx("option",{value:"room",children:"다목적실"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-3",children:"중복 사용 설정"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:o.bookingPolicy?.allowOverlap||!1,onChange:n=>b(d=>({...d,bookingPolicy:{...d.bookingPolicy,allowOverlap:n.target.checked,maxConcurrent:n.target.checked?d.bookingPolicy?.maxConcurrent||2:1}})),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"중복 사용 허용 (같은 시간에 여러 팀 사용 가능)"})]}),o.bookingPolicy?.allowOverlap&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"최대 동시 사용 팀"}),e.jsx("input",{type:"number",min:"2",max:"10",value:o.bookingPolicy?.maxConcurrent||2,onChange:n=>b(d=>({...d,bookingPolicy:{...d.bookingPolicy,maxConcurrent:parseInt(n.target.value)}})),className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"같은 시간에 이용할 수 있는 최대 팀 수"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:w,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:h?"수정하기":"추가하기"})]})]})]})})]})},Ks={success:e.jsx(ds,{className:"w-6 h-6 text-green-500"}),error:e.jsx(cs,{className:"w-6 h-6 text-red-500"}),warning:e.jsx(os,{className:"w-6 h-6 text-yellow-500"}),info:e.jsx(is,{className:"w-6 h-6 text-blue-500"})},Js=({notification:t,onRemove:s})=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden mb-4 animate-on-load",style:{animationName:"fadeInRight"},children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:Ks[t.type]}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.message})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{onClick:()=>s(t.id),className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(ot,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})}),Xs=()=>{const{notifications:t,removeNotification:s}=je();return e.jsx("div",{className:"fixed inset-0 flex items-end justify-end px-4 py-6 pointer-events-none sm:p-6 z-50",children:e.jsx("div",{className:"w-full max-w-sm",children:t.map(i=>e.jsx(Js,{notification:i,onRemove:s},i.id))})})};function Ys(){const{user:t,login:s,logout:i,signup:h,adminLogin:c,googleLogin:m,loading:o}=us(),{loading:b,syncing:C,bookings:f,setBookings:w,programs:x,setPrograms:y,applications:a,setApplications:n,users:d,setUsers:p,facilities:v}=ye(),[S,E]=l.useState("dashboard");l.useEffect(()=>{t&&!b&&E("dashboard")},[t,b]);const u=async(A,V)=>{try{if(!A.trim()||!V.trim())throw new Error("이메일과 비밀번호를 입력해주세요.");return await s(A,V),[!0,null]}catch(D){return console.error("Login failed:",D),[!1,he(D)]}},T=async(A,V)=>{try{if(!A.trim()||!V.trim())throw new Error("이메일과 비밀번호를 입력해주세요.");return await c(A,V),[!0,null]}catch(D){return console.error("Admin login failed:",D),[!1,he(D)]}},N=async A=>{try{const{name:V,email:D,password:I}=A;if(!V?.trim())throw new Error("이름을 입력해주세요.");if(!D?.trim())throw new Error("이메일을 입력해주세요.");if(!I?.trim())throw new Error("비밀번호를 입력해주세요.");return await h(A),[!0,"회원가입이 완료되었습니다. 이메일 인증을 확인해주세요."]}catch(V){return console.error("Signup failed:",V),[!1,he(V)]}},R=async()=>{try{return await m(),[!0,null]}catch(A){return console.error("Google login failed:",A),[!1,he(A)]}},P=async()=>{await i(),E("dashboard")},_=()=>{if(!t)return null;try{switch(S){case"dashboard":return e.jsx(at,{currentUser:t,bookings:f,applications:a,programs:x,setActiveTab:E,syncing:C});case"booking":return e.jsx(Is,{currentUser:t,bookings:f,setBookings:w,syncing:C});case"program":return e.jsx(Rs,{currentUser:t,programs:x,setPrograms:y,applications:a,setApplications:n});case"admin":return e.jsx(Gs,{currentUser:t,bookings:f,setBookings:w,applications:a,setApplications:n,programs:x,setPrograms:y,users:d,facilities:v});case"userManagement":return e.jsx(Ws,{users:d,setUsers:p});case"facilities":return e.jsx(Us,{});default:return e.jsx(at,{currentUser:t,bookings:f,applications:a,programs:x,setActiveTab:E,syncing:C})}}catch(A){return console.error("Component rendering error:",A),e.jsx("div",{className:"min-h-96 bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"화면을 불러오는 중 오류가 발생했습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"다른 메뉴를 선택하거나 페이지를 새로고침해주세요."}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>E("dashboard"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"대시보드로 이동"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"새로고침"})]})]})})}};return b||o?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Xs,{}),t?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Ns,{currentUser:t,activeTab:S,setActiveTab:E,onLogout:P}),e.jsx("main",{children:_()})]}):e.jsx(bs,{onLogin:u,onSignup:N,onAdminLogin:T,onGoogleLogin:R})]})}const nt=document.getElementById("root");nt?vt.createRoot(nt).render(e.jsx(Nt.StrictMode,{children:e.jsx(hs,{children:e.jsx(Ys,{})})})):console.error("Failed to find the root element");
