const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DashboardCalendar-BaHUwOCs.js","./react-C1G-q6RG.js","./icons-CTQcQIqG.js"])))=>i.map(i=>d[i]);
import{r as n,j as e,R as wt,a as vt}from"./react-C1G-q6RG.js";import{g as Ye,i as Nt,a as dt,b as Dt,c as Ct,d as We,e as St,f as kt,h as Et,j as Tt,k as Pt,l as At,o as _t,s as Ze,m as Te,n as ae,p as Pe,q as ve,r as Mt,u as Qe,t as Ne,v as xe,G as $t,w as It,x as De,y as fe,z as ze,A as He,B as Ot,C as Ae,R as Lt,D as Ft,E as Rt,F as Vt,H as Bt,I as zt,J as Ht,K as qt}from"./firebase-DnP1Uaxu.js";import{U as se,a as Gt,M as Ge,P as Wt,L as qe,b as Ut,B as Kt,c as Jt,H as et,C as te,d as he,S as tt,e as st,X as mt,f as Xt,g as Yt,h as ue,i as Zt,j as Qt,k as es,l as ts,m as ss,n as xt,o as rs,p as Ue,T as Ke,q as Je,r as as,A as ls,I as ns,s as is,t as os,u as cs}from"./icons-CTQcQIqG.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))h(c);new MutationObserver(c=>{for(const m of c)if(m.type==="childList")for(const i of m.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&h(i)}).observe(document,{childList:!0,subtree:!0});function o(c){const m={};return c.integrity&&(m.integrity=c.integrity),c.referrerPolicy&&(m.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?m.credentials="include":c.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function h(c){if(c.ep)return;c.ep=!0;const m=o(c);fetch(c.href,m)}})();const Ce={};console.log("Firebase Config Debug:",{hasApiKey:!0,hasAuthDomain:!0,hasProjectId:!0,NODE_ENV:"production"});const ds={apiKey:"AIzaSyBvlPy3BOyrRCokGAHkzuX6IoVZNjWTU-0",authDomain:"flexspaceprowin.firebaseapp.com",projectId:"flexspaceprowin",storageBucket:"flexspaceprowin.firebasestorage.app",messagingSenderId:"545144229496",appId:"1:545144229496:web:a833b961cf4b8a7ce9678d",measurementId:"G-D81Q76VKZQ"};let ge;try{ge=Ye().length?Ye()[0]:Nt(ds),console.log("Firebase initialized successfully")}catch(t){throw console.error("Firebase initialization failed:",t),t}const z=dt(ge),K=Dt(ge),ut=Ct(ge),_e=We(ge),ms=Ce?.VITE_USE_EMULATOR==="true";if(ms){const t=Ce?.VITE_EMULATOR_HOST||"127.0.0.1",s=Number(Ce?.VITE_EMULATOR_AUTH_PORT||9099),o=Number(Ce?.VITE_EMULATOR_FIRESTORE_PORT||8080),h=Number(Ce?.VITE_EMULATOR_STORAGE_PORT||9199);try{St(z,`http://${t}:${s}`,{disableWarnings:!0})}catch{}try{kt(K,t,o)}catch{}try{Et(ut,t,h)}catch{}try{Tt(_e,t,5001)}catch{}}Pt().then(t=>t?At(ge):null).catch(()=>null);const ht=ge,le=Object.freeze(Object.defineProperty({__proto__:null,auth:z,db:K,default:ht,functions:_e,storage:ut},Symbol.toStringTag,{value:"Module"})),xs=()=>{const[t,s]=n.useState(null),[o,h]=n.useState(!1),[c,m]=n.useState(!0);n.useEffect(()=>{m(!0);const l=_t(z,async a=>{try{if(!a){s(null),h(!1);return}h(a.emailVerified);const d=ae(K,"users",a.uid),g=await Te(d);let N="user",S=a.displayName||(a.email?.split("@")[0]??"user"),E;if(g.exists()){const x=g.data();N=x.role||"user",S=x.name||S,E=x.phone}else{const x={name:S,email:a.email??"",phone:null,role:"user",isActive:!0,createdAt:xe(),updatedAt:xe()};await Ne(d,x),console.log("새 사용자 정보를 users 컬렉션에 추가:",a.uid)}s({id:a.uid,name:S,email:a.email??"",phone:E,role:N})}catch(d){console.error("Auth state change error:",d),a&&s({id:a.uid,name:a.email?.split("@")[0]??"user",email:a.email??"",role:"user"})}finally{m(!1)}});return()=>l()},[]);const i=n.useCallback(async(l,a)=>{try{const d=await Ze(z,l,a),g=await Te(ae(K,"users",d.user.uid)),S=(g.exists()?g.data():null)?.adminCreated===!0,E=l==="admin@flexspace.test"||l==="flexadmin@test.com"||l==="joonake@naver.com"||l==="uu@naver.com"||l==="kan@naver.com"||l==="kun6@naver.com";if(!d.user.emailVerified&&!S&&!E){try{await Pe(d.user,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(x){console.warn("이메일 인증 재전송 실패:",x)}throw await ve(z),new Error("이메일 인증이 필요합니다. 새로운 인증 메일을 발송했습니다. 이메일함을 확인해주세요.")}return!0}catch(d){throw console.error("Login error:",d),d}},[]),b=n.useCallback(async(l,a)=>{try{const d=await Ze(z,l,a);if(!(l==="admin@flexspace.test"||l==="flexadmin@test.com"||l==="joonake@naver.com"||l==="uu@naver.com"||l==="kan@naver.com"||l==="kun6@naver.com")&&!d.user.emailVerified){try{await Pe(d.user,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(T){console.warn("관리자 이메일 인증 재전송 실패:",T)}throw await ve(z),new Error("이메일 인증이 필요합니다. 새로운 인증 메일을 발송했습니다. 이메일함을 확인해주세요.")}const N=ae(K,"users",d.user.uid),S=await Te(N),E=S.exists()?S.data():{},x=E.role;if(console.log("Admin login - User data:",{uid:d.user.uid,email:d.user.email,firestoreExists:S.exists(),role:x,allData:E}),x!=="admin")throw await ve(z),new Error(`관리자 권한이 없습니다. 현재 권한: ${x||"없음"}`);return!0}catch(d){throw console.error("Admin login error:",d),d}},[]),C=n.useCallback(async l=>{try{const{name:a,email:d,phone:g,password:N}=l;if(!d||!N)throw new Error("이메일과 비밀번호가 필요합니다.");if(N.length<6)throw new Error("비밀번호는 6자 이상이어야 합니다.");const S=await Mt(z,d,N);await Qe(S.user,{displayName:a||d.split("@")[0]});const E=ae(K,"users",S.user.uid);await Ne(E,{name:a||(d.split("@")[0]??"user"),email:d,phone:g||null,role:"user",isActive:!0,createdAt:xe(),updatedAt:xe()},{merge:!0});try{await Pe(S.user,{url:`${window.location.origin}/`,handleCodeInApp:!1}),console.log("이메일 인증 메일 전송 성공:",d)}catch(x){console.warn("이메일 인증 메일 전송 실패:",x)}return await ve(z),!0}catch(a){throw console.error("Signup error:",a),a}},[]),f=n.useCallback(async()=>{try{const l=new $t;l.addScope("email"),l.addScope("profile"),l.setCustomParameters({prompt:"select_account"});const d=(await It(z,l)).user;if(console.log("Google login success:",{uid:d.uid,email:d.email,displayName:d.displayName,emailVerified:d.emailVerified}),!d.email)throw new Error("Google 계정에서 이메일 정보를 가져올 수 없습니다.");const g=ae(K,"users",d.uid);let N={name:d.displayName||d.email.split("@")[0]||"user",email:d.email,phone:d.phoneNumber||null,role:"user",isActive:!0,updatedAt:xe()};try{(await Te(g)).exists()?(await Ne(g,N,{merge:!0}),console.log("Google 로그인: 기존 사용자 정보 업데이트됨:",d.uid)):(await Ne(g,{...N,createdAt:xe()}),console.log("Google 로그인: 새 사용자 정보 저장됨:",d.uid))}catch(S){console.warn("Firestore 저장 실패, 하지만 로그인은 계속 진행:",S)}return!0}catch(l){throw console.error("Google login error:",l),l.code==="auth/popup-closed-by-user"||l.code==="auth/cancelled-popup-request"?new Error("Google 로그인이 취소되었습니다."):l.code==="auth/popup-blocked"?new Error("팝업이 차단되었습니다. 브라우저 설정에서 팝업을 허용해주세요."):l.code==="auth/network-request-failed"?new Error("네트워크 연결을 확인해주세요."):new Error(`Google 로그인 실패: ${l.message||"알 수 없는 오류"}`)}},[]),v=n.useCallback(async()=>{if(z.currentUser)return await Pe(z.currentUser),!0;throw new Error("로그인이 필요합니다.")},[]),u=n.useCallback(async(l,a)=>{if(z.currentUser){await Qe(z.currentUser,{displayName:l,photoURL:a});const d=ae(K,"users",z.currentUser.uid);return await Ne(d,{name:l||z.currentUser.displayName,updatedAt:xe()},{merge:!0}),!0}throw new Error("로그인이 필요합니다.")},[]),y=n.useCallback(async()=>{await ve(z),s(null),h(!1)},[]);return n.useMemo(()=>({user:t,login:i,logout:y,signup:C,adminLogin:b,googleLogin:f,sendVerificationEmail:v,updateUserProfile:u,emailVerified:o,loading:c}),[t,i,y,C,b,f,v,u,o,c])},Se=()=>{const[t,s]=n.useState(!0),[o,h]=n.useState(!1),c=n.useRef(null),[m,i]=n.useState([]),[b,C]=n.useState([]),[f,v]=n.useState([]),[u,y]=n.useState([]),[l,a]=n.useState([]),d=()=>{h(!0),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{h(!1)},500)};return n.useEffect(()=>{const g=[];let N=0;const S=5,E=()=>{N++,N>=S&&s(!1)};return g.push(De(fe(K,"users"),x=>{const T=x.docs.map(D=>({id:D.id,...D.data()}));y(D=>(D.length>0&&d(),T)),E()},x=>{console.error("Error fetching users:",x),E()})),g.push(De(ze(fe(K,"bookings"),He("createdAt","desc")),x=>{const T=x.docs.map(D=>({id:D.id,...D.data()}));i(D=>(D.length>0&&d(),T)),E()},x=>{console.error("Error fetching bookings:",x),E()})),g.push(De(ze(fe(K,"programs"),He("startDate","asc")),x=>{const T=x.docs.map(D=>({id:D.id,...D.data()}));C(D=>(D.length>0&&d(),T)),E()},x=>{console.error("Error fetching programs:",x),E()})),g.push(De(ze(fe(K,"program_applications"),He("appliedAt","desc")),x=>{const T=x.docs.map(D=>({id:D.id,...D.data()}));v(D=>(D.length>0&&d(),T)),E()},x=>{console.error("Error fetching applications:",x),E()})),g.push(De(fe(K,"facilities"),x=>{const T=x.docs.map(D=>({id:D.id,...D.data()}));a(D=>(D.length>0&&d(),T)),E()},x=>{console.error("Error fetching facilities:",x),E()})),()=>{g.forEach(x=>x()),c.current&&clearTimeout(c.current)}},[]),n.useMemo(()=>({loading:t,syncing:o,bookings:m,setBookings:i,programs:b,setPrograms:C,applications:f,setApplications:v,users:u,setUsers:y,facilities:l}),[t,o,m,b,f,u,l])},rt=t=>{const s=t.replace(/\D/g,"");return s.length<=3?s:s.length<=7?`${s.slice(0,3)}-${s.slice(3)}`:`${s.slice(0,3)}-${s.slice(3,7)}-${s.slice(7,11)}`},at=t=>({"auth/user-not-found":"미가입자입니다. 회원가입을 해주세요.","auth/wrong-password":"비밀번호가 일치하지 않습니다.","auth/email-already-in-use":"이미 사용 중인 이메일입니다.","auth/weak-password":"비밀번호가 너무 간단합니다. 6자 이상 입력해주세요.","auth/invalid-email":"올바른 이메일 형식이 아닙니다.","auth/invalid-credential":"이메일 또는 비밀번호가 잘못되었습니다. 미가입자는 회원가입을 먼저 해주세요.","auth/invalid-login-credentials":"로그인 정보가 잘못되었습니다. 미가입자는 회원가입을 먼저 해주세요.","auth/too-many-requests":"로그인 시도가 너무 많습니다. 잠시 후 다시 시도하거나 브라우저 캐시를 삭제해 주세요.","firestore/permission-denied":"접근 권한이 없습니다.","firestore/unavailable":"서비스가 일시적으로 사용 불가합니다.","firestore/deadline-exceeded":"요청 시간이 초과되었습니다.","storage/unauthorized":"파일 업로드 권한이 없습니다.","storage/object-not-found":"파일을 찾을 수 없습니다.","storage/quota-exceeded":"저장소 용량이 초과되었습니다.","functions/permission-denied":"함수 실행 권한이 없습니다.","functions/unavailable":"서버 함수가 일시적으로 사용 불가합니다."})[t]||"로그인에 실패했습니다. 이메일/비밀번호를 확인하거나 회원가입을 먼저 진행해주세요.",ye=t=>{const s=t instanceof Error?t.message:String(t),o=s.match(/auth\/([\w-]+)/);return o&&o[0]?at(o[0]):at(s)},gt=n.createContext(void 0),us=({children:t})=>{const[s,o]=n.useState([]),h=n.useCallback(m=>{o(i=>i.filter(b=>b.id!==m))},[]),c=n.useCallback((m,i="info",b=5e3)=>{const C=`notification-${Date.now()}-${Math.random()}`,f={id:C,message:m,type:i,duration:b};o(v=>[...v,f]),b>0&&setTimeout(()=>{h(C)},b)},[h]);return e.jsx(gt.Provider,{value:{notifications:s,showNotification:c,removeNotification:h},children:t})},ke=()=>{const t=n.useContext(gt);if(t===void 0)throw new Error("useNotification must be used within a NotificationProvider");return t},hs=({email:t,setEmail:s,onSendLink:o,onCancel:h,submitting:c})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"forgot-password-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{id:"forgot-password-title",className:"text-xl font-bold text-gray-900 mb-2",children:"비밀번호 재설정 / Password Reset"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"가입 시 사용한 이메일 주소를 입력하세요. 재설정 링크를 보내드립니다."}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email","aria-label":"Email for password reset",value:t,onChange:m=>s(m.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:h,className:"flex-1 py-3 px-4 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all font-medium",children:"취소"}),e.jsx("button",{onClick:o,disabled:c,className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl border-2 border-transparent hover:bg-blue-600 hover:border-blue-700 transition-all font-medium",children:c?"전송 중...":"재설정 링크 보내기"})]})]})}),gs=({onConfirm:t,onCancel:s,errorText:o})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"agreement-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-2xl w-full mx-4",children:[e.jsx("h3",{id:"agreement-title",className:"text-xl font-bold text-gray-900 mb-4",children:"개인정보 수집 및 이용 동의"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"FlexSpace Pro 서비스 제공을 위해 아래와 같이 개인정보를 수집 및 이용합니다."}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"구분"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"수집 항목"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"수집 및 이용 목적"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"보유 및 이용 기간"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:"필수"}),e.jsx("td",{className:"px-4 py-3",children:"이름, 이메일"}),e.jsx("td",{className:"px-4 py-3",children:"회원 식별 및 관리, 서비스 제공 및 공지사항 전달"}),e.jsx("td",{className:"px-4 py-3",children:"회원 탈퇴 시까지"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:"선택"}),e.jsx("td",{className:"px-4 py-3",children:"전화번호"}),e.jsx("td",{className:"px-4 py-3",children:"체육관 대관 시 긴급 연락 및 알림"}),e.jsx("td",{className:"px-4 py-3",children:"회원 탈퇴 시까지"})]})]})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"※ 선택 항목을 동의하지 않아도 회원가입 및 기본 서비스 이용이 가능합니다. 단, 해당 정보가 필요한 일부 서비스(예: 대관 알림) 이용에 제한이 있을 수 있습니다."}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 font-medium",children:"필수 항목에 동의하지 않으면 회원가입이 제한됩니다."}),o&&e.jsx("p",{className:"text-sm text-red-600 mt-4 text-right",children:o}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 rounded-xl border",children:"취소"}),e.jsx("button",{onClick:t,className:"px-4 py-2 rounded-xl bg-blue-600 text-white",children:"동의하고 계속하기"})]})]})}),ps=({onLogin:t,onSignup:s,onAdminLogin:o,onGoogleLogin:h})=>{const{showNotification:c}=ke(),[m,i]=n.useState("login"),[b,C]=n.useState(""),[f,v]=n.useState(""),[u,y]=n.useState(""),[l,a]=n.useState(""),[d,g]=n.useState(""),[N,S]=n.useState(!1),[E,x]=n.useState(!1),[T,D]=n.useState(""),[R,A]=n.useState(!1),[$,M]=n.useState(""),B=async()=>{if(!T){c("이메일을 입력해주세요.","error");return}A(!0);try{await Ot(z,T),c("비밀번호 재설정 이메일을 보냈습니다. 이메일 함을 확인해주세요.","success"),x(!1)}catch(r){const p=ye(r);c(p,"error")}finally{A(!1)}},w=async()=>{const r=d.replace(/-/g,"");A(!0),M("");try{const[p,k]=await s({name:b,email:f,password:u,phone:r});p?(S(!1),c(k||"회원가입이 완료되었습니다. 이메일 인증을 확인해주세요.","success"),i("login"),y(""),a("")):M(k||"회원가입에 실패했습니다. 입력 정보를 확인해주세요.")}finally{A(!1)}},L=async r=>{if(r.preventDefault(),m==="signup"){if(!b.trim()){c("이름을 입력해주세요.","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f)){c("유효하지 않은 이메일 형식입니다.","error");return}if(u.length<6){c("비밀번호는 6자 이상이어야 합니다.","error");return}if(u!==l){c("비밀번호가 일치하지 않습니다.","error");return}}if(m!=="signup"){if(!f.trim()){c("이메일을 입력해주세요.","error");return}if(!u.trim()){c("비밀번호를 입력해주세요.","error");return}}A(!0);try{if(m==="login"){const[p,k]=await t(f,u);p?c("로그인에 성공했습니다.","success"):(c(k||"로그인에 실패했습니다. 이메일/비밀번호를 확인해주세요.","error"),k&&(k.includes("미가입자")||k.includes("회원가입을 먼저"))&&setTimeout(()=>{i("signup"),c("회원가입 페이지로 이동합니다.","info")},2e3))}else if(m==="admin_login"){const[p,k]=await o(f,u);p?c("관리자로 로그인되었습니다.","success"):c(k||"관리자 로그인에 실패했습니다. 자격을 확인해주세요.","error")}else S(!0)}finally{A(!1)}},re=r=>{const p=r.replace(/[^0-9]/g,"");return p.length<=3?p:p.length<=7?`${p.slice(0,3)}-${p.slice(3)}`:`${p.slice(0,3)}-${p.slice(3,7)}-${p.slice(7,11)}`};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:[e.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-sm border border-gray-100 p-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center mr-2",children:e.jsx(se,{className:"w-6 h-6 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"FlexSpace Pro"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{type:"button",onClick:()=>i("login"),className:`flex-1 py-2 rounded-xl border ${m==="login"?"bg-blue-50 text-blue-700 border-blue-200":"bg-white"}`,children:"로그인"}),e.jsx("button",{type:"button",onClick:()=>i("signup"),className:`flex-1 py-2 rounded-xl border ${m==="signup"?"bg-purple-50 text-purple-700 border-purple-200":"bg-white"}`,children:"회원가입"}),e.jsx("button",{type:"button",onClick:()=>i("admin_login"),className:`flex-1 py-2 rounded-xl border ${m==="admin_login"?"bg-green-50 text-green-700 border-green-200":"bg-white"}`,children:"관리자"})]}),e.jsxs("form",{onSubmit:L,children:[m==="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Gt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 / Name",value:b,onChange:r=>C(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email",value:f,onChange:r=>v(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Wt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"tel",placeholder:"전화번호 (선택) / Phone (Optional)",value:d,onChange:r=>g(re(r.target.value)),maxLength:13,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 / Password",value:u,onChange:r=>y(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 확인 / Confirm Password",value:l,onChange:r=>a(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]})]}),m!=="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Ge,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email",value:f,onChange:r=>v(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 / Password",value:u,onChange:r=>y(r.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),m==="login"&&e.jsx("div",{className:"text-right mb-4",children:e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>{x(!0),D(f)},children:"비밀번호 재설정"})})]}),e.jsxs("button",{type:"submit",disabled:R,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl border-2 border-transparent hover:bg-blue-600 hover:border-blue-700 transition-all font-semibold",children:[m==="login"&&"로그인 / Login",m==="signup"&&"회원가입 / Sign Up",m==="admin_login"&&"관리자 로그인 / Admin Login"]})]}),m!=="admin_login"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-6 flex items-center",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"px-4 text-sm text-gray-500",children:"또는"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsxs("button",{type:"button",onClick:async()=>{A(!0);try{const[r,p]=await h();r?c("Google 로그인에 성공했습니다.","success"):c(p||"Google 로그인에 실패했습니다.","error")}finally{A(!1)}},disabled:R,className:"w-full py-3 px-4 border border-gray-300 rounded-xl hover:bg-gray-50 transition-all font-medium flex items-center justify-center gap-3",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Google로 ",m==="login"?"로그인":"가입하기"]})]})]}),N&&e.jsx(gs,{onConfirm:w,onCancel:()=>S(!1),errorText:$}),E&&e.jsx(hs,{email:T,setEmail:D,onSendLink:B,onCancel:()=>x(!1),submitting:R})]})},bs=We();function fs(t){const s="=".repeat((4-t.length%4)%4),o=(t+s).replace(/\-/g,"+").replace(/_/g,"/"),h=window.atob(o),c=new Uint8Array(h.length);for(let m=0;m<h.length;++m)c[m]=h.charCodeAt(m);return c}const ys=Ae(bs,"subscribeToPush");function js(){const[t,s]=n.useState(!1),[o,h]=n.useState(!1),[c,m]=n.useState(null),[i,b]=n.useState(null),[C,f]=n.useState(!0);return n.useEffect(()=>{"serviceWorker"in navigator&&"PushManager"in window?(s(!0),navigator.serviceWorker.ready.then(u=>{u.pushManager.getSubscription().then(y=>{y&&(h(!0),m(y)),f(!1)})})):f(!1)},[]),{isSupported:t,isSubscribed:o,subscription:c,subscribe:async()=>{if(!t){b(new Error("?몄떆 ?뚮┝??吏?먮릺吏 ?딅뒗 釉뚮씪?곗??낅땲??"));return}try{const u=await navigator.serviceWorker.register("/sw.js"),y="BPUSPTkxzpJSvhJ4krhwlP0K6U0p_B9xJ3fSgyDWpb4VdbceR571GFI9eOH4tgh4I64IXO9ZywTS4ihtabf1z_8",l=await u.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:fs(y)});return await ys({subscription:l.toJSON()}),m(l),h(!0),b(null),l}catch(u){throw console.error("?몄떆 援щ룆 ?ㅽ뙣:",u),b(u),u}},error:i,loading:C}}const ws=()=>{const{isSubscribed:t,subscribe:s,loading:o,error:h}=js();return o?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 flex items-center",disabled:!0,children:[e.jsx(Ut,{className:"w-4 h-4 mr-2 animate-spin"}),"알림 상태 확인 중..."]}):t?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-gray-700 flex items-center",disabled:!0,children:[e.jsx(Kt,{className:"w-4 h-4 mr-2"}),"알림이 활성화되었습니다"]}):h?e.jsxs("button",{className:"w-full text-left px-4 py-2 text-sm text-red-700 flex items-center",disabled:!0,children:[e.jsx(XCircle,{className:"w-4 h-4 mr-2"}),"알림을 활성화할 수 없습니다"]}):e.jsxs("button",{onClick:s,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",children:[e.jsx(Jt,{className:"w-4 h-4 mr-2"}),"알림 활성화하기"]})},vs=({currentUser:t,activeTab:s,setActiveTab:o,onLogout:h})=>{const[c,m]=n.useState(!1),[i,b]=n.useState(!1),C=n.useRef(null),f="flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-200",v={dashboard:"bg-blue-50 text-blue-600 font-semibold",booking:"bg-blue-50 text-blue-600 font-semibold",program:"bg-purple-50 text-purple-600 font-semibold",admin:"bg-green-50 text-green-600 font-semibold",userManagement:"bg-yellow-50 text-yellow-700 font-semibold",facilities:"bg-indigo-50 text-indigo-600 font-semibold"},u="text-gray-600 hover:bg-gray-100 hover:text-gray-900 hover:-translate-y-px";n.useEffect(()=>{const l=a=>{C.current&&!C.current.contains(a.target)&&m(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const y=l=>{o(l),b(!1)};return e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-0 z-40",children:[e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:"FlexSpace Pro"})]}),e.jsxs("nav",{className:"hidden md:flex space-x-2",children:[e.jsxs("button",{onClick:()=>y("dashboard"),className:`${f} ${s==="dashboard"?v.dashboard:u}`,children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"대시보드 / Dashboard"})]}),e.jsxs("button",{onClick:()=>y("booking"),className:`${f} ${s==="booking"?v.booking:u}`,children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"체육관 대관 / Booking"})]}),e.jsxs("button",{onClick:()=>y("program"),className:`${f} ${s==="program"?v.program:u}`,children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:"프로그램 / Program"})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y("admin"),className:`${f} ${s==="admin"?v.admin:u}`,children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{children:"운영 관리 / Operations"})]}),e.jsxs("button",{onClick:()=>y("facilities"),className:`${f} ${s==="facilities"?v.facilities:u}`,children:[e.jsx(st,{className:"w-4 h-4"}),e.jsx("span",{children:"시설 관리 / Facilities"})]}),e.jsxs("button",{onClick:()=>y("userManagement"),className:`${f} ${s==="userManagement"?v.userManagement:u}`,children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"회원 관리 / Users"})]})]})]}),e.jsx("button",{onClick:()=>b(!i),className:"md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors",children:i?e.jsx(mt,{className:"w-5 h-5"}):e.jsx(Xt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",ref:C,children:[e.jsxs("button",{onClick:()=>m(!c),className:"flex items-center space-x-2 cursor-pointer p-2 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("span",{className:"text-sm text-gray-600 font-medium hidden sm:block",children:[t.name," (",t.role==="admin"?"관리자":"사용자",")"]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600",children:t.name.charAt(0).toUpperCase()})]}),c&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 origin-top-right animate-on-load",style:{animationName:"fadeInUp",animationDuration:"0.2s"},children:e.jsxs("div",{className:"py-1",role:"menu","aria-orientation":"vertical","aria-labelledby":"options-menu",children:[e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-700 border-b",children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.email})]}),e.jsxs("div",{className:"py-1",children:[e.jsx(ws,{}),e.jsxs("button",{onClick:h,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",role:"menuitem",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),"로그아웃 / Logout"]})]})]})})]})]}),i&&e.jsx("div",{className:"md:hidden bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-2 space-y-1",children:[e.jsxs("button",{onClick:()=>y("dashboard"),className:`w-full text-left ${f} ${s==="dashboard"?v.dashboard:u}`,children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"대시보드 / Dashboard"})]}),e.jsxs("button",{onClick:()=>y("booking"),className:`w-full text-left ${f} ${s==="booking"?v.booking:u}`,children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"체육관 대관 / Booking"})]}),e.jsxs("button",{onClick:()=>y("program"),className:`w-full text-left ${f} ${s==="program"?v.program:u}`,children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:"프로그램 / Program"})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y("admin"),className:`w-full text-left ${f} ${s==="admin"?v.admin:u}`,children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{children:"운영 관리 / Operations"})]}),e.jsxs("button",{onClick:()=>y("facilities"),className:`w-full text-left ${f} ${s==="facilities"?v.facilities:u}`,children:[e.jsx(st,{className:"w-4 h-4"}),e.jsx("span",{children:"시설 관리 / Facilities"})]}),e.jsxs("button",{onClick:()=>y("userManagement"),className:`w-full text-left ${f} ${s==="userManagement"?v.userManagement:u}`,children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"회원 관리 / Users"})]})]})]})})]})},Ns="modulepreload",Ds=function(t,s){return new URL(t,s).href},lt={},H=function(s,o,h){let c=Promise.resolve();if(o&&o.length>0){let f=function(v){return Promise.all(v.map(u=>Promise.resolve(u).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};const i=document.getElementsByTagName("link"),b=document.querySelector("meta[property=csp-nonce]"),C=b?.nonce||b?.getAttribute("nonce");c=f(o.map(v=>{if(v=Ds(v,h),v in lt)return;lt[v]=!0;const u=v.endsWith(".css"),y=u?'[rel="stylesheet"]':"";if(!!h)for(let d=i.length-1;d>=0;d--){const g=i[d];if(g.href===v&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${y}`))return;const a=document.createElement("link");if(a.rel=u?"stylesheet":Ns,u||(a.as="script"),a.crossOrigin="",a.href=v,C&&a.setAttribute("nonce",C),document.head.appendChild(a),u)return new Promise((d,g)=>{a.addEventListener("load",d),a.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${v}`)))})}))}function m(i){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=i,window.dispatchEvent(b),!b.defaultPrevented)throw i}return c.then(i=>{for(const b of i||[])b.status==="rejected"&&m(b.reason);return s().catch(m)})},Cs=n.lazy(()=>H(()=>import("./DashboardCalendar-BaHUwOCs.js"),__vite__mapDeps([0,1,2]),import.meta.url)),Ss=t=>{const s=new Date;s.setHours(0,0,0,0);const o=new Date(t.startDate);o.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=o&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((o.getTime()-s.getTime())/(1e3*60*60*24))}},nt=({status:t})=>{const s={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"},cancelled:{text:"취소됨 / Cancelled",color:"bg-gray-100 text-gray-800"}},{text:o,color:h}=s[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${h}`,children:o})},pt=["일","월","화","수","목","금","토"],ks=t=>{const{startDate:s,endDate:o,recurrenceRule:h}=t;if(s===o)return s;let c="";return h&&h.days.length>0&&(c=` (매주 / Every ${h.days.sort().map(m=>pt[m]).join(", ")})`),`${s} ~ ${o}${c}`},Es=t=>`${t.scheduleDays.sort().map(o=>pt[o]).join(",")} ${t.startTime}-${t.endTime}`,it=({currentUser:t,bookings:s=[],applications:o=[],programs:h=[],setActiveTab:c,syncing:m=!1})=>{const{users:i}=Se(),b=n.useMemo(()=>s.filter(l=>l.userId===t.id).sort((l,a)=>new Date(a.startDate).getTime()-new Date(l.startDate).getTime()),[s,t.id]),C=n.useMemo(()=>o.filter(l=>l.userId===t.id).sort((l,a)=>{const d=l.appliedAt?.toDate?l.appliedAt.toDate():new Date(l.appliedAt||0);return(a.appliedAt?.toDate?a.appliedAt.toDate():new Date(a.appliedAt||0)).getTime()-d.getTime()}),[o,t.id]),f=n.useMemo(()=>s.filter(l=>l.status==="pending"),[s]),v=n.useMemo(()=>o.filter(l=>l.status==="pending"),[o]),[u,y]=n.useState("month");return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:t.role==="admin"?"관리자 대시보드 / Admin Dashboard":"마이 대시보드 / My Dashboard"}),e.jsx("p",{className:"text-gray-600",children:t.role==="admin"?"체육관 운영 현황을 한눈에 확인하세요 / Check gym operational status at a glance":"나의 예약과 프로그램 신청 현황입니다 / View your booking and program application status"})]}),m&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"동기화 중..."})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:t.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"대기중인 대관 / Pending Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:f.length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"대기중인 프로그램 신청 / Pending Applications"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:v.length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"운영중인 프로그램 / Active Programs"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.filter(l=>{const a=new Date;return new Date(l.endDate)>=a}).length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"총 이용자 수 / Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.length})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-blue-600"})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"나의 대관 / My Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:b.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"나의 프로그램 신청 / My Applications"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:C.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"운영중인 프로그램 / Active Programs"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.length})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"최근 대관 신청 / Recent Bookings"}),e.jsxs("div",{className:"space-y-4",children:[(t.role==="admin"?s.slice(0,3):b.slice(0,3)).map(l=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100 border-l-4 border-blue-500",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:l.purpose}),e.jsx(nt,{status:l.status})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),l.organization&&`${l.organization} | `,ks(l)," ",l.startTime,"-",l.endTime]}),t.role==="admin"&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"신청자: ",l.userName," (",l.userEmail,")"]}),e.jsxs("p",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(he,{className:"w-4 h-4"}),l.category==="class"?"수업":l.category==="event"?"행사":l.category==="personal"?"개인":"동아리"," | ",l.numberOfParticipants,"명"]})]})]})})},l.id)),(t.role==="admin"?s:b).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"대관 신청 내역이 없습니다."})]}),(t.role==="admin"?s:b).length>3&&e.jsx("button",{onClick:()=>c("booking"),className:"w-full mt-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"전체 보기"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t.role==="admin"?"프로그램 신청 현황 / Program Applications":"내 프로그램 / My Programs"}),e.jsxs("div",{className:"space-y-4",children:[(t.role==="admin"?o.slice(0,3):C.slice(0,3)).map(l=>{const a=h.find(g=>g.id===l.programId),d=a?Ss(a):null;return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100 border-l-4 border-purple-500",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:a?.title||l.programTitle||"Unknown Program"}),d&&d.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",d.dDay]}),e.jsx(nt,{status:l.status})]}),a&&e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),"강사: ",a.instructor," | 기간: ",a.startDate," ~ ",a.endDate]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"일정: ",Es(a)]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"비용: ",a.fee?`${a.fee.toLocaleString()}원`:"무료"," | 정원: ",a.enrolled??0," / ",a.capacity,"명"]})]}),t.role==="admin"&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"신청자: ",l.userName," | 신청일: ",(l.appliedAt?.toDate?l.appliedAt.toDate():new Date(l.appliedAt||0)).toLocaleDateString()]})]})})},l.id)}),(t.role==="admin"?o:C).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"프로그램 신청 내역이 없습니다."})]}),(t.role==="admin"?o:C).length>3&&e.jsx("button",{onClick:()=>c("program"),className:"w-full mt-4 py-2 text-sm font-medium text-purple-600 hover:text-purple-800 transition-colors",children:"전체 보기"})]})]}),e.jsxs("div",{id:"dashboard-calendar-section",className:"mt-6 bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"전체 일정 캘린더 / Full Schedule Calendar"}),e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"text-gray-500",children:"캘린더 로딩 중..."}),children:e.jsx(Cs,{bookings:t.role==="admin"?s:b,programs:h,view:u,setView:y})})]})]})},Ts=We(ht),Ps=({value:t,onChange:s,min:o=1,max:h})=>{const c=()=>{const b=t+1;(h===void 0||b<=h)&&s(b)},m=()=>{const b=t-1;(o===void 0||b>=o)&&s(b)},i=b=>{const C=parseInt(b.target.value.replace(/[^0-9]/g,""),10);isNaN(C)?b.target.value===""&&s(o):(o===void 0||C>=o)&&(h===void 0||C<=h)?s(C):o!==void 0&&C<o&&s(o)};return e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:t,onChange:i,className:"w-full p-3 border border-gray-200 rounded-xl text-center"}),e.jsxs("div",{className:"absolute right-2 flex flex-col",children:[e.jsx("button",{type:"button",onClick:c,className:"p-1 text-gray-500 hover:text-gray-800",children:e.jsx(Zt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:m,className:"p-1 text-gray-500 hover:text-gray-800",children:e.jsx(Qt,{className:"w-4 h-4"})})]})]})},As=Ae(Ts,"createBooking"),_s=n.memo(({status:t})=>{const s={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"},cancelled:{text:"취소됨 / Cancelled",color:"bg-gray-100 text-gray-800"}},{text:o,color:h}=s[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${h}`,children:o})}),Ms=["일","월","화","수","목","금","토"],$s=t=>{const{startDate:s,endDate:o,recurrenceRule:h}=t;if(s===o)return s;let c="";return h&&h.days.length>0&&(c=` (매주 / Every ${h.days.sort().map(m=>Ms[m]).join(", ")})`),`${s} ~ ${o}${c}`},ot=n.memo(({booking:t})=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.organization?`${t.organization} | `:"",$s(t)," ",t.startTime,"-",t.endTime]})]}),e.jsx(_s,{status:t.status})]})})),Is=({currentUser:t,bookings:s,setBookings:o,syncing:h=!1})=>{const{facilities:c}=Se(),{showNotification:m}=ke(),[i,b]=n.useState({purpose:"",category:"training",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00",facilityId:""}),[C,f]=n.useState(!1),[v,u]=n.useState("list"),[y,l]=n.useState(new Date),a=n.useMemo(()=>s.filter(x=>x.userId===t.id&&x.status!=="completed"),[s,t.id]),d=n.useMemo(()=>s.filter(x=>x.userId===t.id&&x.status==="completed"),[s,t.id]),g=n.useCallback(()=>{const x=y.getFullYear(),T=y.getMonth(),D=new Date(x,T,1),R=new Date(D);R.setDate(R.getDate()-D.getDay());const A=[];for(let $=0;$<42;$++){const M=new Date(R);M.setDate(R.getDate()+$),A.push(M)}return A},[y]),N=n.useCallback(x=>(x.toISOString().split("T")[0],s.filter(T=>{const D=new Date(T.startDate),R=new Date(T.endDate);return x>=D&&x<=R})),[s]),S=n.useCallback(x=>{l(T=>{const D=new Date(T);return D.setMonth(T.getMonth()+(x==="next"?1:-1)),D})},[]),E=n.useCallback(async x=>{x.preventDefault(),f(!0),m("대관 신청을 처리 중입니다...","info");try{if(!i.purpose||i.purpose.trim().length===0){m("대관 목적을 입력해주세요.","error");return}if(i.purpose.trim().length<2){m("체육관 목적을 최소 2글자 이상 입력해 주세요.","error");return}if(!i.category||!i.startDate||!i.endDate||!i.startTime||!i.endTime){m("모든 필수 항목을 입력해주세요.","error");return}const T=new Date(i.startDate),D=new Date(i.endDate),R=new Date;if(R.setHours(0,0,0,0),T<R){m("시작일은 오늘 이후로 선택해주세요.","error");return}if(D<T){m("종료일은 시작일 이후로 선택해주세요.","error");return}if(i.startTime>=i.endTime){m("종료 시간은 시작 시간 이후로 선택해주세요.","error");return}if(!i.facilityId){m("시설을 선택해주세요.","error");return}const A=c.find(p=>p.id===i.facilityId);if(!A){m("선택된 시설을 찾을 수 없습니다.","error");return}const $=A.bookingPolicy,M=$?.allowOverlap||!1,B=$?.maxConcurrent||1,w=s.filter(p=>{if(p.facilityId!==i.facilityId||p.status!=="approved"&&p.status!=="pending")return!1;const k=new Date(p.startDate),I=new Date(p.endDate),Z=new Date(i.startDate),J=new Date(i.endDate);if(!(k<=J&&I>=Z))return!1;const[q,O]=p.startTime.split(":").map(Number),[P,X]=p.endTime.split(":").map(Number),[G,ne]=i.startTime.split(":").map(Number),[Q,ee]=i.endTime.split(":").map(Number),ie=q*60+O,oe=P*60+X,je=G*60+ne,we=Q*60+ee;return ie<we&&oe>je});if(!M&&w.length>0){m("이 시설은 단독 사용만 가능합니다. 같은 시간에 다른 예약이 있어 신청할 수 없습니다.","error");return}if(M&&w.length>=B){m(`이 시설은 최대 ${B}팀까지 동시 사용 가능합니다. 현재 ${w.length}팀이 예약되어 있어 추가 신청이 불가합니다.`,"error");return}const L={purpose:i.purpose,category:i.category,numberOfParticipants:i.numberOfParticipants||1,facilityId:A.id,startDate:i.startDate,endDate:i.endDate,startTime:i.startTime,endTime:i.endTime},re=`booking-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,r={id:re,...L,userId:t.id,userName:t.name,userEmail:t.email,status:"pending",createdAt:new Date};o(p=>[r,...p]),m("대관 신청이 완료되었습니다! 관리자 승인 후 확정됩니다.","success"),b({purpose:"",category:"training",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00",facilityId:""}),console.log("대관 신청 요청 데이터:",L);try{const p=await As(L);console.log("대관 신청 Firebase 저장 성공:",p),p?.data?.bookingId&&p.data.bookingId!==re&&o(k=>k.map(I=>I.id===re?{...I,id:p.data.bookingId}:I))}catch(p){console.warn("Firebase Function 호출 실패 (사용자는 이미 성공 피드백 받음):",p)}}catch(T){const D=T instanceof Error?T.message:"예약 실패: 알 수 없는 오류";m(D,"error")}finally{f(!1)}},[i,c,m,t,o]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"체육관 대관 / Gym Booking"}),e.jsx("p",{className:"text-gray-600",children:"체육관 공간을 예약하고 관리하세요 / Book and manage gym spaces"}),h&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mt-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs",children:"동기화 중..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>u("list"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${v==="list"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(es,{className:"w-4 h-4"}),"목록 / List"]}),e.jsxs("button",{onClick:()=>u("calendar"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${v==="calendar"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(te,{className:"w-4 h-4"}),"캘린더 / Calendar"]})]})]}),v==="list"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"진행중인 대관 / Active Bookings"}),e.jsxs("div",{className:"space-y-3",children:[a.map(x=>e.jsx(ot,{booking:x},x.id)),a.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"진행중인 대관 신청이 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"완료된 대관 / Completed Bookings"}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:[d.map(x=>e.jsx(ot,{booking:x},x.id)),d.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"완료된 대관이 없습니다."})]})]})]})}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[y.getFullYear(),"년 ",y.getMonth()+1,"월"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>S("prev"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(ts,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>l(new Date),className:"px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"오늘"}),e.jsx("button",{onClick:()=>S("next"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(ss,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-px mb-2",children:["일","월","화","수","목","금","토"].map(x=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500",children:x},x))}),e.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-200 rounded-lg overflow-hidden",children:g().map((x,T)=>{const D=N(x),R=x.getMonth()===y.getMonth(),A=x.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`bg-white p-2 min-h-[120px] ${R?"text-gray-900":"text-gray-400"} ${A?"bg-blue-50":""}`,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${A?"text-blue-600":""}`,children:x.getDate()}),e.jsxs("div",{className:"space-y-1",children:[D.slice(0,3).map($=>e.jsx("div",{className:`text-xs px-2 py-1 rounded text-white text-center truncate ${$.status==="approved"?"bg-green-500":$.status==="pending"?"bg-orange-500":$.status==="rejected"?"bg-red-500":"bg-gray-500"}`,title:`${$.purpose} (${$.startTime}-${$.endTime})`,children:$.purpose},$.id)),D.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",D.length-3," more"]})]})]},T)})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"승인됨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"대기중"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"거절됨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded"}),e.jsx("span",{children:"완료됨"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"신규 대관 신청"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.purpose||"",onChange:x=>b({...i,purpose:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:i.category,onChange:x=>b({...i,category:x.target.value}),children:[e.jsx("option",{value:"training",children:"훈련"}),e.jsx("option",{value:"class",children:"수업"}),e.jsx("option",{value:"event",children:"행사"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설 선택"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:i.facilityId||"",onChange:x=>b({...i,facilityId:x.target.value}),children:[e.jsx("option",{value:"",children:"시설을 선택해 주세요"}),c.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsx("div",{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.startDate||"",onChange:x=>b({...i,startDate:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.endDate||"",onChange:x=>b({...i,endDate:x.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.startTime||"",onChange:x=>b({...i,startTime:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.endTime||"",onChange:x=>b({...i,endTime:x.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"인원"}),e.jsx(Ps,{value:i.numberOfParticipants||1,onChange:x=>b({...i,numberOfParticipants:x})})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"submit",disabled:C,className:`w-full md:w-auto px-4 py-3 rounded-xl font-medium transition-all duration-200 ${C?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:C?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"신청 중..."]}):"대관 신청"})})]})]})]})]})},Os=Ae(_e,"createProgramApplication"),Ls=["일","월","화","수","목","금","토"],Fs=t=>{const s=new Date;s.setHours(0,0,0,0);const o=new Date(t.startDate);o.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=o&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((o.getTime()-s.getTime())/(1e3*60*60*24))}},bt=t=>`${(t.scheduleDays||[]).sort().map(s=>Ls[s]).join(", ")} ${t.startTime}-${t.endTime}`;n.memo(({p:t,status:s,onApply:o,applying:h,isAlreadyApplied:c,applicationStatus:m})=>e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.title}),s.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",s.dDay]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500 flex-wrap",children:[e.jsxs("span",{children:["강사: ",t.instructor]}),e.jsxs("span",{children:["기간: ",t.startDate," ~ ",t.endDate]}),e.jsxs("span",{children:["일정: ",bt(t)]}),e.jsxs("span",{children:["비용: ",t.fee?`${t.fee.toLocaleString()}원`:"무료 / Free"]}),e.jsxs("span",{children:["정원: ",t.enrolled??0," / ",t.capacity]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.text==="종료"?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:s.text}),c&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${m==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:m==="approved"?"승인됨":"신청완료"}),s.text!=="종료"&&e.jsx("button",{disabled:h||c,onClick:()=>o(t.id),className:`px-4 py-2 rounded-xl font-medium transition-colors ${c?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:c?"신청완료":h?"신청중...":"신청하기"})]})]})}));const Rs=({currentUser:t,programs:s,applications:o,setApplications:h})=>{const{showNotification:c}=ke(),[m,i]=n.useState(""),[b,C]=n.useState(null),f=n.useMemo(()=>s.filter(u=>u.title.toLowerCase().includes(m.toLowerCase())),[s,m]),v=n.useCallback(async u=>{const y=o.find(a=>a.programId===u&&a.userId===t.id&&(a.status==="pending"||a.status==="approved"));if(y){const a=y.status==="pending"?"대기중":"승인됨";c(`이미 이 프로그램에 신청하셨습니다. (현재 상태: ${a})`,"warning");return}C(u);const l={id:`temp-${Date.now()}`,userId:t.id,programId:u,status:"pending",appliedAt:new Date,userName:t.name,userEmail:t.email,programTitle:s.find(a=>a.id===u)?.title||"Unknown Program"};h(a=>[l,...a]),c("프로그램 신청이 완료되었습니다. 관리자 승인을 기다려주세요.","success");try{const a=await Os({programId:u});if(a?.data?.success)h(d=>d.map(g=>g.id===l.id?{...g,id:a.data.applicationId}:g)),console.log("프로그램 신청 Firebase 저장 성공:",a.data.applicationId);else{h(g=>g.filter(N=>N.id!==l.id));const d=a?.data?.message||"신청에 실패했습니다. 잠시 후 다시 시도해주세요.";c(d,"error")}}catch(a){h(d=>d.filter(g=>g.id!==l.id)),c(`신청 실패: ${a?.message||"네트워크 오류가 발생했습니다. 잠시 후 다시 시도해주세요."}`,"error")}finally{C(null)}},[c,t,s,h,o]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"프로그램"}),e.jsx("p",{className:"text-gray-600",children:"다양한 체육 프로그램에 참여해보세요"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"검색"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(xt,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{value:m,onChange:u=>i(u.target.value),placeholder:"프로그램명, 강사명...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"종목"}),e.jsx("option",{value:"yoga",children:"요가"}),e.jsx("option",{value:"pilates",children:"필라테스"}),e.jsx("option",{value:"fitness",children:"피트니스"}),e.jsx("option",{value:"dance",children:"댄스"}),e.jsx("option",{value:"badminton",children:"배드민턴"}),e.jsx("option",{value:"pickleball",children:"피클볼"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"요일"}),e.jsx("option",{value:"월",children:"월요일"}),e.jsx("option",{value:"화",children:"화요일"}),e.jsx("option",{value:"수",children:"수요일"}),e.jsx("option",{value:"목",children:"목요일"}),e.jsx("option",{value:"금",children:"금요일"}),e.jsx("option",{value:"토",children:"토요일"}),e.jsx("option",{value:"일",children:"일요일"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"시간대"}),e.jsx("option",{value:"morning",children:"오전 (06:00-12:00)"}),e.jsx("option",{value:"afternoon",children:"오후 (12:00-18:00)"}),e.jsx("option",{value:"evening",children:"저녁 (18:00-22:00)"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"레벨"}),e.jsx("option",{value:"beginner",children:"초급"}),e.jsx("option",{value:"intermediate",children:"중급"}),e.jsx("option",{value:"advanced",children:"고급"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["진행중인 프로그램 (",f.length,"개)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-purple-600 bg-purple-50 rounded-lg",children:"필라테스"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg",children:"진행 중"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-green-600 bg-green-50 rounded-lg",children:"초급"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:f.map(u=>{const y=Fs(u),l=o.find(d=>d.programId===u.id&&d.userId===t.id&&(d.status==="pending"||d.status==="approved")),a=!!l;return e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:u.title}),y.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",y.dDay]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:u.description})]}),e.jsxs("div",{className:"ml-4 flex flex-col gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${y.text==="종료"?"bg-gray-100 text-gray-800":y.text==="진행중"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:y.text}),a&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${l?.status==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:l?.status==="approved"?"승인됨":"신청완료"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{children:["강사: ",u.instructor]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsxs("span",{children:["기간: ",u.startDate," ~ ",u.endDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsxs("span",{children:["일정: ",bt(u)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsxs("span",{children:["정원: ",u.enrolled??0," / ",u.capacity,"명"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:u.fee?`${u.fee.toLocaleString()}원`:"무료"}),y.text!=="종료"&&e.jsx("button",{disabled:b===u.id||a,onClick:()=>v(u.id),className:`px-6 py-2 rounded-xl font-medium transition-colors ${a?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50"}`,children:a?"신청완료":b===u.id?"신청중...":"신청하기"})]})]})},u.id)})}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"검색 결과가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"다른 조건으로 검색해보세요."})]})]})},Vs=n.lazy(()=>H(()=>import("./DashboardCalendar-BaHUwOCs.js"),__vite__mapDeps([0,1,2]),import.meta.url));Ae(_e,"updateReservationStatus");const ft=["일","월","화","수","목","금","토"],Bs=t=>{const s=new Date;s.setHours(0,0,0,0);const o=new Date(t.startDate);o.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=o&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((o.getTime()-s.getTime())/(1e3*60*60*24))}},zs=n.memo(({b:t,onAction:s})=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.userName," | ",t.startDate," ",t.startTime,"-",t.endTime]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t.id,"approve"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>s(t.id,"reject"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})})),Hs=n.memo(({p:t,onEdit:s,onDelete:o})=>{const h=Bs(t);return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.title}),h.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",h.dDay]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.instructor," | ",t.startDate," ~ ",t.endDate," | ",t.startDate!==t.endDate?(t.scheduleDays||[]).slice().sort().map(c=>ft[c]).join(","):"단일"," | ",t.startTime," - ",t.endTime," | ",t.fee?`${t.fee.toLocaleString()}원`:"무료"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>o(t),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]})});function qs({currentUser:t,bookings:s,setBookings:o,applications:h,setApplications:c,programs:m,setPrograms:i,users:b,facilities:C}){const{showNotification:f}=ke();console.log("🔍 AdminSection 프로그램 데이터 확인:",{programsCount:m.length,programs:m,activePrograms:m.filter(r=>{const p=new Date;return new Date(r.endDate)>=p}).length});const[v,u]=n.useState(!1),[y,l]=n.useState(null),[a,d]=n.useState("month"),g={title:"",description:"",instructor:"",capacity:10,scheduleDays:[],startTime:"09:00",endTime:"10:00",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],level:"beginner",category:"yoga",fee:0},[N,S]=n.useState(g),E=n.useMemo(()=>N.startDate!==N.endDate,[N.startDate,N.endDate]),x=n.useMemo(()=>{const r=[];for(let p=0;p<24;p++)for(let k=0;k<60;k+=10)r.push(`${String(p).padStart(2,"0")}:${String(k).padStart(2,"0")}`);return r},[]),T=n.useCallback(async()=>{const r={...y??{id:`program-${Date.now()}`},...N};y?(i(p=>p.map(k=>k.id===r.id?r:k)),f("프로그램이 수정되었습니다.","success")):(i(p=>[r,...p]),f("새 프로그램이 개설되었습니다.","success"));try{const{doc:p,setDoc:k,updateDoc:I,serverTimestamp:Z}=await H(async()=>{const{doc:q,setDoc:O,updateDoc:P,serverTimestamp:X}=await import("./firebase-DnP1Uaxu.js").then(G=>G.M);return{doc:q,setDoc:O,updateDoc:P,serverTimestamp:X}},[],import.meta.url),{db:J}=await H(async()=>{const{db:q}=await Promise.resolve().then(()=>le);return{db:q}},void 0,import.meta.url),V=new Date;y?(await I(p(J,"programs",r.id),{...r,updatedAt:V}),console.log("프로그램 수정 완료:",r.id)):(await k(p(J,"programs",r.id),{...r,createdAt:V,updatedAt:V}),console.log("새 프로그램 생성 완료:",r.id))}catch(p){console.warn("Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",p)}u(!1),l(null)},[N,y,i,f]),D=n.useCallback(async(r,p)=>{console.log("=== 대관 승인/거절 시작 ===",{bookingId:r,action:p});const k=p==="approve"?"approved":"rejected";try{console.log("1. 로컬 상태 업데이트 실행"),o(O=>O.map(P=>P.id===r?{...P,status:k}:P)),f(`대관이 ${p==="approve"?"승인":"거절"}되었습니다.`,"success"),console.log("3. Firebase 저장 시작");const{doc:I,updateDoc:Z,serverTimestamp:J}=await H(async()=>{const{doc:O,updateDoc:P,serverTimestamp:X}=await import("./firebase-DnP1Uaxu.js").then(G=>G.M);return{doc:O,updateDoc:P,serverTimestamp:X}},[],import.meta.url),{db:V}=await H(async()=>{const{db:O}=await Promise.resolve().then(()=>le);return{db:O}},void 0,import.meta.url),q={status:k,updatedAt:J(),[p==="approve"?"approvedAt":"rejectedAt"]:J()};console.log("3-1. 업데이트할 데이터:",q),console.log("3-2. 대상 문서:",`bookings/${r}`),await Z(I(V,"bookings",r),q),console.log("✅ Firebase 저장 성공 - 실시간 동기화 보장됨")}catch(I){console.error("❌ Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",I)}},[s,o,f]),R=n.useCallback(async(r,p)=>{const k=h;try{c(O=>O.map(P=>P.id===r?{...P,status:p}:P));const{doc:I,updateDoc:Z,serverTimestamp:J}=await H(async()=>{const{doc:O,updateDoc:P,serverTimestamp:X}=await import("./firebase-DnP1Uaxu.js").then(G=>G.M);return{doc:O,updateDoc:P,serverTimestamp:X}},[],import.meta.url),{db:V}=await H(async()=>{const{db:O}=await Promise.resolve().then(()=>le);return{db:O}},void 0,import.meta.url),q=new Date;await Z(I(V,"program_applications",r),{status:p,updatedAt:q,[p==="approved"?"approvedAt":"rejectedAt"]:q}),console.log("프로그램 신청 상태 Firebase 저장 성공:",r,p),f(`프로그램 신청이 ${p==="approved"?"승인":"거절"}되었습니다.`,"success")}catch(I){console.error("프로그램 신청 상태 업데이트 실패:",I),c(k),f("프로그램 신청 상태 변경에 실패했습니다. 다시 시도해주세요.","error")}},[h,c,f]),A=n.useMemo(()=>s.filter(r=>r.status==="pending"),[s]),$=n.useMemo(()=>h.filter(r=>r.status==="pending"),[h]),M=n.useMemo(()=>m.filter(r=>{const p=new Date;return new Date(r.endDate)>=p}),[m]),B=n.useMemo(()=>b.length,[b]),[w,L]=n.useState({name:"",category:"class",purpose:"",facilityId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"}),re=n.useCallback(async()=>{if(!w.name||w.name.trim().length===0){f("신청자 이름을 입력해주세요.","error");return}if(!w.purpose||w.purpose.trim().length===0){f("대관 목적을 입력해주세요.","error");return}if(!w.facilityId){f("시설을 선택해주세요.","error");return}const r=new Date(w.startDate+"T00:00:00");if(new Date(w.endDate+"T00:00:00")<r){f("종료일은 시작일 이후로 선택해주세요.","error");return}if(w.startTime>=w.endTime){f("종료 시간은 시작 시간 이후로 선택해주세요.","error");return}const k=C.find(P=>P.id===w.facilityId);if(!k){f("선택된 시설을 찾을 수 없습니다.","error");return}const I=k.bookingPolicy,Z=I?.allowOverlap||!1,J=I?.maxConcurrent||1,V=s.filter(P=>{if(P.facilityId!==w.facilityId||P.status!=="approved")return!1;const X=new Date(P.startDate),G=new Date(P.endDate),ne=new Date(w.startDate),Q=new Date(w.endDate);if(!(X<=Q&&G>=ne))return!1;const[ie,oe]=P.startTime.split(":").map(Number),[je,we]=P.endTime.split(":").map(Number),[Me,$e]=w.startTime.split(":").map(Number),[Ie,Ee]=w.endTime.split(":").map(Number),pe=ie*60+oe,j=je*60+we,_=Me*60+$e,W=Ie*60+Ee;return pe<W&&j>_});if(!Z&&V.length>0){f("이 시설은 단독 사용만 가능합니다. 같은 시간에 다른 예약이 있어 등록할 수 없습니다.","error");return}if(Z&&V.length>=J){f(`이 시설은 최대 ${J}팀까지 동시 사용 가능합니다. 현재 ${V.length}팀이 예약되어 있어 추가 등록이 불가합니다.`,"error");return}const q=`booking-${Date.now()}`,O={id:q,userId:t.id,userName:w.name,userEmail:t.email,facilityId:w.facilityId,startDate:w.startDate,endDate:w.endDate,startTime:w.startTime,endTime:w.endTime,purpose:w.purpose,category:w.category,status:"approved",numberOfParticipants:1,createdAt:new Date};o(P=>[O,...P]),f("대관이 승인되어 등록되었습니다.","success");try{const{doc:P,setDoc:X,serverTimestamp:G}=await H(async()=>{const{doc:Q,setDoc:ee,serverTimestamp:ie}=await import("./firebase-DnP1Uaxu.js").then(oe=>oe.M);return{doc:Q,setDoc:ee,serverTimestamp:ie}},[],import.meta.url),{db:ne}=await H(async()=>{const{db:Q}=await Promise.resolve().then(()=>le);return{db:Q}},void 0,import.meta.url);await X(P(ne,"bookings",q),{...O,createdAt:G(),updatedAt:G(),approvedAt:G()}),console.log("대관 신청 Firebase 저장 성공:",q)}catch(P){console.warn("Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",P)}L({name:"",category:"class",purpose:"",facilityId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"})},[w,t,o,f,C,s]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"운영 관리"}),e.jsx("p",{className:"text-gray-600",children:"대관 및 프로그램 신청을 관리하고, 체육관 직접 등록을 할 수 있습니다"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기중인 대관"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:A.length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기중인 프로그램 신청"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:$.length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"운영중인 프로그램"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:M.length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"총 이용자 수"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:B})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"수강생/팀 직접 등록"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"아래 폼을 사용하여 대관을 등록하세요"})]}),e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"신청자 이름"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",placeholder:"예: 관리자 등록",value:w.name,onChange:r=>L({...w,name:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",placeholder:"대관 목적을 입력하세요",value:w.purpose,onChange:r=>L({...w,purpose:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.category,onChange:r=>L({...w,category:r.target.value}),children:[e.jsx("option",{value:"class",children:"수업"}),e.jsx("option",{value:"event",children:"행사"}),e.jsx("option",{value:"club",children:"동아리"}),e.jsx("option",{value:"personal",children:"개인"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설 선택"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.facilityId,onChange:r=>L({...w,facilityId:r.target.value}),children:[e.jsx("option",{value:"",children:"시설을 선택해 주세요"}),C.map(r=>{const p=r.bookingPolicy,k=p?.allowOverlap?`(공유사용, 최대 ${p.maxConcurrent||1}팀)`:"(단독사용)";return e.jsxs("option",{value:r.id,children:[r.name," ",k]},r.id)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.startDate,onChange:r=>L({...w,startDate:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.endDate,onChange:r=>L({...w,endDate:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.startTime,onChange:r=>L({...w,startTime:r.target.value}),children:[e.jsx("option",{value:"09:00",children:"09:00"}),e.jsx("option",{value:"10:00",children:"10:00"}),e.jsx("option",{value:"11:00",children:"11:00"}),e.jsx("option",{value:"14:00",children:"14:00"}),e.jsx("option",{value:"15:00",children:"15:00"}),e.jsx("option",{value:"16:00",children:"16:00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.endTime,onChange:r=>L({...w,endTime:r.target.value}),children:[e.jsx("option",{value:"10:00",children:"10:00"}),e.jsx("option",{value:"11:00",children:"11:00"}),e.jsx("option",{value:"12:00",children:"12:00"}),e.jsx("option",{value:"15:00",children:"15:00"}),e.jsx("option",{value:"16:00",children:"16:00"}),e.jsx("option",{value:"17:00",children:"17:00"})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"취소"}),e.jsx("button",{onClick:re,className:"px-6 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:"등록하기"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-50 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["사용자 대관 신청 대기 (",A.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:A.length>0?A.map(r=>e.jsx(zs,{b:r,onAction:D},r.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"대기중인 신청이 없습니다."})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["대기중인 프로그램 신청 (",$.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:$.length>0?$.map(r=>{const p=m.find(k=>k.id===r.programId);return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:p?.title||r.programTitle}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["신청자: ",r.userName," | 신청일: ",r.appliedAt?.toDate?.()?.toLocaleDateString()||"N/A"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>R(r.id,"approved"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>R(r.id,"rejected"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})},r.id)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"대기중인 신청이 없습니다."})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"프로그램 관리"})]}),e.jsxs("button",{onClick:()=>{l(null),S(g),u(!0)},className:"flex items-center gap-2 text-sm font-medium text-purple-600 hover:text-purple-800 px-4 py-2 rounded-lg hover:bg-purple-50",children:[e.jsx(Je,{className:"w-4 h-4"})," 새 프로그램 추가"]})]}),e.jsxs("div",{className:"space-y-3",children:[m.map(r=>e.jsx(Hs,{p:r,onEdit:p=>{l(p),S(p),u(!0)},onDelete:p=>i(k=>k.filter(I=>I.id!==p.id))},r.id)),m.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"등록된 프로그램이 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"전체 대관 캘린더"})]}),e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"text-center py-8 text-gray-500",children:"캘린더 로딩 중..."}),children:e.jsx(Vs,{bookings:s,programs:m,view:a,setView:d})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:y?"프로그램 수정":"새 프로그램 개설"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"제목"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.title,onChange:r=>S({...N,title:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"강사"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.instructor,onChange:r=>S({...N,instructor:r.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명"}),e.jsx("textarea",{className:"w-full p-3 border border-gray-200 rounded-xl",rows:3,value:N.description,onChange:r=>S({...N,description:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.startDate,onChange:r=>S({...N,startDate:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.endDate,onChange:r=>S({...N,endDate:r.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"반복 요일"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ft.map((r,p)=>e.jsx("button",{type:"button",onClick:()=>S(k=>({...k,scheduleDays:k.scheduleDays.includes(p)?k.scheduleDays.filter(I=>I!==p):[...k.scheduleDays,p]})),className:`p-2 rounded-lg border text-sm font-medium ${N.scheduleDays.includes(p)?"bg-purple-500 text-white border-purple-500":"bg-white hover:bg-gray-100 border-gray-300"} ${E?"":"opacity-50 pointer-events-none"}`,children:r},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:N.startTime,onChange:r=>S({...N,startTime:r.target.value}),children:x.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:N.endTime,onChange:r=>S({...N,endTime:r.target.value}),children:x.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"정원"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.capacity,onChange:r=>S({...N,capacity:parseInt(r.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"금액"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.fee||0,onChange:r=>S({...N,fee:parseInt(r.target.value)||0})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl border",onClick:()=>{u(!1),l(null)},children:"취소"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-purple-600 text-white",onClick:T,children:y?"수정하기":"개설하기"})]})]})})]})}const Gs=({users:t,setUsers:s})=>{const{users:o,loading:h}=Se(),c=o.length>0?o:t||[],[m,i]=n.useState(!1),[b,C]=n.useState(!1),[f,v]=n.useState(null),[u,y]=n.useState(null),[l,a]=n.useState(null),d={name:"",email:"",phone:"",password:"",role:"user"},[g,N]=n.useState(d),[S,E]=n.useState(""),[x,T]=n.useState(""),[D,R]=n.useState(""),[A,$]=n.useState(""),[M,B]=n.useState(null),[w,L]=n.useState(!1),[re,r]=n.useState(!1),[p,k]=n.useState(""),[I,Z]=n.useState("name"),[J]=n.useState("all"),[V,q]=n.useState({key:"name",direction:"asc"}),O=dt();n.useEffect(()=>{b&&setTimeout(()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new Lt(O,"recaptcha-container",{size:"invisible",callback:()=>{}}))},100)},[b,O]);const P=j=>{v(j),N({name:j.name,email:j.email,phone:j.phone||"",password:"",role:j.role}),i(!0)},X=()=>{v(null),N(d),i(!0)},G=()=>{i(!1),v(null)},ne=j=>{a(j),E(j.email),R(j.phone||""),T(""),$(""),B(null),C(!0)},Q=()=>{C(!1),a(null),window.recaptchaVerifier&&window.recaptchaVerifier.clear()},ee=j=>{const{name:_,value:W}=j.target;N(_==="phone"?F=>({...F,[_]:rt(W)}):F=>({...F,[_]:W}))},ie=async j=>{j.preventDefault(),r(!0);try{if(f){if(c.some(Y=>Y.email===g.email&&Y.id!==f.id)){alert("이미 사용 중인 이메일입니다.");return}const{doc:_,updateDoc:W,serverTimestamp:F}=await H(async()=>{const{doc:Y,updateDoc:ce,serverTimestamp:Oe}=await import("./firebase-DnP1Uaxu.js").then(Le=>Le.M);return{doc:Y,updateDoc:ce,serverTimestamp:Oe}},[],import.meta.url),{db:U}=await H(async()=>{const{db:Y}=await Promise.resolve().then(()=>le);return{db:Y}},void 0,import.meta.url),be={name:g.name,email:g.email,phone:g.phone.replace(/-/g,"")||null,role:g.role,updatedAt:F()};await W(_(U,"users",f.id),be),s&&s(Y=>Y.map(ce=>ce.id===f.id?{...ce,name:g.name,email:g.email,phone:g.phone.replace(/-/g,""),role:g.role}:ce)),alert("사용자 정보가 수정되었습니다.")}else{if(c.some(F=>F.email===g.email)){alert("이미 등록된 이메일입니다.");return}if(!g.password){alert("신규 사용자는 비밀번호가 필요합니다.");return}const{httpsCallable:_}=await H(async()=>{const{httpsCallable:F}=await import("./firebase-DnP1Uaxu.js").then(U=>U.N);return{httpsCallable:F}},[],import.meta.url),{functions:W}=await H(async()=>{const{functions:F}=await Promise.resolve().then(()=>le);return{functions:F}},void 0,import.meta.url);try{const U=await _(W,"createUserByAdmin")({name:g.name,email:g.email,phone:g.phone.replace(/-/g,"")||null,password:g.password,role:g.role});if(U.data.success){if(alert(`새 사용자 '${g.name}'이 생성되었습니다.

관리자가 생성한 계정이므로 이메일 인증 없이 바로 로그인할 수 있습니다.`),s){const be={id:U.data.uid,name:g.name,email:g.email,phone:g.phone.replace(/-/g,""),role:g.role};s(Y=>[...Y,be])}}else throw new Error(U.data.error||"사용자 생성에 실패했습니다.")}catch(F){console.warn("Cloud Functions 사용자 생성 실패, 직접 생성 방식으로 전환:",F);const{createUserWithEmailAndPassword:U,sendEmailVerification:be,updateProfile:Y,signOut:ce}=await H(async()=>{const{createUserWithEmailAndPassword:de,sendEmailVerification:me,updateProfile:Ve,signOut:Be}=await import("./firebase-DnP1Uaxu.js").then(jt=>jt.L);return{createUserWithEmailAndPassword:de,sendEmailVerification:me,updateProfile:Ve,signOut:Be}},[],import.meta.url),{doc:Oe,setDoc:Le,serverTimestamp:Xe}=await H(async()=>{const{doc:de,setDoc:me,serverTimestamp:Ve}=await import("./firebase-DnP1Uaxu.js").then(Be=>Be.M);return{doc:de,setDoc:me,serverTimestamp:Ve}},[],import.meta.url),{auth:Fe,db:yt}=await H(async()=>{const{auth:de,db:me}=await Promise.resolve().then(()=>le);return{auth:de,db:me}},void 0,import.meta.url);if(!Fe.currentUser)throw new Error("관리자 로그인이 필요합니다.");const Re=(await U(Fe,g.email,g.password)).user;if(await Y(Re,{displayName:g.name||g.email.split("@")[0]}),await Le(Oe(yt,"users",Re.uid),{name:g.name,email:g.email,phone:g.phone.replace(/-/g,"")||null,role:g.role,isActive:!0,adminCreated:!0,createdAt:Xe(),updatedAt:Xe()}),console.log("관리자가 직접 생성한 사용자이므로 이메일 인증 메일을 발송하지 않습니다."),await ce(Fe),alert(`새 사용자 '${g.name}'이 생성되었습니다.

⚠️ 새 사용자 생성으로 인해 자동 로그아웃되었습니다.
관리자 계정으로 다시 로그인해주세요.

생성된 사용자는 이메일 인증 없이 바로 로그인할 수 있습니다.`),s){const de={id:Re.uid,name:g.name,email:g.email,phone:g.phone.replace(/-/g,""),role:g.role};s(me=>[...me,de])}}}G()}catch(_){console.error("User creation/update error:",_);const W=ye(_);alert(W)}finally{r(!1)}},oe=j=>{if(j.role==="admin"&&c.filter(_=>_.role==="admin").length<=1){alert("마지막 관리자 계정은 삭제할 수 없습니다.");return}y(j)},je=async()=>{if(u){try{const{deleteDoc:j,doc:_}=await H(async()=>{const{deleteDoc:F,doc:U}=await import("./firebase-DnP1Uaxu.js").then(be=>be.M);return{deleteDoc:F,doc:U}},[],import.meta.url),{db:W}=await H(async()=>{const{db:F}=await Promise.resolve().then(()=>le);return{db:F}},void 0,import.meta.url);await j(_(W,"users",u.id)),alert("사용자가 삭제되었습니다."),s&&s(F=>F.filter(U=>U.id!==u.id))}catch(j){console.error("사용자 삭제 오류:",j),alert("사용자 삭제에 실패했습니다.")}y(null)}},we=j=>{let _="asc";V&&V.key===j&&V.direction==="asc"&&(_="desc"),q({key:j,direction:_})},Me=async()=>{if(!D){alert("휴대폰 번호를 입력하세요.");return}L(!0);try{const j=window.recaptchaVerifier,_=await Ft(O,D,j);B(_),alert("인증 코드를 발송했습니다.")}catch(j){console.error("SMS Error:",j),alert("SMS 인증 코드 요청에 실패했습니다.")}finally{L(!1)}},$e=async()=>{if(!A){alert("인증 코드를 입력하세요.");return}if(!M){alert("먼저 인증 코드를 요청하세요.");return}L(!0);try{await M.confirm(A),alert("휴대폰 인증이 완료되었습니다.")}catch(j){console.error("Verification Error:",j),alert("인증 코드가 잘못되었습니다.")}finally{L(!1)}},Ie=async()=>{if(!S||!x){alert("새 이메일과 현재 비밀번호를 입력하세요.");return}if(O.currentUser){L(!0);try{const j=Rt.credential(O.currentUser.email,x);await Vt(O.currentUser,j),await Bt(O.currentUser,S),alert("이메일 주소가 변경되었습니다. 새 주소로 인증 메일을 확인하세요."),Q()}catch(j){console.error("Email Update Error:",j),alert("이메일 변경에 실패했습니다. 비밀번호를 확인하세요.")}finally{L(!1)}}},Ee=n.useMemo(()=>{const j=c.filter(_=>J==="all"||_.role===J).filter(_=>{if(!p)return!0;const W=p.toLowerCase();return(_[I]?.toLowerCase()||"").includes(W)});return V!==null&&j.sort((_,W)=>{const F=_[V.key]||"",U=W[V.key]||"";return F<U?V.direction==="asc"?-1:1:F>U?V.direction==="asc"?1:-1:0}),j},[c,p,I,J,V]),pe=({columnKey:j,title:_})=>e.jsx("th",{onClick:()=>we(j),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:_}),V?.key===j&&e.jsx(ls,{className:"w-4 h-4 ml-2"})]})});return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{id:"recaptcha-container"}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"회원 관리"}),e.jsx("p",{className:"text-gray-600",children:"사용자 추가, 수정, 삭제"})]}),e.jsxs("button",{onClick:X,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(Je,{className:"w-5 h-5"}),e.jsx("span",{children:"새 사용자 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:I,onChange:j=>Z(j.target.value),className:"border rounded-lg px-2 py-1 text-sm",children:[e.jsx("option",{value:"name",children:"이름"}),e.jsx("option",{value:"email",children:"이메일"}),e.jsx("option",{value:"phone",children:"전화번호"})]}),e.jsx("input",{value:p,onChange:j=>k(j.target.value),placeholder:"검색어 입력",className:"flex-1 outline-none"})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:h?e.jsxs("div",{className:"flex items-center justify-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"사용자 정보를 불러오는 중..."})]}):Ee.length===0?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"등록된 사용자가 없습니다."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"새 사용자 추가 버튼을 클릭해서 사용자를 추가해보세요."})]})}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx(pe,{columnKey:"name",title:"이름"}),e.jsx(pe,{columnKey:"email",title:"이메일"}),e.jsx(pe,{columnKey:"phone",title:"전화번호"}),e.jsx(pe,{columnKey:"role",title:"권한"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Ee.map(j=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:j.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j.phone}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${j.role==="admin"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:j.role})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>ne(j),className:"p-2 text-gray-500 hover:text-green-600 rounded-lg transition-all hover:scale-110",children:e.jsx(as,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P(j),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>oe(j),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]},j.id))})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:f?"사용자 정보 수정":"새 사용자 추가"}),e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이름"}),e.jsx("input",{type:"text",name:"name",value:g.name,onChange:ee,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이메일"}),e.jsx("input",{type:"email",name:"email",value:g.email,onChange:ee,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"전화번호"}),e.jsx("input",{type:"tel",name:"phone",value:g.phone,onChange:ee,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["비밀번호 ",f&&"(변경시에만 입력)"]}),e.jsx("input",{type:"password",name:"password",value:g.password,onChange:ee,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"권한"}),e.jsxs("select",{name:"role",value:g.role,onChange:ee,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:G,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:"저장"})]})]})]})}),b&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 space-y-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["계정 설정: ",l.name]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"휴대폰 인증"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"tel",value:D,onChange:j=>R(rt(j.target.value)),placeholder:"휴대폰 번호",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:Me,disabled:w,className:"py-3 px-4 bg-gray-200 rounded-xl hover:bg-gray-300 font-medium transition-colors disabled:opacity-50",children:w?"전송중...":"인증코드 받기"})]}),M&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:A,onChange:j=>$(j.target.value),placeholder:"인증 코드 6자리",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:$e,disabled:w,className:"py-3 px-4 bg-green-500 text-white rounded-xl hover:bg-green-600 font-medium transition-colors disabled:opacity-50",children:w?"확인중...":"인증하기"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"이메일 주소 변경"}),e.jsx("input",{type:"email",value:S,onChange:j=>E(j.target.value),placeholder:"새 이메일 주소",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("input",{type:"password",value:x,onChange:j=>T(j.target.value),placeholder:"현재 비밀번호",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:Ie,disabled:w,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors disabled:opacity-50",children:w?"변경중...":"이메일 변경"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"button",onClick:Q,className:"py-3 px-6 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"닫기"})})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"사용자 삭제 확인"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["정말로 ",e.jsx("strong",{className:"text-red-600",children:u.name})," 사용자를 삭제하시겠습니까?"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>y(null),className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{onClick:je,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl hover:bg-red-600 font-medium transition-colors",children:"삭제"})]})]})})]})},Ws=()=>{const{facilities:t}=Se(),[s,o]=n.useState(!1),[h,c]=n.useState(null),m={name:"",type:"gym",capacity:1,bufferMinutes:0,bookingPolicy:{allowOverlap:!1,maxConcurrent:1,timeSlotMinutes:60}},[i,b]=n.useState(m),C=()=>{c(null),b(m),o(!0)},f=a=>{c(a),b({...a,bookingPolicy:a.bookingPolicy||{allowOverlap:!1,maxConcurrent:1,timeSlotMinutes:60}}),o(!0)},v=()=>{o(!1),c(null)},u=a=>{const{name:d,value:g,type:N}=a.target,S=N==="number";b(E=>({...E,[d]:S?Number(g):g}))},y=async a=>{if(a.preventDefault(),!i.name||i.capacity<=0){alert("시설 이름과 수용 인원을 확인해주세요.");return}try{if(h){const d=ae(K,"facilities",h.id);await Ht(d,i),alert("시설 정보가 성공적으로 수정되었습니다.")}else await qt(fe(K,"facilities"),i),alert("새 시설이 추가되었습니다.");v()}catch(d){console.error("Error saving facility: ",d),alert("처리 중 오류가 발생했습니다.")}},l=async a=>{if(window.confirm("정말로 이 시설을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{await zt(ae(K,"facilities",a)),alert("시설이 삭제되었습니다.")}catch(d){console.error("Error deleting facility: ",d),alert("삭제 중 오류가 발생했습니다.")}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"시설 관리"}),e.jsx("p",{className:"text-gray-600",children:"체육관 시설을 추가, 수정, 삭제합니다."})]}),e.jsxs("button",{onClick:C,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(Je,{className:"w-5 h-5"}),e.jsx("span",{children:"새 시설 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"이름"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"종류"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수용 인원"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"버퍼(분)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"중복 정책"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(a=>{const d=a.bookingPolicy,g=d?.allowOverlap?`🔄 중복허용 (최대${d.maxConcurrent||1}팀)`:"🚫 단독사용";return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:a.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.capacity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.bufferMinutes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${d?.allowOverlap?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:g})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>f(a),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l(a.id),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]},a.id)})})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:h?"시설 정보 수정":"새 시설 추가"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시설 이름"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:u,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"수용 인원"}),e.jsx("input",{type:"number",name:"capacity",value:i.capacity,onChange:u,required:!0,min:1,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"버퍼 시간 (분)"}),e.jsx("input",{type:"number",name:"bufferMinutes",value:i.bufferMinutes,onChange:u,required:!0,min:0,className:"w-full p-3 border border-gray-200 rounded-xl"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시설 종류"}),e.jsxs("select",{name:"type",value:i.type,onChange:u,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"gym",children:"체육관"}),e.jsx("option",{value:"court",children:"코트"}),e.jsx("option",{value:"field",children:"운동장"}),e.jsx("option",{value:"pool",children:"수영장"}),e.jsx("option",{value:"room",children:"다목적실"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-3",children:"중복 사용 설정"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:i.bookingPolicy?.allowOverlap||!1,onChange:a=>b(d=>({...d,bookingPolicy:{...d.bookingPolicy,allowOverlap:a.target.checked,maxConcurrent:a.target.checked?d.bookingPolicy?.maxConcurrent||2:1}})),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"중복 사용 허용 (같은 시간에 여러 팀 사용 가능)"})]}),i.bookingPolicy?.allowOverlap&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"최대 동시 사용 팀"}),e.jsx("input",{type:"number",min:"2",max:"10",value:i.bookingPolicy?.maxConcurrent||2,onChange:a=>b(d=>({...d,bookingPolicy:{...d.bookingPolicy,maxConcurrent:parseInt(a.target.value)}})),className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"같은 시간에 이용할 수 있는 최대 팀 수"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:v,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:h?"수정하기":"추가하기"})]})]})]})})]})},Us={success:e.jsx(cs,{className:"w-6 h-6 text-green-500"}),error:e.jsx(os,{className:"w-6 h-6 text-red-500"}),warning:e.jsx(is,{className:"w-6 h-6 text-yellow-500"}),info:e.jsx(ns,{className:"w-6 h-6 text-blue-500"})},Ks=({notification:t,onRemove:s})=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden mb-4 animate-on-load",style:{animationName:"fadeInRight"},children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:Us[t.type]}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.message})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{onClick:()=>s(t.id),className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(mt,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})}),Js=()=>{const{notifications:t,removeNotification:s}=ke();return e.jsx("div",{className:"fixed inset-0 flex items-end justify-end px-4 py-6 pointer-events-none sm:p-6 z-50",children:e.jsx("div",{className:"w-full max-w-sm",children:t.map(o=>e.jsx(Ks,{notification:o,onRemove:s},o.id))})})};function Xs(){const{user:t,login:s,logout:o,signup:h,adminLogin:c,googleLogin:m,loading:i}=xs(),{loading:b,syncing:C,bookings:f,setBookings:v,programs:u,setPrograms:y,applications:l,setApplications:a,users:d,setUsers:g,facilities:N}=Se(),[S,E]=n.useState("dashboard");n.useEffect(()=>{t&&!b&&E("dashboard")},[t,b]);const x=async(M,B)=>{try{if(!M.trim()||!B.trim())throw new Error("이메일과 비밀번호를 입력해주세요.");return await s(M,B),[!0,null]}catch(w){return console.error("Login failed:",w),[!1,ye(w)]}},T=async(M,B)=>{try{if(!M.trim()||!B.trim())throw new Error("이메일과 비밀번호를 입력해주세요.");return await c(M,B),[!0,null]}catch(w){return console.error("Admin login failed:",w),[!1,ye(w)]}},D=async M=>{try{const{name:B,email:w,password:L}=M;if(!B?.trim())throw new Error("이름을 입력해주세요.");if(!w?.trim())throw new Error("이메일을 입력해주세요.");if(!L?.trim())throw new Error("비밀번호를 입력해주세요.");return await h(M),[!0,"회원가입이 완료되었습니다. 이메일 인증을 확인해주세요."]}catch(B){return console.error("Signup failed:",B),[!1,ye(B)]}},R=async()=>{try{return await m(),[!0,null]}catch(M){return console.error("Google login failed:",M),[!1,ye(M)]}},A=async()=>{await o(),E("dashboard")},$=()=>{if(!t)return null;try{switch(S){case"dashboard":return e.jsx(it,{currentUser:t,bookings:f,applications:l,programs:u,setActiveTab:E,syncing:C});case"booking":return e.jsx(Is,{currentUser:t,bookings:f,setBookings:v,syncing:C});case"program":return e.jsx(Rs,{currentUser:t,programs:u,setPrograms:y,applications:l,setApplications:a});case"admin":return e.jsx(qs,{currentUser:t,bookings:f,setBookings:v,applications:l,setApplications:a,programs:u,setPrograms:y,users:d,facilities:N});case"userManagement":return e.jsx(Gs,{users:d,setUsers:g});case"facilities":return e.jsx(Ws,{});default:return e.jsx(it,{currentUser:t,bookings:f,applications:l,programs:u,setActiveTab:E,syncing:C})}}catch(M){return console.error("Component rendering error:",M),e.jsx("div",{className:"min-h-96 bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"화면을 불러오는 중 오류가 발생했습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"다른 메뉴를 선택하거나 페이지를 새로고침해주세요."}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>E("dashboard"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"대시보드로 이동"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"새로고침"})]})]})})}};return b||i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{}),t?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(vs,{currentUser:t,activeTab:S,setActiveTab:E,onLogout:A}),e.jsx("main",{children:$()})]}):e.jsx(ps,{onLogin:x,onSignup:D,onAdminLogin:T,onGoogleLogin:R})]})}const ct=document.getElementById("root");ct?wt.createRoot(ct).render(e.jsx(vt.StrictMode,{children:e.jsx(us,{children:e.jsx(Xs,{})})})):console.error("Failed to find the root element");
