import{r as i,j as e}from"./react-C1G-q6RG.js";import{v as T}from"./firebase-C3mMOVup.js";import{f as I}from"./firebase-functions-CXDbOPY8.js";import{b as M}from"./index-BAncqK-u.js";import{e as P,i as N,k as $,l as E,m as O}from"./icons-CN_tAE-L.js";const A=T(I,"updateReservationStatus"),w=["일","월","화","수","목","금","토"],H=t=>{const d=new Date;d.setHours(0,0,0,0);const c=new Date(t.startDate);c.setHours(0,0,0,0);const o=new Date(t.endDate);return o.setHours(0,0,0,0),d>o?{text:"종료",dDay:null}:d>=c&&d<=o?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((c.getTime()-d.getTime())/(1e3*60*60*24))}},R=i.memo(({b:t,onAction:d})=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.userName," | ",t.startDate," ",t.startTime,"-",t.endTime]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(t.id,"approve"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>d(t.id,"reject"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})})),B=i.memo(({p:t,onEdit:d,onDelete:c})=>{const o=H(t);return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.title}),o.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",o.dDay]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.instructor," | ",t.startDate," ~ ",t.endDate," | ",t.startDate!==t.endDate?(t.scheduleDays||[]).slice().sort().map(u=>w[u]).join(","):"단일"," | ",t.startTime," - ",t.endTime," | ",t.fee?`${t.fee.toLocaleString()}원`:"무료"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(t),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(t),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg",children:e.jsx(O,{className:"w-4 h-4"})})]})]})});function U({bookings:t,setBookings:d,applications:c,setApplications:o,programs:u,setPrograms:h}){const{showNotification:x}=M(),[D,p]=i.useState(!1),[g,j]=i.useState(null),f={title:"",description:"",instructor:"",capacity:10,scheduleDays:[],startTime:"09:00",endTime:"10:00",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],level:"beginner",category:"yoga",fee:0},[a,n]=i.useState(f),k=i.useMemo(()=>a.startDate!==a.endDate,[a.startDate,a.endDate]),v=i.useMemo(()=>{const s=[];for(let r=0;r<24;r++)for(let l=0;l<60;l+=10)s.push(`${String(r).padStart(2,"0")}:${String(l).padStart(2,"0")}`);return s},[]),C=i.useCallback(()=>{const s={...g??{id:`program-${Date.now()}`},...a};g?(h(r=>r.map(l=>l.id===s.id?s:l)),x("프로그램이 수정되었습니다.","success")):(h(r=>[s,...r]),x("새 프로그램이 개설되었습니다.","success")),p(!1),j(null)},[a,g,h,x]),S=i.useCallback(async(s,r)=>{try{await A({reservationId:s,status:r==="approve"?"approved":"rejected"}),d(l=>l.map(m=>m.id===s?{...m,status:r==="approve"?"approved":"rejected"}:m)),x(`대관이 ${r==="approve"?"승인":"거절"}되었습니다.`,"success")}catch(l){x(`처리 실패: ${l?.message??"알 수 없는 오류"}`,"error")}},[d,x]),b=i.useMemo(()=>t.filter(s=>s.status==="pending"),[t]),y=i.useMemo(()=>c.filter(s=>s.status==="pending"),[c]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-50 rounded-lg flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["진행중인 대관 신청 (",b.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:b.length>0?b.map(s=>e.jsx(R,{b:s,onAction:S},s.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"진행중인 신청이 없습니다."})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["진행중인 프로그램 신청 (",y.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:y.length>0?y.map(s=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["신청 ID: ",s.id]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["상태: ",s.status]})]})})},s.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"진행중인 신청이 없습니다."})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"프로그램 관리"})]}),e.jsxs("button",{onClick:()=>{j(null),n(f),p(!0)},className:"flex items-center gap-2 text-sm font-medium text-purple-600 hover:text-purple-800 px-4 py-2 rounded-lg hover:bg-purple-50",children:[e.jsx($,{className:"w-4 h-4"})," 새 프로그램 추가"]})]}),e.jsxs("div",{className:"space-y-3",children:[u.map(s=>e.jsx(B,{p:s,onEdit:r=>{j(r),n(r),p(!0)},onDelete:r=>h(l=>l.filter(m=>m.id!==r.id))},s.id)),u.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"등록된 프로그램이 없습니다."})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:g?"프로그램 수정":"새 프로그램 개설"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"제목"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:a.title,onChange:s=>n({...a,title:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"강사"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:a.instructor,onChange:s=>n({...a,instructor:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명"}),e.jsx("textarea",{className:"w-full p-3 border border-gray-200 rounded-xl",rows:3,value:a.description,onChange:s=>n({...a,description:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:a.startDate,onChange:s=>n({...a,startDate:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:a.endDate,onChange:s=>n({...a,endDate:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"반복 요일"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((s,r)=>e.jsx("button",{type:"button",onClick:()=>n(l=>({...l,scheduleDays:l.scheduleDays.includes(r)?l.scheduleDays.filter(m=>m!==r):[...l.scheduleDays,r]})),className:`p-2 rounded-lg border text-sm font-medium ${a.scheduleDays.includes(r)?"bg-purple-500 text-white border-purple-500":"bg-white hover:bg-gray-100 border-gray-300"} ${k?"":"opacity-50 pointer-events-none"}`,children:s},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:a.startTime,onChange:s=>n({...a,startTime:s.target.value}),children:v.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:a.endTime,onChange:s=>n({...a,endTime:s.target.value}),children:v.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"정원"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:a.capacity,onChange:s=>n({...a,capacity:parseInt(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"금액"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:a.fee||0,onChange:s=>n({...a,fee:parseInt(s.target.value)||0})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl border",onClick:()=>{p(!1),j(null)},children:"취소"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-purple-600 text-white",onClick:C,children:g?"수정하기":"개설하기"})]})]})})]})}export{U as default};
