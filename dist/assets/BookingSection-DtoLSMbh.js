import{r as d,j as e}from"./react-C1G-q6RG.js";import{u as y,b as j}from"./index-BAncqK-u.js";import{v as f}from"./firebase-C3mMOVup.js";import{f as v}from"./firebase-functions-CXDbOPY8.js";import"./icons-CN_tAE-L.js";const N=f(v,"createBooking"),w=d.memo(({status:a})=>{const l={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"}},{text:n,color:r}=l[a];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${r}`,children:n})}),D=["일","월","화","수","목","금","토"],T=a=>{const{startDate:l,endDate:n,recurrenceRule:r}=a;if(l===n)return l;let t="";return r&&r.days.length>0&&(t=` (매주 / Every ${r.days.sort().map(i=>D[i]).join(", ")})`),`${l} ~ ${n}${t}`},g=d.memo(({booking:a})=>e.jsx("div",{className:"p-3 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:a.purpose}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.organization?`${a.organization} | `:"",T(a)," ",a.startTime,"-",a.endTime]})]}),e.jsx(w,{status:a.status})]})})),$=({currentUser:a,bookings:l})=>{const{facilities:n}=y(),{showNotification:r}=j(),[t,i]=d.useState({purpose:"",category:"training",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"}),[p,m]=d.useState(!1),x=d.useMemo(()=>l.filter(s=>s.status!=="completed"),[l]),u=d.useMemo(()=>l.filter(s=>s.status==="completed"),[l]),h=d.useCallback(async s=>{if(s.preventDefault(),!t.purpose||!t.category||!t.startDate||!t.endDate||!t.startTime||!t.endTime){r("모든 필수 항목을 입력해주세요.","error");return}if(!n||n.length===0){r("등록된 시설이 없어 신청할 수 없습니다.","error");return}const b=n[0];m(!0);try{const c={purpose:t.purpose,category:t.category,numberOfParticipants:t.numberOfParticipants||1,facilityId:b.id,startDate:t.startDate,endDate:t.endDate,startTime:t.startTime,endTime:t.endTime},o=await N(c);o?.data?.success?r("예약 신청이 완료되었습니다. 관리자 승인 후 확정됩니다.","success"):r(`예약 실패: ${o?.data?.message||"알 수 없는 오류"}`,"error")}catch(c){const o=c?.message||"예약 실패: 알 수 없는 오류";r(o,"error")}finally{m(!1)}},[t,n,r]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"체육관 대관 / Gym Booking"}),e.jsx("p",{className:"text-gray-600",children:"대관 현황을 확인하고 새로운 대관을 신청하세요."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"진행중인 대관 / Active Bookings"}),e.jsxs("div",{className:"space-y-3",children:[x.map(s=>e.jsx(g,{booking:s},s.id)),x.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"진행중인 대관 신청이 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"완료된 대관 / Completed Bookings"}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:[u.map(s=>e.jsx(g,{booking:s},s.id)),u.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"완료된 대관이 없습니다."})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"신규 대관 신청"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:t.purpose||"",onChange:s=>i({...t,purpose:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:t.category,onChange:s=>i({...t,category:s.target.value}),children:[e.jsx("option",{value:"training",children:"훈련"}),e.jsx("option",{value:"class",children:"수업"}),e.jsx("option",{value:"event",children:"행사"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:t.startDate||"",onChange:s=>i({...t,startDate:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:t.endDate||"",onChange:s=>i({...t,endDate:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:t.startTime||"",onChange:s=>i({...t,startTime:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:t.endTime||"",onChange:s=>i({...t,endTime:s.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"인원"}),e.jsx("input",{type:"number",min:1,className:"w-full p-3 border border-gray-200 rounded-xl",value:t.numberOfParticipants||1,onChange:s=>i({...t,numberOfParticipants:parseInt(s.target.value)||1})})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"submit",disabled:p,className:"w-full md:w-auto px-4 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium",children:"대관 신청"})})]})]})]})]})};export{$ as default};
