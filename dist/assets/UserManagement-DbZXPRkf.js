const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-JKx5WJQm.js","./react-C1G-q6RG.js","./firebase-CVBrtIcl.js","./icons-DJqNYe3e.js","./index-CYlCz1vV.css"])))=>i.map(i=>d[i]);
import{b as Ne,f as re,_ as h,g as Ce}from"./index-JKx5WJQm.js";import{r as s,j as e}from"./react-C1G-q6RG.js";import{a as Ee,R as _e,C as Se,E as ke,D as Ae,F as Ve}from"./firebase-CVBrtIcl.js";import{r as De,p as Pe,u as Te,s as Ue,t as Ie,A as Me}from"./icons-DJqNYe3e.js";const $e=({users:se,setUsers:p})=>{const{users:K,loading:le}=Ne(),y=K.length>0?K:se||[],[ne,V]=s.useState(!1),[D,q]=s.useState(!1),[f,P]=s.useState(null),[w,T]=s.useState(null),[$,H]=s.useState(null),B={name:"",email:"",phone:"",password:"",role:"user"},[a,C]=s.useState(B),[U,G]=s.useState(""),[I,J]=s.useState(""),[M,Q]=s.useState(""),[F,X]=s.useState(""),[O,Y]=s.useState(null),[b,g]=s.useState(!1),[Fe,Z]=s.useState(!1),[E,ie]=s.useState(""),[L,oe]=s.useState("name"),[R]=s.useState("all"),[c,ce]=s.useState({key:"name",direction:"asc"}),u=Ee();s.useEffect(()=>{D&&setTimeout(()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new _e(u,"recaptcha-container",{size:"invisible",callback:()=>{}}))},100)},[D,u]);const de=t=>{P(t),C({name:t.name,email:t.email,phone:t.phone||"",password:"",role:t.role}),V(!0)},me=()=>{P(null),C(B),V(!0)},ee=()=>{V(!1),P(null)},ue=t=>{H(t),G(t.email),Q(t.phone||""),J(""),X(""),Y(null),q(!0)},te=()=>{q(!1),H(null),window.recaptchaVerifier&&window.recaptchaVerifier.clear()},j=t=>{const{name:r,value:n}=t.target;C(r==="phone"?l=>({...l,[r]:re(n)}):l=>({...l,[r]:n}))},xe=async t=>{t.preventDefault(),Z(!0);try{if(f){if(y.some(d=>d.email===a.email&&d.id!==f.id)){alert("이미 사용 중인 이메일입니다.");return}const{doc:r,updateDoc:n,serverTimestamp:l}=await h(async()=>{const{doc:d,updateDoc:m,serverTimestamp:k}=await import("./firebase-CVBrtIcl.js").then(v=>v.L);return{doc:d,updateDoc:m,serverTimestamp:k}},[],import.meta.url),{db:i}=await h(async()=>{const{db:d}=await import("./index-JKx5WJQm.js").then(m=>m.e);return{db:d}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),S={name:a.name,email:a.email,phone:a.phone.replace(/-/g,"")||null,role:a.role,updatedAt:l()};await n(r(i,"users",f.id),S),p&&p(d=>d.map(m=>m.id===f.id?{...m,name:a.name,email:a.email,phone:a.phone.replace(/-/g,""),role:a.role}:m)),alert("사용자 정보가 수정되었습니다.")}else{if(y.some(o=>o.email===a.email)){alert("이미 등록된 이메일입니다.");return}if(!a.password){alert("신규 사용자는 비밀번호가 필요합니다.");return}const{createUserWithEmailAndPassword:r,sendEmailVerification:n,updateProfile:l,signOut:i,signInWithEmailAndPassword:S}=await h(async()=>{const{createUserWithEmailAndPassword:o,sendEmailVerification:x,updateProfile:N,signOut:z,signInWithEmailAndPassword:je}=await import("./firebase-CVBrtIcl.js").then(ve=>ve.K);return{createUserWithEmailAndPassword:o,sendEmailVerification:x,updateProfile:N,signOut:z,signInWithEmailAndPassword:je}},[],import.meta.url),{doc:d,setDoc:m,serverTimestamp:k}=await h(async()=>{const{doc:o,setDoc:x,serverTimestamp:N}=await import("./firebase-CVBrtIcl.js").then(z=>z.L);return{doc:o,setDoc:x,serverTimestamp:N}},[],import.meta.url),{auth:v,db:we}=await h(async()=>{const{auth:o,db:x}=await import("./index-JKx5WJQm.js").then(N=>N.e);return{auth:o,db:x}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),W=v.currentUser;if(!W)throw new Error("관리자 로그인이 필요합니다.");const Oe=W.email,Le=W.displayName,A=(await r(v,a.email,a.password)).user;await l(A,{displayName:a.name||a.email.split("@")[0]}),await m(d(we,"users",A.uid),{name:a.name,email:a.email,phone:a.phone.replace(/-/g,"")||null,role:a.role,isActive:!0,adminCreated:!0,createdAt:k(),updatedAt:k()});try{await n(A,{url:`${window.location.origin}/`,handleCodeInApp:!1}),console.log("관리자 생성 사용자 이메일 인증 메일 전송 성공:",a.email)}catch(o){console.warn("이메일 인증 메일 전송 실패:",o)}if(await i(v),p){const o={id:A.uid,name:a.name,email:a.email,phone:a.phone.replace(/-/g,""),role:a.role};p(x=>[...x,o])}alert(`새 사용자 '${a.name}'이 생성되었습니다.

관리자가 생성한 계정이므로 이메일 인증 없이 바로 로그인할 수 있습니다.

관리자 세션을 복구하기 위해 페이지를 새로고침합니다.`),window.location.reload()}ee()}catch(r){console.error("User creation/update error:",r);const n=Ce(r);alert(n)}finally{Z(!1)}},he=t=>{if(t.role==="admin"&&y.filter(r=>r.role==="admin").length<=1){alert("마지막 관리자 계정은 삭제할 수 없습니다.");return}T(t)},pe=async()=>{if(w){try{const{deleteDoc:t,doc:r}=await h(async()=>{const{deleteDoc:l,doc:i}=await import("./firebase-CVBrtIcl.js").then(S=>S.L);return{deleteDoc:l,doc:i}},[],import.meta.url),{db:n}=await h(async()=>{const{db:l}=await import("./index-JKx5WJQm.js").then(i=>i.e);return{db:l}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);await t(r(n,"users",w.id)),alert("사용자가 삭제되었습니다."),p&&p(l=>l.filter(i=>i.id!==w.id))}catch(t){console.error("사용자 삭제 오류:",t),alert("사용자 삭제에 실패했습니다.")}T(null)}},fe=t=>{let r="asc";c&&c.key===t&&c.direction==="asc"&&(r="desc"),ce({key:t,direction:r})},be=async()=>{if(!M){alert("휴대폰 번호를 입력하세요.");return}g(!0);try{const t=window.recaptchaVerifier,r=await Se(u,M,t);Y(r),alert("인증 코드를 발송했습니다.")}catch(t){console.error("SMS Error:",t),alert("SMS 인증 코드 요청에 실패했습니다.")}finally{g(!1)}},ge=async()=>{if(!F){alert("인증 코드를 입력하세요.");return}if(!O){alert("먼저 인증 코드를 요청하세요.");return}g(!0);try{await O.confirm(F),alert("휴대폰 인증이 완료되었습니다.")}catch(t){console.error("Verification Error:",t),alert("인증 코드가 잘못되었습니다.")}finally{g(!1)}},ye=async()=>{if(!U||!I){alert("새 이메일과 현재 비밀번호를 입력하세요.");return}if(u.currentUser){g(!0);try{const t=ke.credential(u.currentUser.email,I);await Ae(u.currentUser,t),await Ve(u.currentUser,U),alert("이메일 주소가 변경되었습니다. 새 주소로 인증 메일을 확인하세요."),te()}catch(t){console.error("Email Update Error:",t),alert("이메일 변경에 실패했습니다. 비밀번호를 확인하세요.")}finally{g(!1)}}},ae=s.useMemo(()=>{const t=y.filter(r=>R==="all"||r.role===R).filter(r=>{if(!E)return!0;const n=E.toLowerCase();return(r[L]?.toLowerCase()||"").includes(n)});return c!==null&&t.sort((r,n)=>{const l=r[c.key]||"",i=n[c.key]||"";return l<i?c.direction==="asc"?-1:1:l>i?c.direction==="asc"?1:-1:0}),t},[y,E,L,R,c]),_=({columnKey:t,title:r})=>e.jsx("th",{onClick:()=>fe(t),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:r}),c?.key===t&&e.jsx(Me,{className:"w-4 h-4 ml-2"})]})});return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{id:"recaptcha-container"}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"회원 관리"}),e.jsx("p",{className:"text-gray-600",children:"사용자 추가, 수정, 삭제"})]}),e.jsxs("button",{onClick:me,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(De,{className:"w-5 h-5"}),e.jsx("span",{children:"새 사용자 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:L,onChange:t=>oe(t.target.value),className:"border rounded-lg px-2 py-1 text-sm",children:[e.jsx("option",{value:"name",children:"이름"}),e.jsx("option",{value:"email",children:"이메일"}),e.jsx("option",{value:"phone",children:"전화번호"})]}),e.jsx("input",{value:E,onChange:t=>ie(t.target.value),placeholder:"검색어 입력",className:"flex-1 outline-none"})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:le?e.jsxs("div",{className:"flex items-center justify-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"사용자 정보를 불러오는 중..."})]}):ae.length===0?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"등록된 사용자가 없습니다."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"새 사용자 추가 버튼을 클릭해서 사용자를 추가해보세요."})]})}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx(_,{columnKey:"name",title:"이름"}),e.jsx(_,{columnKey:"email",title:"이메일"}),e.jsx(_,{columnKey:"phone",title:"전화번호"}),e.jsx(_,{columnKey:"role",title:"권한"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ae.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.phone}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.role==="admin"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:t.role})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>ue(t),className:"p-2 text-gray-500 hover:text-green-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>de(t),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>he(t),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ie,{className:"w-4 h-4"})})]})]},t.id))})]})}),ne&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:f?"사용자 정보 수정":"새 사용자 추가"}),e.jsxs("form",{onSubmit:xe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이름"}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:j,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이메일"}),e.jsx("input",{type:"email",name:"email",value:a.email,onChange:j,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"전화번호"}),e.jsx("input",{type:"tel",name:"phone",value:a.phone,onChange:j,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["비밀번호 ",f&&"(변경시에만 입력)"]}),e.jsx("input",{type:"password",name:"password",value:a.password,onChange:j,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"권한"}),e.jsxs("select",{name:"role",value:a.role,onChange:j,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:ee,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:"저장"})]})]})]})}),D&&$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 space-y-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["계정 설정: ",$.name]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"휴대폰 인증"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"tel",value:M,onChange:t=>Q(re(t.target.value)),placeholder:"휴대폰 번호",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:be,disabled:b,className:"py-3 px-4 bg-gray-200 rounded-xl hover:bg-gray-300 font-medium transition-colors disabled:opacity-50",children:b?"전송중...":"인증코드 받기"})]}),O&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:F,onChange:t=>X(t.target.value),placeholder:"인증 코드 6자리",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:ge,disabled:b,className:"py-3 px-4 bg-green-500 text-white rounded-xl hover:bg-green-600 font-medium transition-colors disabled:opacity-50",children:b?"확인중...":"인증하기"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"이메일 주소 변경"}),e.jsx("input",{type:"email",value:U,onChange:t=>G(t.target.value),placeholder:"새 이메일 주소",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("input",{type:"password",value:I,onChange:t=>J(t.target.value),placeholder:"현재 비밀번호",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:ye,disabled:b,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors disabled:opacity-50",children:b?"변경중...":"이메일 변경"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"button",onClick:te,className:"py-3 px-6 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"닫기"})})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"사용자 삭제 확인"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["정말로 ",e.jsx("strong",{className:"text-red-600",children:w.name})," 사용자를 삭제하시겠습니까?"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>T(null),className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{onClick:pe,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl hover:bg-red-600 font-medium transition-colors",children:"삭제"})]})]})})]})};export{$e as default};
