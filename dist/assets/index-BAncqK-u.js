const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginForm-BF0LVmDm.js","assets/react-C1G-q6RG.js","assets/firebase-C3mMOVup.js","assets/icons-CN_tAE-L.js","assets/Navigation-D7KvDKWA.js","assets/Dashboard-F0dPeNE8.js","assets/BookingSection-DtoLSMbh.js","assets/firebase-functions-CXDbOPY8.js","assets/ProgramSection-DzprgAyz.js","assets/AdminSection-DswI2wyd.js","assets/UserManagement-OoMuZG1p.js","assets/FacilityManagement-CFhY-iO_.js"])))=>i.map(i=>d[i]);
import{r as n,j as e,R as W,a as H}from"./react-C1G-q6RG.js";import{g as I,i as K,a as X,b as G,c as Q,d as Z,e as J,f as Y,o as ee,s as O,h as P,j as R,k,l as te,m as se,n as C,p as j,q as b,r as S,t as L}from"./firebase-C3mMOVup.js";import{X as re,I as oe,T as ne,C as ae,a as ie}from"./icons-CN_tAE-L.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&h(r)}).observe(document,{childList:!0,subtree:!0});function m(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function h(i){if(i.ep)return;i.ep=!0;const c=m(i);fetch(i.href,c)}})();const ce="modulepreload",le=function(s){return"/"+s},D={},x=function(d,m,h){let i=Promise.resolve();if(m&&m.length>0){let f=function(l){return Promise.all(l.map(a=>Promise.resolve(a).then(o=>({status:"fulfilled",value:o}),o=>({status:"rejected",reason:o}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),t=r?.nonce||r?.getAttribute("nonce");i=f(m.map(l=>{if(l=le(l),l in D)return;D[l]=!0;const a=l.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${o}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":ce,a||(u.as="script"),u.crossOrigin="",u.href=l,t&&u.setAttribute("nonce",t),document.head.appendChild(u),a)return new Promise((p,w)=>{u.addEventListener("load",p),u.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function c(r){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=r,window.dispatchEvent(t),!t.defaultPrevented)throw r}return i.then(r=>{for(const t of r||[])t.status==="rejected"&&c(t.reason);return d().catch(c)})},N={},ue={apiKey:"AIzaSyBvlPy3BOyrRCokGAHkzuX6IoVZNjWTU-0",authDomain:"flexspaceprowin.firebaseapp.com",projectId:"flexspaceprowin",storageBucket:"flexspaceprowin.firebasestorage.app",messagingSenderId:"545144229496",appId:"1:545144229496:web:a833b961cf4b8a7ce9678d",measurementId:"G-D81Q76VKZQ"},T=I().length?I()[0]:K(ue),y=X(T),g=G(T),de=N?.VITE_USE_EMULATOR==="true";if(de){const s=N?.VITE_EMULATOR_HOST||"127.0.0.1",d=Number(N?.VITE_EMULATOR_AUTH_PORT||9099),m=Number(N?.VITE_EMULATOR_FIRESTORE_PORT||8080);try{Q(y,`http://${s}:${d}`,{disableWarnings:!0})}catch{}try{Z(g,s,m)}catch{}}J().then(s=>s?Y(T):null).catch(()=>null);const me=()=>{const[s,d]=n.useState(null);n.useEffect(()=>{const r=ee(y,async t=>{if(!t){d(null);return}try{const f=P(g,"users",t.uid),l=await R(f),a=l.exists()?l.data():{},o=a.role||"user",u=a.name||t.displayName||(t.email?.split("@")[0]??"user"),p=a.phone;d({id:t.uid,name:u,email:t.email??"",phone:p,role:o})}catch{d({id:t.uid,name:t.email?.split("@")[0]??"user",email:t.email??"",role:"user"})}});return()=>r()},[]);const m=n.useCallback(async(r,t)=>(await O(y,r,t),!0),[]),h=n.useCallback(async(r,t)=>{const f=await O(y,r,t),l=P(g,"users",f.user.uid),a=await R(l);if((a.exists()?a.data().role:void 0)!=="admin")throw await k(y),new Error("관리자 권한이 없습니다.");return!0},[]),i=n.useCallback(async r=>{const{name:t,email:f,phone:l,password:a}=r;if(!f||!a)throw new Error("이메일과 비밀번호가 필요합니다.");const o=await te(y,f,a),u=P(g,"users",o.user.uid);return await se(u,{name:t||(f.split("@")[0]??"user"),email:f,phone:l||null,role:"user",isActive:!0,createdAt:C(),updatedAt:C()},{merge:!0}),!0},[]),c=n.useCallback(async()=>{await k(y),d(null)},[]);return n.useMemo(()=>({user:s,login:m,logout:c,signup:i,adminLogin:h}),[s,m,c,i,h])},fe=()=>{const[s,d]=n.useState(!0),[m,h]=n.useState([]),[i,c]=n.useState([]),[r,t]=n.useState([]),[f,l]=n.useState([]);return n.useEffect(()=>{const a=[];return a.push(j(b(g,"users"),o=>{const u=o.docs.map(p=>({id:p.id,...p.data()}));l(u)},o=>{console.error("Error fetching users:",o)})),a.push(j(S(b(g,"bookings"),L("createdAt","desc")),o=>{const u=o.docs.map(p=>({id:p.id,...p.data()}));h(u)},o=>{console.error("Error fetching bookings:",o)})),a.push(j(S(b(g,"programs"),L("startDate","asc")),o=>{const u=o.docs.map(p=>({id:p.id,...p.data()}));c(u)},o=>{console.error("Error fetching programs:",o)})),a.push(j(S(b(g,"applications"),L("appliedAt","desc")),o=>{const u=o.docs.map(p=>({id:p.id,...p.data()}));t(u)},o=>{console.error("Error fetching applications:",o)})),d(!1),()=>a.forEach(o=>o())},[]),n.useMemo(()=>({loading:s,bookings:m,setBookings:h,programs:i,setPrograms:c,applications:r,setApplications:t,users:f,setUsers:l}),[s,m,i,r,f])},z=n.createContext(void 0),pe=({children:s})=>{const[d,m]=n.useState([]),h=n.useCallback(c=>{m(r=>r.filter(t=>t.id!==c))},[]),i=n.useCallback((c,r="info",t=5e3)=>{const f=`notification-${Date.now()}-${Math.random()}`,l={id:f,message:c,type:r,duration:t};m(a=>[...a,l]),t>0&&setTimeout(()=>{h(f)},t)},[h]);return e.jsx(z.Provider,{value:{notifications:d,showNotification:i,removeNotification:h},children:s})},he=()=>{const s=n.useContext(z);if(s===void 0)throw new Error("useNotification must be used within a NotificationProvider");return s},ge={success:e.jsx(ie,{className:"w-6 h-6 text-green-500"}),error:e.jsx(ae,{className:"w-6 h-6 text-red-500"}),warning:e.jsx(ne,{className:"w-6 h-6 text-yellow-500"}),info:e.jsx(oe,{className:"w-6 h-6 text-blue-500"})},xe=({notification:s,onRemove:d})=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden mb-4 animate-on-load",style:{animationName:"fadeInRight"},children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:ge[s.type]}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.message})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{onClick:()=>d(s.id),className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(re,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})}),ye=()=>{const{notifications:s,removeNotification:d}=he();return e.jsx("div",{className:"fixed inset-0 flex items-end justify-end px-4 py-6 pointer-events-none sm:p-6 z-50",children:e.jsx("div",{className:"w-full max-w-sm",children:s.map(m=>e.jsx(xe,{notification:m,onRemove:d},m.id))})})},_e=n.lazy(()=>x(()=>import("./LoginForm-BF0LVmDm.js"),__vite__mapDeps([0,1,2,3]))),Ee=n.lazy(()=>x(()=>import("./Navigation-D7KvDKWA.js"),__vite__mapDeps([4,1,2,3]))),M=n.lazy(()=>x(()=>import("./Dashboard-F0dPeNE8.js"),__vite__mapDeps([5,1,3,2]))),ve=n.lazy(()=>x(()=>import("./BookingSection-DtoLSMbh.js"),__vite__mapDeps([6,1,2,7,3]))),we=n.lazy(()=>x(()=>import("./ProgramSection-DzprgAyz.js"),__vite__mapDeps([8,1,2,7,3]))),je=n.lazy(()=>x(()=>import("./AdminSection-DswI2wyd.js"),__vite__mapDeps([9,1,2,7,3]))),be=n.lazy(()=>x(()=>import("./UserManagement-OoMuZG1p.js"),__vite__mapDeps([10,1,3]))),Ne=n.lazy(()=>x(()=>import("./FacilityManagement-CFhY-iO_.js"),__vite__mapDeps([11,1,2,3])));function Ae(){const{user:s,login:d,logout:m,signup:h,adminLogin:i}=me(),{loading:c,bookings:r,setBookings:t,programs:f,setPrograms:l,applications:a,setApplications:o,users:u,setUsers:p}=fe(),[w,_]=n.useState("dashboard");n.useEffect(()=>{s&&!c&&_("dashboard")},[s,c]);const B=async(E,v)=>{try{return await d(E,v),!0}catch(A){return console.error("Login failed:",A),!1}},F=async(E,v)=>{try{return await i(E,v),!0}catch(A){return console.error("Admin login failed:",A),!1}},U=async E=>{try{return await h(E),!0}catch(v){return console.error("Signup failed:",v),!1}},$=async()=>{await m(),_("dashboard")},q=()=>{if(!s)return null;switch(w){case"dashboard":return e.jsx(M,{currentUser:s,bookings:r,applications:a,programs:f,setActiveTab:_});case"booking":return e.jsx(ve,{currentUser:s,bookings:r,setBookings:t});case"program":return e.jsx(we,{currentUser:s,programs:f,setPrograms:l,applications:a,setApplications:o});case"admin":return e.jsx(je,{bookings:r,setBookings:t,applications:a,setApplications:o,programs:f,setPrograms:l,users:u});case"userManagement":return e.jsx(be,{users:u,setUsers:p});case"facilities":return e.jsx(Ne,{});default:return e.jsx(M,{currentUser:s,bookings:r,applications:a,programs:f,setActiveTab:_})}};return c?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(ye,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"p-4",children:"로딩 중..."}),children:[e.jsx(Ee,{currentUser:s,activeTab:w,setActiveTab:_,onLogout:$}),e.jsx("main",{children:e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"p-6",children:"콘텐츠 로딩 중..."}),children:q()})})]})]}):e.jsx(_e,{onLogin:B,onSignup:U,onAdminLogin:F})}const V=document.getElementById("root");V?W.createRoot(V).render(e.jsx(H.StrictMode,{children:e.jsx(pe,{children:e.jsx(Ae,{})})})):console.error("Failed to find the root element");export{x as _,y as a,he as b,T as c,g as d,fe as u};
