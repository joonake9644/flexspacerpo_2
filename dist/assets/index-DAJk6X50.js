const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DashboardCalendar-CnKiYDlW.js","./react-C1G-q6RG.js","./icons-0lFz5iDe.js"])))=>i.map(i=>d[i]);
import{r as n,j as e,R as yt,a as jt}from"./react-C1G-q6RG.js";import{g as Qe,i as wt,a as ct,b as vt,c as Nt,d as Dt,e as Ct,f as kt,h as St,j as Et,k as Tt,l as Pt,o as At,s as Ze,m as Me,n as ae,p as $e,q as Se,r as _t,u as Je,t as be,v as se,G as Mt,w as $t,x as Ee,y as ye,z as Be,A as ze,B as It,C as Ge,R as Ot,D as Lt,E as Ft,F as Rt,H as Vt,I as Bt,J as zt,K as Ht}from"./firebase-DnP1Uaxu.js";import{U as re,a as qt,M as qe,P as Gt,L as He,H as Ue,C as te,B as he,S as et,b as tt,X as dt,c as Kt,d as Wt,e as ue,f as Xt,g as Yt,h as Qt,i as Zt,j as Jt,k as mt,l as Ut,m as Ke,T as We,n as Xe,o as es,A as ts,I as ss,p as as,q as rs,r as ls}from"./icons-0lFz5iDe.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))h(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const i of m.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&h(i)}).observe(document,{childList:!0,subtree:!0});function c(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function h(d){if(d.ep)return;d.ep=!0;const m=c(d);fetch(d.href,m)}})();const Te={};console.log("Firebase Config Debug:",{hasApiKey:!0,hasAuthDomain:!0,hasProjectId:!0,NODE_ENV:"production"});const ns={apiKey:"AIzaSyBvlPy3BOyrRCokGAHkzuX6IoVZNjWTU-0",authDomain:"flexspaceprowin.firebaseapp.com",projectId:"flexspaceprowin",storageBucket:"flexspaceprowin.firebasestorage.app",messagingSenderId:"545144229496",appId:"1:545144229496:web:a833b961cf4b8a7ce9678d",measurementId:"G-D81Q76VKZQ"};let we;try{we=Qe().length?Qe()[0]:wt(ns),console.log("Firebase initialized successfully")}catch(t){throw console.error("Firebase initialization failed:",t),t}const H=ct(we),W=vt(we),xt=Nt(we),Pe=Dt(we),is=Te?.VITE_USE_EMULATOR==="true";if(is){const t=Te?.VITE_EMULATOR_HOST||"127.0.0.1",s=Number(Te?.VITE_EMULATOR_AUTH_PORT||9099),c=Number(Te?.VITE_EMULATOR_FIRESTORE_PORT||8080),h=Number(Te?.VITE_EMULATOR_STORAGE_PORT||9199);try{Ct(H,`http://${t}:${s}`,{disableWarnings:!0})}catch{}try{kt(W,t,c)}catch{}try{St(xt,t,h)}catch{}try{Et(Pe,t,5001)}catch{}}Tt().then(t=>t?Pt(we):null).catch(()=>null);const ne=Object.freeze(Object.defineProperty({__proto__:null,auth:H,db:W,functions:Pe,storage:xt},Symbol.toStringTag,{value:"Module"})),os=()=>{const[t,s]=n.useState(null),[c,h]=n.useState(!1),[d,m]=n.useState(!0);n.useEffect(()=>{m(!0);const l=At(H,async r=>{try{if(!r){s(null),h(!1);return}h(r.emailVerified);const o=ae(W,"users",r.uid),g=await Me(o);let N="user",k=r.displayName||(r.email?.split("@")[0]??"user"),T;if(g.exists()){const x=g.data();N=x.role||"user",k=x.name||k,T=x.phone}else{const x={name:k,email:r.email??"",phone:null,role:"user",isActive:!0,createdAt:se(),updatedAt:se()};await be(o,x),console.log("새 사용자 정보를 users 컬렉션에 추가:",r.uid)}s({id:r.uid,name:k,email:r.email??"",phone:T,role:N})}catch(o){console.error("Auth state change error:",o),r&&s({id:r.uid,name:r.email?.split("@")[0]??"user",email:r.email??"",role:"user"})}finally{m(!1)}});return()=>l()},[]);const i=n.useCallback(async(l,r)=>{try{const o=await Ze(H,l,r),g=await Me(ae(W,"users",o.user.uid)),k=(g.exists()?g.data():null)?.adminCreated===!0,T=l==="admin@flexspace.test"||l==="flexadmin@test.com"||l==="joonake@naver.com"||l==="uu@naver.com"||l==="kan@naver.com"||l==="kun6@naver.com"||l==="testuser964419@gmail.com";if(!o.user.emailVerified&&!k&&!T){try{await $e(o.user,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(x){console.warn("이메일 인증 재전송 실패:",x)}throw await Se(H),new Error("이메일 인증이 필요합니다. 새로운 인증 메일을 발송했습니다. 이메일함을 확인해주세요.")}return!0}catch(o){throw console.error("Login error:",o),o}},[]),f=n.useCallback(async(l,r)=>{try{const o=await Ze(H,l,r);if(!(l==="admin@flexspace.test"||l==="flexadmin@test.com"||l==="joonake@naver.com"||l==="uu@naver.com"||l==="kan@naver.com"||l==="kun6@naver.com"||l==="testuser964419@gmail.com")&&!o.user.emailVerified){try{await $e(o.user,{url:`${window.location.origin}/`,handleCodeInApp:!1})}catch(E){console.warn("관리자 이메일 인증 재전송 실패:",E)}throw await Se(H),new Error("이메일 인증이 필요합니다. 새로운 인증 메일을 발송했습니다. 이메일함을 확인해주세요.")}const N=ae(W,"users",o.user.uid),k=await Me(N),T=k.exists()?k.data():{},x=T.role;if(console.log("Admin login - User data:",{uid:o.user.uid,email:o.user.email,firestoreExists:k.exists(),role:x,allData:T}),x!=="admin")throw await Se(H),new Error(`관리자 권한이 없습니다. 현재 권한: ${x||"없음"}`);return!0}catch(o){throw console.error("Admin login error:",o),o}},[]),D=n.useCallback(async l=>{try{const{name:r,email:o,phone:g,password:N}=l;if(!o||!N)throw new Error("이메일과 비밀번호가 필요합니다.");if(N.length<6)throw new Error("비밀번호는 6자 이상이어야 합니다.");const k=await _t(H,o,N);await Je(k.user,{displayName:r||o.split("@")[0]});const T=ae(W,"users",k.user.uid);await be(T,{name:r||(o.split("@")[0]??"user"),email:o,phone:g||null,role:"user",isActive:!0,createdAt:se(),updatedAt:se()},{merge:!0});try{await $e(k.user,{url:`${window.location.origin}/`,handleCodeInApp:!1}),console.log("이메일 인증 메일 전송 성공:",o)}catch(x){console.warn("이메일 인증 메일 전송 실패:",x)}return await Se(H),!0}catch(r){throw console.error("Signup error:",r),r}},[]),p=n.useCallback(async()=>{try{const l=new Mt;l.addScope("email"),l.addScope("profile"),l.setCustomParameters({prompt:"select_account"});const o=(await $t(H,l)).user;if(console.log("Google login success:",{uid:o.uid,email:o.email,displayName:o.displayName,emailVerified:o.emailVerified}),!o.email)throw new Error("Google 계정에서 이메일 정보를 가져올 수 없습니다.");const g=ae(W,"users",o.uid);let N={name:o.displayName||o.email.split("@")[0]||"user",email:o.email,phone:o.phoneNumber||null,role:"user",isActive:!0,updatedAt:se()};try{(await Me(g)).exists()?(await be(g,N,{merge:!0}),console.log("Google 로그인: 기존 사용자 정보 업데이트됨:",o.uid)):(await be(g,{...N,createdAt:se()}),console.log("Google 로그인: 새 사용자 정보 저장됨:",o.uid))}catch(k){console.warn("Firestore 저장 실패, 하지만 로그인은 계속 진행:",k)}return!0}catch(l){throw console.error("Google login error:",l),l.code==="auth/popup-closed-by-user"||l.code==="auth/cancelled-popup-request"?new Error("Google 로그인이 취소되었습니다."):l.code==="auth/popup-blocked"?new Error("팝업이 차단되었습니다. 브라우저 설정에서 팝업을 허용해주세요."):l.code==="auth/network-request-failed"?new Error("네트워크 연결을 확인해주세요."):new Error(`Google 로그인 실패: ${l.message||"알 수 없는 오류"}`)}},[]),v=n.useCallback(async()=>{if(H.currentUser)return await $e(H.currentUser),!0;throw new Error("로그인이 필요합니다.")},[]),u=n.useCallback(async(l,r)=>{if(H.currentUser){await Je(H.currentUser,{displayName:l,photoURL:r});const o=ae(W,"users",H.currentUser.uid);return await be(o,{name:l||H.currentUser.displayName,updatedAt:se()},{merge:!0}),!0}throw new Error("로그인이 필요합니다.")},[]),y=n.useCallback(async()=>{await Se(H),s(null),h(!1)},[]);return n.useMemo(()=>({user:t,login:i,logout:y,signup:D,adminLogin:f,googleLogin:p,sendVerificationEmail:v,updateUserProfile:u,emailVerified:c,loading:d}),[t,i,y,D,f,p,v,u,c,d])},Ae=()=>{const[t,s]=n.useState(!0),[c,h]=n.useState(!1),d=n.useRef(null),[m,i]=n.useState([]),[f,D]=n.useState([]),[p,v]=n.useState([]),[u,y]=n.useState([]),[l,r]=n.useState([]),o=()=>{h(!0),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{h(!1)},500)};return n.useEffect(()=>{const g=[];let N=0;const k=5,T=()=>{N++,N>=k&&s(!1)};return g.push(Ee(ye(W,"users"),x=>{const E=x.docs.map(C=>({id:C.id,...C.data()}));y(C=>(C.length>0&&o(),E)),T()},x=>{console.error("Error fetching users:",x),T()})),g.push(Ee(Be(ye(W,"bookings"),ze("createdAt","desc")),x=>{const E=x.docs.map(C=>({id:C.id,...C.data()}));i(C=>(C.length>0&&o(),E.filter((I,M,P)=>M===P.findIndex(F=>F.id===I.id)))),T()},x=>{console.error("Error fetching bookings:",x),T()})),g.push(Ee(Be(ye(W,"programs"),ze("startDate","asc")),x=>{const E=x.docs.map(C=>({id:C.id,...C.data()}));D(C=>(C.length>0&&o(),E)),T()},x=>{console.error("Error fetching programs:",x),T()})),g.push(Ee(Be(ye(W,"program_applications"),ze("appliedAt","desc")),x=>{const E=x.docs.map(C=>({id:C.id,...C.data()}));v(C=>(C.length>0&&o(),E)),T()},x=>{console.error("Error fetching applications:",x),T()})),g.push(Ee(ye(W,"facilities"),x=>{const E=x.docs.map(C=>({id:C.id,...C.data()}));r(C=>(C.length>0&&o(),E)),T()},x=>{console.error("Error fetching facilities:",x),T()})),()=>{g.forEach(x=>x()),d.current&&clearTimeout(d.current)}},[]),n.useMemo(()=>({loading:t,syncing:c,bookings:m,setBookings:i,programs:f,setPrograms:D,applications:p,setApplications:v,users:u,setUsers:y,facilities:l}),[t,c,m,f,p,u,l])},st=t=>{const s=t.replace(/\D/g,"");return s.length<=3?s:s.length<=7?`${s.slice(0,3)}-${s.slice(3)}`:`${s.slice(0,3)}-${s.slice(3,7)}-${s.slice(7,11)}`},at=t=>({"auth/user-not-found":"미가입자입니다. 회원가입을 해주세요.","auth/wrong-password":"비밀번호가 일치하지 않습니다.","auth/email-already-in-use":"이미 사용 중인 이메일입니다.","auth/weak-password":"비밀번호가 너무 간단합니다. 6자 이상 입력해주세요.","auth/invalid-email":"올바른 이메일 형식이 아닙니다.","auth/invalid-credential":"이메일 또는 비밀번호가 잘못되었습니다. 미가입자는 회원가입을 먼저 해주세요.","auth/invalid-login-credentials":"로그인 정보가 잘못되었습니다. 미가입자는 회원가입을 먼저 해주세요.","auth/too-many-requests":"로그인 시도가 너무 많습니다. 잠시 후 다시 시도하거나 브라우저 캐시를 삭제해 주세요.","firestore/permission-denied":"접근 권한이 없습니다.","firestore/unavailable":"서비스가 일시적으로 사용 불가합니다.","firestore/deadline-exceeded":"요청 시간이 초과되었습니다.","storage/unauthorized":"파일 업로드 권한이 없습니다.","storage/object-not-found":"파일을 찾을 수 없습니다.","storage/quota-exceeded":"저장소 용량이 초과되었습니다.","functions/permission-denied":"함수 실행 권한이 없습니다.","functions/unavailable":"서버 함수가 일시적으로 사용 불가합니다."})[t]||"로그인에 실패했습니다. 이메일/비밀번호를 확인하거나 회원가입을 먼저 진행해주세요.",je=t=>{const s=t instanceof Error?t.message:String(t),c=s.match(/auth\/([\w-]+)/);return c&&c[0]?at(c[0]):at(s)},ut=n.createContext(void 0),cs=({children:t})=>{const[s,c]=n.useState([]),h=n.useCallback(m=>{c(i=>i.filter(f=>f.id!==m))},[]),d=n.useCallback((m,i="info",f=5e3)=>{const D=Date.now();window.lastNotifications||(window.lastNotifications={});const p=window.lastNotifications[m]||0;if(D-p<1e3){console.log("중복 알림 차단:",m);return}window.lastNotifications[m]=D;const v=`notification-${D}-${Math.random()}`,u={id:v,message:m,type:i,duration:f};c(y=>i==="success"||i==="error"?[u]:[...y.slice(-2),u]),f>0&&setTimeout(()=>{h(v)},f)},[h]);return e.jsx(ut.Provider,{value:{notifications:s,showNotification:d,removeNotification:h},children:t})},_e=()=>{const t=n.useContext(ut);if(t===void 0)throw new Error("useNotification must be used within a NotificationProvider");return t},ds=({email:t,setEmail:s,onSendLink:c,onCancel:h,submitting:d})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"forgot-password-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{id:"forgot-password-title",className:"text-xl font-bold text-gray-900 mb-2",children:"비밀번호 재설정 / Password Reset"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"가입 시 사용한 이메일 주소를 입력하세요. 재설정 링크를 보내드립니다."}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email","aria-label":"Email for password reset",value:t,onChange:m=>s(m.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:h,className:"flex-1 py-3 px-4 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all font-medium",children:"취소"}),e.jsx("button",{onClick:c,disabled:d,className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl border-2 border-transparent hover:bg-blue-600 hover:border-blue-700 transition-all font-medium",children:d?"전송 중...":"재설정 링크 보내기"})]})]})}),ms=({onConfirm:t,onCancel:s,errorText:c})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",role:"dialog","aria-modal":"true","aria-labelledby":"agreement-title",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-2xl w-full mx-4",children:[e.jsx("h3",{id:"agreement-title",className:"text-xl font-bold text-gray-900 mb-4",children:"개인정보 수집 및 이용 동의"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"FlexSpace Pro 서비스 제공을 위해 아래와 같이 개인정보를 수집 및 이용합니다."}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"구분"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"수집 항목"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"수집 및 이용 목적"}),e.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700",children:"보유 및 이용 기간"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:"필수"}),e.jsx("td",{className:"px-4 py-3",children:"이름, 이메일"}),e.jsx("td",{className:"px-4 py-3",children:"회원 식별 및 관리, 서비스 제공 및 공지사항 전달"}),e.jsx("td",{className:"px-4 py-3",children:"회원 탈퇴 시까지"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:"선택"}),e.jsx("td",{className:"px-4 py-3",children:"전화번호"}),e.jsx("td",{className:"px-4 py-3",children:"체육관 대관 시 긴급 연락 및 알림"}),e.jsx("td",{className:"px-4 py-3",children:"회원 탈퇴 시까지"})]})]})]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"※ 선택 항목을 동의하지 않아도 회원가입 및 기본 서비스 이용이 가능합니다. 단, 해당 정보가 필요한 일부 서비스(예: 대관 알림) 이용에 제한이 있을 수 있습니다."}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 font-medium",children:"필수 항목에 동의하지 않으면 회원가입이 제한됩니다."}),c&&e.jsx("p",{className:"text-sm text-red-600 mt-4 text-right",children:c}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 rounded-xl border",children:"취소"}),e.jsx("button",{onClick:t,className:"px-4 py-2 rounded-xl bg-blue-600 text-white",children:"동의하고 계속하기"})]})]})}),xs=({onLogin:t,onSignup:s,onAdminLogin:c,onGoogleLogin:h})=>{const{showNotification:d}=_e(),[m,i]=n.useState("login"),[f,D]=n.useState(""),[p,v]=n.useState(""),[u,y]=n.useState(""),[l,r]=n.useState(""),[o,g]=n.useState(""),[N,k]=n.useState(!1),[T,x]=n.useState(!1),[E,C]=n.useState(""),[_,I]=n.useState(!1),[M,P]=n.useState(""),F=async()=>{if(!E){d("이메일을 입력해주세요.","error");return}I(!0);try{await It(H,E),d("비밀번호 재설정 이메일을 보냈습니다. 이메일 함을 확인해주세요.","success"),x(!1)}catch(a){const b=je(a);d(b,"error")}finally{I(!1)}},w=async()=>{const a=o.replace(/-/g,"");I(!0),P("");try{const[b,S]=await s({name:f,email:p,password:u,phone:a});b?(k(!1),d(S||"회원가입이 완료되었습니다. 이메일 인증을 확인해주세요.","success"),i("login"),y(""),r("")):P(S||"회원가입에 실패했습니다. 입력 정보를 확인해주세요.")}finally{I(!1)}},z=async a=>{if(a.preventDefault(),m==="signup"){if(!f.trim()){d("이름을 입력해주세요.","error");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)){d("유효하지 않은 이메일 형식입니다.","error");return}if(u.length<6){d("비밀번호는 6자 이상이어야 합니다.","error");return}if(u!==l){d("비밀번호가 일치하지 않습니다.","error");return}}if(m!=="signup"){if(!p.trim()){d("이메일을 입력해주세요.","error");return}if(!u.trim()){d("비밀번호를 입력해주세요.","error");return}}I(!0);try{if(m==="login"){const[b,S]=await t(p,u);b?d("로그인에 성공했습니다.","success"):(d(S||"로그인에 실패했습니다. 이메일/비밀번호를 확인해주세요.","error"),S&&(S.includes("미가입자")||S.includes("회원가입을 먼저"))&&setTimeout(()=>{i("signup"),d("회원가입 페이지로 이동합니다.","info")},2e3))}else if(m==="admin_login"){const[b,S]=await c(p,u);b?d("관리자로 로그인되었습니다.","success"):d(S||"관리자 로그인에 실패했습니다. 자격을 확인해주세요.","error")}else k(!0)}finally{I(!1)}},ie=a=>{const b=a.replace(/[^0-9]/g,"");return b.length<=3?b:b.length<=7?`${b.slice(0,3)}-${b.slice(3)}`:`${b.slice(0,3)}-${b.slice(3,7)}-${b.slice(7,11)}`};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:[e.jsxs("div",{className:"w-full max-w-md bg-white rounded-2xl shadow-sm border border-gray-100 p-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center mr-2",children:e.jsx(re,{className:"w-6 h-6 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"FlexSpace Pro"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{type:"button",onClick:()=>i("login"),className:`flex-1 py-2 rounded-xl border ${m==="login"?"bg-blue-50 text-blue-700 border-blue-200":"bg-white"}`,children:"로그인"}),e.jsx("button",{type:"button",onClick:()=>i("signup"),className:`flex-1 py-2 rounded-xl border ${m==="signup"?"bg-purple-50 text-purple-700 border-purple-200":"bg-white"}`,children:"회원가입"}),e.jsx("button",{type:"button",onClick:()=>i("admin_login"),className:`flex-1 py-2 rounded-xl border ${m==="admin_login"?"bg-green-50 text-green-700 border-green-200":"bg-white"}`,children:"관리자"})]}),e.jsxs("form",{onSubmit:z,children:[m==="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(qt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름 / Name",value:f,onChange:a=>D(a.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email",value:p,onChange:a=>v(a.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Gt,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"tel",placeholder:"전화번호 (선택) / Phone (Optional)",value:o,onChange:a=>g(ie(a.target.value)),maxLength:13,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(He,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 / Password",value:u,onChange:a=>y(a.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx(He,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 확인 / Confirm Password",value:l,onChange:a=>r(a.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]})]}),m!=="signup"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(qe,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"이메일 / Email",value:p,onChange:a=>v(a.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(He,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"비밀번호 / Password",value:u,onChange:a=>y(a.target.value),required:!0,className:"w-full py-3 pl-12 pr-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors hover:border-blue-400"})]}),m==="login"&&e.jsx("div",{className:"text-right mb-4",children:e.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>{x(!0),C(p)},children:"비밀번호 재설정"})})]}),e.jsxs("button",{type:"submit",disabled:_,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl border-2 border-transparent hover:bg-blue-600 hover:border-blue-700 transition-all font-semibold",children:[m==="login"&&"로그인 / Login",m==="signup"&&"회원가입 / Sign Up",m==="admin_login"&&"관리자 로그인 / Admin Login"]})]}),m!=="admin_login"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-6 flex items-center",children:[e.jsx("div",{className:"flex-1 border-t border-gray-300"}),e.jsx("span",{className:"px-4 text-sm text-gray-500",children:"또는"}),e.jsx("div",{className:"flex-1 border-t border-gray-300"})]}),e.jsxs("button",{type:"button",onClick:async()=>{I(!0);try{const[a,b]=await h();a?d("Google 로그인에 성공했습니다.","success"):d(b||"Google 로그인에 실패했습니다.","error")}finally{I(!1)}},disabled:_,className:"w-full py-3 px-4 border border-gray-300 rounded-xl hover:bg-gray-50 transition-all font-medium flex items-center justify-center gap-3",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Google로 ",m==="login"?"로그인":"가입하기"]})]})]}),N&&e.jsx(ms,{onConfirm:w,onCancel:()=>k(!1),errorText:M}),T&&e.jsx(ds,{email:E,setEmail:C,onSendLink:F,onCancel:()=>x(!1),submitting:_})]})},us=({currentUser:t,activeTab:s,setActiveTab:c,onLogout:h})=>{const[d,m]=n.useState(!1),[i,f]=n.useState(!1),D=n.useRef(null),p="flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-200",v={dashboard:"bg-blue-50 text-blue-600 font-semibold",booking:"bg-blue-50 text-blue-600 font-semibold",program:"bg-purple-50 text-purple-600 font-semibold",admin:"bg-green-50 text-green-600 font-semibold",userManagement:"bg-yellow-50 text-yellow-700 font-semibold",facilities:"bg-indigo-50 text-indigo-600 font-semibold"},u="text-gray-600 hover:bg-gray-100 hover:text-gray-900 hover:-translate-y-px";n.useEffect(()=>{const l=r=>{D.current&&!D.current.contains(r.target)&&m(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const y=l=>{c(l),f(!1)};return e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-0 z-40",children:[e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:"FlexSpace Pro"})]}),e.jsxs("nav",{className:"hidden md:flex space-x-2",children:[e.jsxs("button",{onClick:()=>y("dashboard"),className:`${p} ${s==="dashboard"?v.dashboard:u}`,children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{children:"대시보드 / Dashboard"})]}),e.jsxs("button",{onClick:()=>y("booking"),className:`${p} ${s==="booking"?v.booking:u}`,children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"체육관 대관 / Booking"})]}),e.jsxs("button",{onClick:()=>y("program"),className:`${p} ${s==="program"?v.program:u}`,children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:"프로그램 / Program"})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y("admin"),className:`${p} ${s==="admin"?v.admin:u}`,children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"운영 관리 / Operations"})]}),e.jsxs("button",{onClick:()=>y("facilities"),className:`${p} ${s==="facilities"?v.facilities:u}`,children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{children:"시설 관리 / Facilities"})]}),e.jsxs("button",{onClick:()=>y("userManagement"),className:`${p} ${s==="userManagement"?v.userManagement:u}`,children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"회원 관리 / Users"})]})]})]}),e.jsx("button",{onClick:()=>f(!i),className:"md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors",children:i?e.jsx(dt,{className:"w-5 h-5"}):e.jsx(Kt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",ref:D,children:[e.jsxs("button",{onClick:()=>m(!d),className:"flex items-center space-x-2 cursor-pointer p-2 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("span",{className:"text-sm text-gray-600 font-medium hidden sm:block",children:[t.name," (",t.role==="admin"?"관리자":"사용자",")"]}),e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600",children:t.name.charAt(0).toUpperCase()})]}),d&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 origin-top-right animate-on-load z-50",style:{animationName:"fadeInUp",animationDuration:"0.2s"},children:e.jsxs("div",{className:"py-1",role:"menu","aria-orientation":"vertical","aria-labelledby":"options-menu",children:[e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-700 border-b",children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:t.email})]}),e.jsx("div",{className:"py-1",children:e.jsxs("button",{onClick:h,className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center",role:"menuitem",children:[e.jsx(Wt,{className:"w-4 h-4 mr-2"}),"로그아웃 / Logout"]})})]})})]})]}),i&&e.jsx("div",{className:"md:hidden bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-4 py-2 space-y-1",children:[e.jsxs("button",{onClick:()=>y("dashboard"),className:`w-full text-left ${p} ${s==="dashboard"?v.dashboard:u}`,children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{children:"대시보드 / Dashboard"})]}),e.jsxs("button",{onClick:()=>y("booking"),className:`w-full text-left ${p} ${s==="booking"?v.booking:u}`,children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"체육관 대관 / Booking"})]}),e.jsxs("button",{onClick:()=>y("program"),className:`w-full text-left ${p} ${s==="program"?v.program:u}`,children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:"프로그램 / Program"})]}),t.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>y("admin"),className:`w-full text-left ${p} ${s==="admin"?v.admin:u}`,children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"운영 관리 / Operations"})]}),e.jsxs("button",{onClick:()=>y("facilities"),className:`w-full text-left ${p} ${s==="facilities"?v.facilities:u}`,children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{children:"시설 관리 / Facilities"})]}),e.jsxs("button",{onClick:()=>y("userManagement"),className:`w-full text-left ${p} ${s==="userManagement"?v.userManagement:u}`,children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"회원 관리 / Users"})]})]})]})})]})},hs="modulepreload",gs=function(t,s){return new URL(t,s).href},rt={},q=function(s,c,h){let d=Promise.resolve();if(c&&c.length>0){let p=function(v){return Promise.all(v.map(u=>Promise.resolve(u).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};const i=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),D=f?.nonce||f?.getAttribute("nonce");d=p(c.map(v=>{if(v=gs(v,h),v in rt)return;rt[v]=!0;const u=v.endsWith(".css"),y=u?'[rel="stylesheet"]':"";if(!!h)for(let o=i.length-1;o>=0;o--){const g=i[o];if(g.href===v&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${y}`))return;const r=document.createElement("link");if(r.rel=u?"stylesheet":hs,u||(r.as="script"),r.crossOrigin="",r.href=v,D&&r.setAttribute("nonce",D),document.head.appendChild(r),u)return new Promise((o,g)=>{r.addEventListener("load",o),r.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${v}`)))})}))}function m(i){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=i,window.dispatchEvent(f),!f.defaultPrevented)throw i}return d.then(i=>{for(const f of i||[])f.status==="rejected"&&m(f.reason);return s().catch(m)})},ps=n.lazy(()=>q(()=>import("./DashboardCalendar-CnKiYDlW.js"),__vite__mapDeps([0,1,2]),import.meta.url)),fs=t=>{const s=new Date;s.setHours(0,0,0,0);const c=new Date(t.startDate);c.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=c&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((c.getTime()-s.getTime())/(1e3*60*60*24))}},lt=({status:t})=>{const s={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"},cancelled:{text:"취소됨 / Cancelled",color:"bg-gray-100 text-gray-800"}},{text:c,color:h}=s[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${h}`,children:c})},ht=["일","월","화","수","목","금","토"],bs=t=>{const{startDate:s,endDate:c,recurrenceRule:h}=t;if(s===c)return s;let d="";return h&&h.days.length>0&&(d=` (매주 / Every ${h.days.sort().map(m=>ht[m]).join(", ")})`),`${s} ~ ${c}${d}`},ys=t=>`${t.scheduleDays.sort().map(c=>ht[c]).join(",")} ${t.startTime}-${t.endTime}`,nt=({currentUser:t,bookings:s=[],applications:c=[],programs:h=[],setActiveTab:d,syncing:m=!1})=>{const{users:i}=Ae(),f=n.useMemo(()=>s.filter(l=>l.userId===t.id).sort((l,r)=>new Date(r.startDate).getTime()-new Date(l.startDate).getTime()),[s,t.id]),D=n.useMemo(()=>c.filter(l=>l.userId===t.id).sort((l,r)=>{const o=l.appliedAt?.toDate?l.appliedAt.toDate():new Date(l.appliedAt||0);return(r.appliedAt?.toDate?r.appliedAt.toDate():new Date(r.appliedAt||0)).getTime()-o.getTime()}),[c,t.id]),p=n.useMemo(()=>s.filter(l=>l.status==="pending"),[s]),v=n.useMemo(()=>c.filter(l=>l.status==="pending"),[c]),[u,y]=n.useState("month");return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:t.role==="admin"?"관리자 대시보드 / Admin Dashboard":"마이 대시보드 / My Dashboard"}),e.jsx("p",{className:"text-gray-600",children:t.role==="admin"?"체육관 운영 현황을 한눈에 확인하세요 / Check gym operational status at a glance":"나의 예약과 프로그램 신청 현황입니다 / View your booking and program application status"})]}),m&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm",children:"동기화 중..."})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:t.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"대기중인 대관 / Pending Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:p.length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"대기중인 프로그램 신청 / Pending Applications"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:v.length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"운영중인 프로그램 / Active Programs"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.filter(l=>{const r=new Date;return new Date(l.endDate)>=r}).length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"총 이용자 수 / Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.length})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-blue-600"})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"나의 대관 / My Bookings"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:f.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"나의 프로그램 신청 / My Applications"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:D.length})]}),e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"운영중인 프로그램 / Active Programs"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:h.length})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"최근 대관 신청 / Recent Bookings"}),e.jsxs("div",{className:"space-y-4",children:[(t.role==="admin"?s.slice(0,3):f.slice(0,3)).map(l=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100 border-l-4 border-blue-500",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:l.purpose}),e.jsx(lt,{status:l.status})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),l.organization&&`${l.organization} | `,bs(l)," ",l.startTime,"-",l.endTime]}),t.role==="admin"&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"신청자: ",l.userName," (",l.userEmail,")"]}),e.jsxs("p",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(he,{className:"w-4 h-4"}),l.category==="class"?"수업":l.category==="event"?"행사":l.category==="personal"?"개인":"동아리"," | ",l.numberOfParticipants,"명"]})]})]})})},l.id)),(t.role==="admin"?s:f).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"대관 신청 내역이 없습니다."})]}),(t.role==="admin"?s:f).length>3&&e.jsx("button",{onClick:()=>d("booking"),className:"w-full mt-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"전체 보기"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t.role==="admin"?"프로그램 신청 현황 / Program Applications":"내 프로그램 / My Programs"}),e.jsxs("div",{className:"space-y-4",children:[(t.role==="admin"?c.slice(0,3):D.slice(0,3)).map(l=>{const r=h.find(g=>g.id===l.programId),o=r?fs(r):null;return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100 border-l-4 border-purple-500",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:r?.title||l.programTitle||"Unknown Program"}),o&&o.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",o.dDay]}),e.jsx(lt,{status:l.status})]}),r&&e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"강사: ",r.instructor," | 기간: ",r.startDate," ~ ",r.endDate]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),"일정: ",ys(r)]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"비용: ",r.fee?`${r.fee.toLocaleString()}원`:"무료"," | 정원: ",r.enrolled??0," / ",r.capacity,"명"]})]}),t.role==="admin"&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"신청자: ",l.userName," | 신청일: ",(l.appliedAt?.toDate?l.appliedAt.toDate():new Date(l.appliedAt||0)).toLocaleDateString()]})]})})},l.id)}),(t.role==="admin"?c:D).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"프로그램 신청 내역이 없습니다."})]}),(t.role==="admin"?c:D).length>3&&e.jsx("button",{onClick:()=>d("program"),className:"w-full mt-4 py-2 text-sm font-medium text-purple-600 hover:text-purple-800 transition-colors",children:"전체 보기"})]})]}),e.jsxs("div",{id:"dashboard-calendar-section",className:"mt-6 bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"전체 일정 캘린더 / Full Schedule Calendar"}),e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"text-gray-500",children:"캘린더 로딩 중..."}),children:e.jsx(ps,{bookings:t.role==="admin"?s:f,programs:h,view:u,setView:y})})]})]})},js=({value:t,onChange:s,min:c=1,max:h})=>{const d=()=>{const f=t+1;(h===void 0||f<=h)&&s(f)},m=()=>{const f=t-1;(c===void 0||f>=c)&&s(f)},i=f=>{const D=parseInt(f.target.value.replace(/[^0-9]/g,""),10);isNaN(D)?f.target.value===""&&s(c):(c===void 0||D>=c)&&(h===void 0||D<=h)?s(D):c!==void 0&&D<c&&s(c)};return e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:t,onChange:i,className:"w-full p-3 border border-gray-200 rounded-xl text-center"}),e.jsxs("div",{className:"absolute right-2 flex flex-col",children:[e.jsx("button",{type:"button",onClick:d,className:"p-1 text-gray-500 hover:text-gray-800",children:e.jsx(Xt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:m,className:"p-1 text-gray-500 hover:text-gray-800",children:e.jsx(Yt,{className:"w-4 h-4"})})]})]})},ws=Ge(Pe,"createBooking"),vs=async(t,s,c)=>{const h={userId:c.id,userName:c.name,userEmail:c.email,purpose:t.purpose,category:t.category,numberOfParticipants:t.numberOfParticipants,facilityId:t.facilityId,startDate:t.startDate,endDate:t.endDate,startTime:t.startTime,endTime:t.endTime,status:"pending",createdAt:se(),updatedAt:se()};return await be(ae(W,"bookings",s),h),{bookingId:s}},Ns=n.memo(({status:t})=>{const s={approved:{text:"승인됨 / Approved",color:"bg-green-100 text-green-800"},pending:{text:"대기중 / Pending",color:"bg-orange-100 text-orange-800"},rejected:{text:"거절됨 / Rejected",color:"bg-red-100 text-red-800"},completed:{text:"종료 / Ended",color:"bg-gray-100 text-gray-800"},cancelled:{text:"취소됨 / Cancelled",color:"bg-gray-100 text-gray-800"}},{text:c,color:h}=s[t];return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${h}`,children:c})}),Ds=["일","월","화","수","목","금","토"],Cs=t=>{const{startDate:s,endDate:c,recurrenceRule:h}=t;if(s===c)return s;let d="";return h&&h.days.length>0&&(d=` (매주 / Every ${h.days.sort().map(m=>Ds[m]).join(", ")})`),`${s} ~ ${c}${d}`},it=n.memo(({booking:t,facilities:s})=>{const c=s.find(h=>h.id===t.facilityId);return e.jsx("div",{className:"p-3 bg-gray-50 rounded-xl transition-colors duration-200 hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600",children:[c?.name," | ",t.organization?`${t.organization} | `:"",Cs(t)," ",t.startTime,"-",t.endTime]})]}),e.jsx(Ns,{status:t.status})]})})}),ks=({currentUser:t,bookings:s,setBookings:c,syncing:h=!1})=>{const{facilities:d}=Ae(),{showNotification:m}=_e(),[i,f]=n.useState({purpose:"",category:"personal",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00",facilityId:""}),[D,p]=n.useState(!1),[v,u]=n.useState("list"),[y,l]=n.useState(new Date),r=n.useMemo(()=>s.filter(E=>(E.userId===t.id||E.userEmail===t.email)&&E.status!=="completed"),[s,t.id,t.email]),o=n.useMemo(()=>s.filter(x=>(x.userId===t.id||x.userEmail===t.email)&&x.status==="completed"),[s,t.id,t.email]),g=n.useCallback(()=>{const x=y.getFullYear(),E=y.getMonth(),C=new Date(x,E,1),_=new Date(C);_.setDate(_.getDate()-C.getDay());const I=[];for(let M=0;M<42;M++){const P=new Date(_);P.setDate(_.getDate()+M),I.push(P)}return I},[y]),N=n.useCallback(x=>{const E=x.toISOString().split("T")[0];return s.filter(_=>{if(!(_.userId===t.id||_.userEmail===t.email))return!1;const M=new Date(_.startDate+"T00:00:00"),P=new Date(_.endDate+"T00:00:00"),F=new Date(E+"T00:00:00");return F>=M&&F<=P?_.recurrenceRule&&_.recurrenceRule.days&&_.recurrenceRule.days.length>0?_.recurrenceRule.days.includes(F.getDay()):!0:!1})},[s,t.id,t.email]),k=n.useCallback(x=>{l(E=>{const C=new Date(E);return C.setMonth(E.getMonth()+(x==="next"?1:-1)),C})},[]),T=n.useCallback(async x=>{if(x.preventDefault(),D){console.log("이미 처리 중인 요청이 있습니다.");return}p(!0);const E=Date.now(),C=window.lastBookingSubmit||0;if(E-C<1e3){console.log("너무 빠른 연속 클릭 차단"),p(!1);return}window.lastBookingSubmit=E;try{if(!i.purpose?.trim()){m("대관 목적을 입력해주세요.","error");return}if(i.purpose.trim().length<2){m("체육관 목적을 최소 2글자 이상 입력해 주세요.","error");return}if(!i.category||!i.startDate||!i.endDate||!i.startTime||!i.endTime){m("모든 필수 항목을 입력해주세요.","error");return}const _=new Date(i.startDate),I=new Date(i.endDate),M=new Date;if(M.setHours(0,0,0,0),_<M){m("시작일은 오늘 이후로 선택해주세요.","error");return}if(I<_){m("종료일은 시작일 이후로 선택해주세요.","error");return}if(i.startTime>=i.endTime){m("종료 시간은 시작 시간 이후로 선택해주세요.","error");return}if(!i.facilityId){m("시설을 선택해주세요.","error");return}const P=d.find(O=>O.id===i.facilityId);if(!P){m("선택된 시설을 찾을 수 없습니다.","error");return}const F=P.bookingPolicy,w=F?.allowOverlap||!1,z=F?.maxConcurrent||1,ie=s.filter(O=>{if(O.facilityId!==i.facilityId||O.status!=="approved"&&O.status!=="pending")return!1;const $=new Date(O.startDate),A=new Date(O.endDate),K=new Date(i.startDate),G=new Date(i.endDate);if(!($<=G&&A>=K))return!1;const[U,ee]=O.startTime.split(":").map(Number),[oe,ce]=O.endTime.split(":").map(Number),[ve,Ne]=i.startTime.split(":").map(Number),[De,Ce]=i.endTime.split(":").map(Number),ke=U*60+ee,pe=oe*60+ce,le=ve*60+Ne,j=De*60+Ce;return ke<j&&pe>le});if(!w&&ie.length>0){m(`현재 [${P.name}]은 단독 사용만 가능합니다. 같은 시간에 다른 예약이 있어 신청할 수 없습니다.`,"error");return}if(w&&ie.length>=z){m(`현재 [${P.name}]은 ${z}팀 이상 제한으로 대관이 불가합니다.`,"error");return}const a={purpose:i.purpose,category:i.category,numberOfParticipants:i.numberOfParticipants||1,facilityId:P.id,startDate:i.startDate,endDate:i.endDate,startTime:i.startTime,endTime:i.endTime},b=`booking-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;let S=!1,R=null;const Z=Date.now(),X=`${t.id}-${a.startDate}-${a.startTime}`,V=window.lastBookingSubmits?.[X]||0;if(Z-V<3e3){m("잠시만 기다려주세요.","warning");return}window.lastBookingSubmits||(window.lastBookingSubmits={}),window.lastBookingSubmits[X]=Z;try{const O=ws(a),$=new Promise((K,G)=>setTimeout(()=>G(new Error("타임아웃")),3e3)),A=await Promise.race([O,$]);S=!0,R={id:A?.data?.bookingId||b,userId:t.id,userName:t.name,userEmail:t.email,...a,status:"pending",createdAt:new Date}}catch{try{await vs(a,b,t),S=!0,R={id:b,userId:t.id,userName:t.name,userEmail:t.email,...a,status:"pending",createdAt:new Date}}catch{S=!1}}S?(f({purpose:"",category:"personal",numberOfParticipants:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00",facilityId:""}),m("대관 신청이 완료되었습니다!","success")):m("대관 신청에 실패했습니다.","error")}catch(_){console.error("대관 신청 최종 오류:",_),m("대관 신청 중 문제가 발생했습니다. 다시 시도해주세요.","error")}finally{p(!1)}},[i,d,m,t]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"체육관 대관 / Gym Booking"}),e.jsx("p",{className:"text-gray-600",children:"체육관 공간을 예약하고 관리하세요 / Book and manage gym spaces"}),h&&e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 mt-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs",children:"동기화 중..."})]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>u("list"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${v==="list"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Qt,{className:"w-4 h-4"}),"목록 / List"]}),e.jsxs("button",{onClick:()=>u("calendar"),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${v==="calendar"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(te,{className:"w-4 h-4"}),"캘린더 / Calendar"]})]})]}),v==="list"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"진행중인 대관 / Active Bookings"}),e.jsxs("div",{className:"space-y-3",children:[r.map(x=>e.jsx(it,{booking:x,facilities:d},x.id)),r.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"진행중인 대관 신청이 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"완료된 대관 / Completed Bookings"}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:[o.map(x=>e.jsx(it,{booking:x,facilities:d},x.id)),o.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-10",children:"완료된 대관이 없습니다."})]})]})]})}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:[y.getFullYear(),"년 ",y.getMonth()+1,"월"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>k("prev"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Zt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>l(new Date),className:"px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"오늘"}),e.jsx("button",{onClick:()=>k("next"),className:"p-2 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(Jt,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-px mb-2",children:["일","월","화","수","목","금","토"].map(x=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-500",children:x},x))}),e.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-200 rounded-lg overflow-hidden",children:g().map((x,E)=>{const C=N(x),_=x.getMonth()===y.getMonth(),I=x.toDateString()===new Date().toDateString();return e.jsxs("div",{className:`bg-white p-2 min-h-[120px] ${_?"text-gray-900":"text-gray-400"} ${I?"bg-blue-50":""}`,children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${I?"text-blue-600":""}`,children:x.getDate()}),e.jsxs("div",{className:"space-y-1",children:[C.slice(0,3).map(M=>e.jsx("div",{className:`text-xs px-2 py-1 rounded text-white text-center truncate ${M.status==="approved"?"bg-green-500":M.status==="pending"?"bg-orange-500":M.status==="rejected"?"bg-red-500":"bg-gray-500"}`,title:`${M.purpose} (${M.startTime}-${M.endTime})`,children:M.purpose},M.id)),C.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",C.length-3," more"]})]})]},E)})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"승인됨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:"대기중"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"거절됨"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded"}),e.jsx("span",{children:"완료됨"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"신규 대관 신청"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.purpose||"",onChange:x=>f({...i,purpose:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:i.category,onChange:x=>f({...i,category:x.target.value}),children:[e.jsx("option",{value:"personal",children:"개인"}),e.jsx("option",{value:"club",children:"동아리"}),e.jsx("option",{value:"event",children:"행사"}),e.jsx("option",{value:"class",children:"수업"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설 선택"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:i.facilityId||"",onChange:x=>f({...i,facilityId:x.target.value}),children:[e.jsx("option",{value:"",children:"시설을 선택해 주세요"}),d.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]})]}),e.jsx("div",{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.startDate||"",onChange:x=>f({...i,startDate:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.endDate||"",onChange:x=>f({...i,endDate:x.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.startTime||"",onChange:x=>f({...i,startTime:x.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("input",{type:"time",className:"w-full p-3 border border-gray-200 rounded-xl",value:i.endTime||"",onChange:x=>f({...i,endTime:x.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"인원"}),e.jsx(js,{value:i.numberOfParticipants||1,onChange:x=>f({...i,numberOfParticipants:x})})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{type:"submit",disabled:D,className:`w-full md:w-auto px-6 py-3 rounded-xl font-medium transition-all duration-200 transform ${D?"bg-gray-400 cursor-not-allowed scale-95":"bg-blue-600 hover:bg-blue-700 hover:scale-105 text-white shadow-lg hover:shadow-xl"}`,style:{pointerEvents:D?"none":"auto"},children:D?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"처리 중..."})]}):e.jsx("span",{className:"flex items-center gap-2",children:"📅 대관 신청"})})})]})]})]})]})},Ss=Ge(Pe,"createProgramApplication"),Es=["일","월","화","수","목","금","토"],Ts=t=>{const s=new Date;s.setHours(0,0,0,0);const c=new Date(t.startDate);c.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=c&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((c.getTime()-s.getTime())/(1e3*60*60*24))}},gt=t=>`${(t.scheduleDays||[]).sort().map(s=>Es[s]).join(", ")} ${t.startTime}-${t.endTime}`;n.memo(({p:t,status:s,onApply:c,applying:h,isAlreadyApplied:d,applicationStatus:m})=>e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:t.title}),s.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",s.dDay]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500 flex-wrap",children:[e.jsxs("span",{children:["강사: ",t.instructor]}),e.jsxs("span",{children:["기간: ",t.startDate," ~ ",t.endDate]}),e.jsxs("span",{children:["일정: ",gt(t)]}),e.jsxs("span",{children:["비용: ",t.fee?`${t.fee.toLocaleString()}원`:"무료 / Free"]}),e.jsxs("span",{children:["정원: ",t.enrolled??0," / ",t.capacity]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.text==="종료"?"bg-gray-100 text-gray-800":"bg-green-100 text-green-800"}`,children:s.text}),d&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${m==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:m==="approved"?"승인됨":"신청완료"}),s.text!=="종료"&&e.jsx("button",{disabled:h||d,onClick:()=>c(t.id),className:`px-4 py-2 rounded-xl font-medium transition-colors ${d?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700"}`,children:d?"신청완료":h?"신청중...":"신청하기"})]})]})}));const Ps=({currentUser:t,programs:s,applications:c,setApplications:h})=>{const{showNotification:d}=_e(),[m,i]=n.useState(""),[f,D]=n.useState(null),p=n.useMemo(()=>s.filter(u=>u.title.toLowerCase().includes(m.toLowerCase())),[s,m]),v=n.useCallback(async u=>{const y=c.find(r=>r.programId===u&&r.userId===t.id&&(r.status==="pending"||r.status==="approved"));if(y){const r=y.status==="pending"?"대기중":"승인됨";d(`이미 이 프로그램에 신청하셨습니다. (현재 상태: ${r})`,"warning");return}D(u);const l={id:`temp-${Date.now()}`,userId:t.id,programId:u,status:"pending",appliedAt:new Date,userName:t.name,userEmail:t.email,programTitle:s.find(r=>r.id===u)?.title||"Unknown Program"};h(r=>[l,...r]),d("프로그램 신청이 완료되었습니다. 관리자 승인을 기다려주세요.","success");try{const r=await Ss({programId:u});if(r?.data?.success)h(o=>o.map(g=>g.id===l.id?{...g,id:r.data.applicationId}:g)),console.log("프로그램 신청 Firebase 저장 성공:",r.data.applicationId);else{h(g=>g.filter(N=>N.id!==l.id));const o=r?.data?.message||"신청에 실패했습니다. 잠시 후 다시 시도해주세요.";d(o,"error")}}catch(r){h(o=>o.filter(g=>g.id!==l.id)),d(`신청 실패: ${r?.message||"네트워크 오류가 발생했습니다. 잠시 후 다시 시도해주세요."}`,"error")}finally{D(null)}},[d,t,s,h,c]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"프로그램"}),e.jsx("p",{className:"text-gray-600",children:"다양한 체육 프로그램에 참여해보세요"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"검색"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(mt,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{value:m,onChange:u=>i(u.target.value),placeholder:"프로그램명, 강사명...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"종목"}),e.jsx("option",{value:"yoga",children:"요가"}),e.jsx("option",{value:"pilates",children:"필라테스"}),e.jsx("option",{value:"fitness",children:"피트니스"}),e.jsx("option",{value:"dance",children:"댄스"}),e.jsx("option",{value:"badminton",children:"배드민턴"}),e.jsx("option",{value:"pickleball",children:"피클볼"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"요일"}),e.jsx("option",{value:"월",children:"월요일"}),e.jsx("option",{value:"화",children:"화요일"}),e.jsx("option",{value:"수",children:"수요일"}),e.jsx("option",{value:"목",children:"목요일"}),e.jsx("option",{value:"금",children:"금요일"}),e.jsx("option",{value:"토",children:"토요일"}),e.jsx("option",{value:"일",children:"일요일"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"시간대"}),e.jsx("option",{value:"morning",children:"오전 (06:00-12:00)"}),e.jsx("option",{value:"afternoon",children:"오후 (12:00-18:00)"}),e.jsx("option",{value:"evening",children:"저녁 (18:00-22:00)"})]}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"레벨"}),e.jsx("option",{value:"beginner",children:"초급"}),e.jsx("option",{value:"intermediate",children:"중급"}),e.jsx("option",{value:"advanced",children:"고급"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["진행중인 프로그램 (",p.length,"개)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-purple-600 bg-purple-50 rounded-lg",children:"필라테스"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-lg",children:"진행 중"}),e.jsx("button",{className:"px-4 py-2 text-sm font-medium text-green-600 bg-green-50 rounded-lg",children:"초급"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:p.map(u=>{const y=Ts(u),l=c.find(o=>o.programId===u.id&&o.userId===t.id&&(o.status==="pending"||o.status==="approved")),r=!!l;return e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-1",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:u.title}),y.dDay!==null&&e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-semibold bg-red-500 text-white",children:["D-",y.dDay]})]}),e.jsx("p",{className:"text-gray-600 mb-3",children:u.description})]}),e.jsxs("div",{className:"ml-4 flex flex-col gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${y.text==="종료"?"bg-gray-100 text-gray-800":y.text==="진행중"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:y.text}),r&&e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${l?.status==="approved"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:l?.status==="approved"?"승인됨":"신청완료"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{children:["강사: ",u.instructor]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsxs("span",{children:["기간: ",u.startDate," ~ ",u.endDate]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"w-4 h-4"}),e.jsxs("span",{children:["일정: ",gt(u)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),e.jsxs("span",{children:["정원: ",u.enrolled??0," / ",u.capacity,"명"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:u.fee?`${u.fee.toLocaleString()}원`:"무료"}),y.text!=="종료"&&e.jsx("button",{disabled:f===u.id||r,onClick:()=>v(u.id),className:`px-6 py-2 rounded-xl font-medium transition-colors ${r?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50"}`,children:r?"신청완료":f===u.id?"신청중...":"신청하기"})]})]})},u.id)})}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(he,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"검색 결과가 없습니다"}),e.jsx("p",{className:"text-gray-600",children:"다른 조건으로 검색해보세요."})]})]})},As=n.lazy(()=>q(()=>import("./DashboardCalendar-CnKiYDlW.js"),__vite__mapDeps([0,1,2]),import.meta.url));Ge(Pe,"updateReservationStatus");const pt=["일","월","화","수","목","금","토"],_s=t=>{const s=new Date;s.setHours(0,0,0,0);const c=new Date(t.startDate);c.setHours(0,0,0,0);const h=new Date(t.endDate);return h.setHours(0,0,0,0),s>h?{text:"종료",dDay:null}:s>=c&&s<=h?{text:"진행중",dDay:null}:{text:"모집중",dDay:Math.ceil((c.getTime()-s.getTime())/(1e3*60*60*24))}},Ms=n.memo(({b:t,onAction:s})=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.purpose}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.userName," | ",t.startDate," ",t.startTime,"-",t.endTime]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t.id,"approve"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>s(t.id,"reject"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})})),$s=n.memo(({p:t,onEdit:s,onDelete:c})=>{const h=_s(t);return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.title}),h.dDay!==null&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2.5 py-1 rounded-full",children:["D-",h.dDay]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.instructor," | ",t.startDate," ~ ",t.endDate," | ",t.startDate!==t.endDate?(t.scheduleDays||[]).slice().sort().map(d=>pt[d]).join(","):"단일"," | ",t.startTime," - ",t.endTime," | ",t.fee?`${t.fee.toLocaleString()}원`:"무료"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s(t),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(t),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg",children:e.jsx(We,{className:"w-4 h-4"})})]})]})});function Is({currentUser:t,bookings:s,setBookings:c,applications:h,setApplications:d,programs:m,setPrograms:i,users:f,facilities:D}){const{showNotification:p}=_e();console.log("🔍 AdminSection 프로그램 데이터 확인:",{programsCount:m.length,programs:m,activePrograms:m.filter(a=>{const b=new Date;return new Date(a.endDate)>=b}).length});const[v,u]=n.useState(!1),[y,l]=n.useState(null),[r,o]=n.useState("month"),g={title:"",description:"",instructor:"",capacity:10,scheduleDays:[],startTime:"09:00",endTime:"10:00",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],level:"beginner",category:"yoga",fee:0},[N,k]=n.useState(g),T=n.useMemo(()=>N.startDate!==N.endDate,[N.startDate,N.endDate]),x=n.useMemo(()=>{const a=[];for(let b=0;b<24;b++)for(let S=0;S<60;S+=10)a.push(`${String(b).padStart(2,"0")}:${String(S).padStart(2,"0")}`);return a},[]),E=n.useCallback(async()=>{const a={...y??{id:`program-${Date.now()}`},...N};y?(i(b=>b.map(S=>S.id===a.id?a:S)),p("프로그램이 수정되었습니다.","success")):(i(b=>[a,...b]),p("새 프로그램이 개설되었습니다.","success"));try{const{doc:b,setDoc:S,updateDoc:R,serverTimestamp:Z}=await q(async()=>{const{doc:O,setDoc:$,updateDoc:A,serverTimestamp:K}=await import("./firebase-DnP1Uaxu.js").then(G=>G.M);return{doc:O,setDoc:$,updateDoc:A,serverTimestamp:K}},[],import.meta.url),{db:X}=await q(async()=>{const{db:O}=await Promise.resolve().then(()=>ne);return{db:O}},void 0,import.meta.url),V=new Date;y?(await R(b(X,"programs",a.id),{...a,updatedAt:V}),console.log("프로그램 수정 완료:",a.id)):(await S(b(X,"programs",a.id),{...a,createdAt:V,updatedAt:V}),console.log("새 프로그램 생성 완료:",a.id))}catch(b){console.warn("Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",b)}u(!1),l(null)},[N,y,i,p]),C=n.useCallback(async(a,b)=>{console.log("=== 대관 승인/거절 시작 ===",{bookingId:a,action:b});const S=b==="approve"?"approved":"rejected";try{console.log("1. 로컬 상태 업데이트 실행"),c($=>$.map(A=>A.id===a?{...A,status:S}:A)),p(`대관이 ${b==="approve"?"승인":"거절"}되었습니다.`,"success"),console.log("3. Firebase 저장 시작");const{doc:R,updateDoc:Z,serverTimestamp:X}=await q(async()=>{const{doc:$,updateDoc:A,serverTimestamp:K}=await import("./firebase-DnP1Uaxu.js").then(G=>G.M);return{doc:$,updateDoc:A,serverTimestamp:K}},[],import.meta.url),{db:V}=await q(async()=>{const{db:$}=await Promise.resolve().then(()=>ne);return{db:$}},void 0,import.meta.url),O={status:S,updatedAt:X(),[b==="approve"?"approvedAt":"rejectedAt"]:X()};console.log("3-1. 업데이트할 데이터:",O),console.log("3-2. 대상 문서:",`bookings/${a}`),await Z(R(V,"bookings",a),O),console.log("✅ Firebase 저장 성공 - 실시간 동기화 보장됨")}catch(R){console.error("❌ Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",R)}},[s,c,p]),_=n.useCallback(async(a,b)=>{const S=h;try{d($=>$.map(A=>A.id===a?{...A,status:b}:A));const{doc:R,updateDoc:Z,serverTimestamp:X}=await q(async()=>{const{doc:$,updateDoc:A,serverTimestamp:K}=await import("./firebase-DnP1Uaxu.js").then(G=>G.M);return{doc:$,updateDoc:A,serverTimestamp:K}},[],import.meta.url),{db:V}=await q(async()=>{const{db:$}=await Promise.resolve().then(()=>ne);return{db:$}},void 0,import.meta.url),O=new Date;await Z(R(V,"program_applications",a),{status:b,updatedAt:O,[b==="approved"?"approvedAt":"rejectedAt"]:O}),console.log("프로그램 신청 상태 Firebase 저장 성공:",a,b),p(`프로그램 신청이 ${b==="approved"?"승인":"거절"}되었습니다.`,"success")}catch(R){console.error("프로그램 신청 상태 업데이트 실패:",R),d(S),p("프로그램 신청 상태 변경에 실패했습니다. 다시 시도해주세요.","error")}},[h,d,p]),I=n.useMemo(()=>s.filter(a=>a.status==="pending"),[s]),M=n.useMemo(()=>h.filter(a=>a.status==="pending"),[h]),P=n.useMemo(()=>m.filter(a=>{const b=new Date;return new Date(a.endDate)>=b}),[m]),F=n.useMemo(()=>f.length,[f]),[w,z]=n.useState({name:"",category:"class",purpose:"",facilityId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"}),ie=n.useCallback(async()=>{if(!w.name||w.name.trim().length===0){p("신청자 이름을 입력해주세요.","error");return}if(!w.purpose||w.purpose.trim().length===0){p("대관 목적을 입력해주세요.","error");return}if(!w.facilityId){p("시설을 선택해주세요.","error");return}const a=new Date(w.startDate+"T00:00:00");if(new Date(w.endDate+"T00:00:00")<a){p("종료일은 시작일 이후로 선택해주세요.","error");return}if(w.startTime>=w.endTime){p("종료 시간은 시작 시간 이후로 선택해주세요.","error");return}const S=D.find(A=>A.id===w.facilityId);if(!S){p("선택된 시설을 찾을 수 없습니다.","error");return}const R=S.bookingPolicy,Z=R?.allowOverlap||!1,X=R?.maxConcurrent||1,V=s.filter(A=>{if(A.facilityId!==w.facilityId||A.status!=="approved")return!1;const K=new Date(A.startDate),G=new Date(A.endDate),ge=new Date(w.startDate),U=new Date(w.endDate);if(!(K<=U&&G>=ge))return!1;const[oe,ce]=A.startTime.split(":").map(Number),[ve,Ne]=A.endTime.split(":").map(Number),[De,Ce]=w.startTime.split(":").map(Number),[ke,pe]=w.endTime.split(":").map(Number),le=oe*60+ce,j=ve*60+Ne,L=De*60+Ce,Y=ke*60+pe;return le<Y&&j>L});if(!Z&&V.length>0){p("이 시설은 단독 사용만 가능합니다. 같은 시간에 다른 예약이 있어 등록할 수 없습니다.","error");return}if(Z&&V.length>=X){p(`이 시설은 최대 ${X}팀까지 동시 사용 가능합니다. 현재 ${V.length}팀이 예약되어 있어 추가 등록이 불가합니다.`,"error");return}const O=`booking-${Date.now()}`,$={id:O,userId:t.id,userName:w.name,userEmail:t.email,facilityId:w.facilityId,startDate:w.startDate,endDate:w.endDate,startTime:w.startTime,endTime:w.endTime,purpose:w.purpose,category:w.category,status:"approved",numberOfParticipants:1,createdAt:new Date};c(A=>{const K=[$,...A];return console.log("📅 관리자 대관 등록 완료 - 캘린더 업데이트:",{bookingId:O,purpose:$.purpose,status:$.status,totalBookings:K.length}),K}),p("대관이 승인되어 등록되었습니다. 캘린더에서 확인 가능합니다.","success");try{const{doc:A,setDoc:K,serverTimestamp:G}=await q(async()=>{const{doc:U,setDoc:ee,serverTimestamp:oe}=await import("./firebase-DnP1Uaxu.js").then(ce=>ce.M);return{doc:U,setDoc:ee,serverTimestamp:oe}},[],import.meta.url),{db:ge}=await q(async()=>{const{db:U}=await Promise.resolve().then(()=>ne);return{db:U}},void 0,import.meta.url);await K(A(ge,"bookings",O),{...$,createdAt:G(),updatedAt:G(),approvedAt:G()}),console.log("대관 신청 Firebase 저장 성공:",O)}catch(A){console.warn("Firebase 저장 실패 (로컬 상태는 이미 업데이트됨):",A)}z({name:"",category:"class",purpose:"",facilityId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],startTime:"09:00",endTime:"10:00"})},[w,t,c,p,D,s]);return e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"운영 관리"}),e.jsx("p",{className:"text-gray-600",children:"대관 및 프로그램 신청을 관리하고, 체육관 직접 등록을 할 수 있습니다"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기중인 대관"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:I.length})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-50 rounded-xl flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"대기중인 프로그램 신청"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:M.length})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-6 h-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"운영중인 프로그램"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:P.length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center",children:e.jsx(he,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"총 이용자 수"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:F})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-blue-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"수강생/팀 직접 등록"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"아래 폼을 사용하여 대관을 등록하세요"})]}),e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"신청자 이름"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",placeholder:"예: 관리자 등록",value:w.name,onChange:a=>z({...w,name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"대관 목적"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",placeholder:"대관 목적을 입력하세요",value:w.purpose,onChange:a=>z({...w,purpose:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분류"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.category,onChange:a=>z({...w,category:a.target.value}),children:[e.jsx("option",{value:"class",children:"수업"}),e.jsx("option",{value:"event",children:"행사"}),e.jsx("option",{value:"club",children:"동아리"}),e.jsx("option",{value:"personal",children:"개인"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시설 선택"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.facilityId,onChange:a=>z({...w,facilityId:a.target.value}),children:[e.jsx("option",{value:"",children:"시설을 선택해 주세요"}),D.map(a=>{const b=a.bookingPolicy,S=b?.allowOverlap?`(공유사용, 최대 ${b.maxConcurrent||1}팀)`:"(단독사용)";return e.jsxs("option",{value:a.id,children:[a.name," ",S]},a.id)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.startDate,onChange:a=>z({...w,startDate:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.endDate,onChange:a=>z({...w,endDate:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.startTime,onChange:a=>z({...w,startTime:a.target.value}),children:[e.jsx("option",{value:"09:00",children:"09:00"}),e.jsx("option",{value:"10:00",children:"10:00"}),e.jsx("option",{value:"11:00",children:"11:00"}),e.jsx("option",{value:"14:00",children:"14:00"}),e.jsx("option",{value:"15:00",children:"15:00"}),e.jsx("option",{value:"16:00",children:"16:00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsxs("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-gray-50",value:w.endTime,onChange:a=>z({...w,endTime:a.target.value}),children:[e.jsx("option",{value:"10:00",children:"10:00"}),e.jsx("option",{value:"11:00",children:"11:00"}),e.jsx("option",{value:"12:00",children:"12:00"}),e.jsx("option",{value:"15:00",children:"15:00"}),e.jsx("option",{value:"16:00",children:"16:00"}),e.jsx("option",{value:"17:00",children:"17:00"})]})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"취소"}),e.jsx("button",{onClick:ie,className:"px-6 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700",children:"등록하기"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-50 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["사용자 대관 신청 대기 (",I.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:I.length>0?I.map(a=>e.jsx(Ms,{b:a,onAction:C},a.id)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"대기중인 신청이 없습니다."})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["대기중인 프로그램 신청 (",M.length,")"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:M.length>0?M.map(a=>{const b=m.find(S=>S.id===a.programId);return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl transition-shadow hover:shadow-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:b?.title||a.programTitle}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["신청자: ",a.userName," | 신청일: ",a.appliedAt?.toDate?.()?.toLocaleDateString()||"N/A"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_(a.id,"approved"),className:"px-3 py-2 rounded-lg bg-green-100 text-green-700 border border-green-200 text-sm font-medium",children:"승인"}),e.jsx("button",{onClick:()=>_(a.id,"rejected"),className:"px-3 py-2 rounded-lg bg-red-100 text-red-700 border border-red-200 text-sm font-medium",children:"거절"})]})]})},a.id)}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"대기중인 신청이 없습니다."})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-50 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"프로그램 관리"})]}),e.jsxs("button",{onClick:()=>{l(null),k(g),u(!0)},className:"flex items-center gap-2 text-sm font-medium text-purple-600 hover:text-purple-800 px-4 py-2 rounded-lg hover:bg-purple-50",children:[e.jsx(Xe,{className:"w-4 h-4"})," 새 프로그램 추가"]})]}),e.jsxs("div",{className:"space-y-3",children:[m.map(a=>e.jsx($s,{p:a,onEdit:b=>{l(b),k(b),u(!0)},onDelete:b=>i(S=>S.filter(R=>R.id!==b.id))},a.id)),m.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-6",children:"등록된 프로그램이 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-50 rounded-lg flex items-center justify-center",children:e.jsx(te,{className:"w-5 h-5 text-indigo-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"전체 대관 캘린더"})]}),e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"text-center py-8 text-gray-500",children:"캘린더 로딩 중..."}),children:e.jsx(As,{bookings:s,programs:m,view:r,setView:o})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-2xl",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:y?"프로그램 수정":"새 프로그램 개설"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"제목"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.title,onChange:a=>k({...N,title:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"강사"}),e.jsx("input",{type:"text",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.instructor,onChange:a=>k({...N,instructor:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명"}),e.jsx("textarea",{className:"w-full p-3 border border-gray-200 rounded-xl",rows:3,value:N.description,onChange:a=>k({...N,description:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.startDate,onChange:a=>k({...N,startDate:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료일"}),e.jsx("input",{type:"date",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.endDate,onChange:a=>k({...N,endDate:a.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"반복 요일"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:pt.map((a,b)=>e.jsx("button",{type:"button",onClick:()=>k(S=>({...S,scheduleDays:S.scheduleDays.includes(b)?S.scheduleDays.filter(R=>R!==b):[...S.scheduleDays,b]})),className:`p-2 rounded-lg border text-sm font-medium ${N.scheduleDays.includes(b)?"bg-purple-500 text-white border-purple-500":"bg-white hover:bg-gray-100 border-gray-300"} ${T?"":"opacity-50 pointer-events-none"}`,children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"시작 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:N.startTime,onChange:a=>k({...N,startTime:a.target.value}),children:x.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"종료 시간"}),e.jsx("select",{className:"w-full p-3 border border-gray-200 rounded-xl bg-white",value:N.endTime,onChange:a=>k({...N,endTime:a.target.value}),children:x.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"정원"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.capacity,onChange:a=>k({...N,capacity:parseInt(a.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"금액"}),e.jsx("input",{type:"number",className:"w-full p-3 border border-gray-200 rounded-xl",value:N.fee||0,onChange:a=>k({...N,fee:parseInt(a.target.value)||0})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{className:"px-4 py-2 rounded-xl border",onClick:()=>{u(!1),l(null)},children:"취소"}),e.jsx("button",{className:"px-4 py-2 rounded-xl bg-purple-600 text-white",onClick:E,children:y?"수정하기":"개설하기"})]})]})})]})}const Os=({users:t,setUsers:s})=>{const{users:c,loading:h}=Ae(),d=c.length>0?c:t||[],[m,i]=n.useState(!1),[f,D]=n.useState(!1),[p,v]=n.useState(null),[u,y]=n.useState(null),[l,r]=n.useState(null),o={name:"",email:"",phone:"",password:"",role:"user"},[g,N]=n.useState(o),[k,T]=n.useState(""),[x,E]=n.useState(""),[C,_]=n.useState(""),[I,M]=n.useState(""),[P,F]=n.useState(null),[w,z]=n.useState(!1),[ie,a]=n.useState(!1),[b,S]=n.useState(""),[R,Z]=n.useState("name"),[X]=n.useState("all"),[V,O]=n.useState({key:"name",direction:"asc"}),$=ct();n.useEffect(()=>{f&&setTimeout(()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new Ot($,"recaptcha-container",{size:"invisible",callback:()=>{}}))},100)},[f,$]);const A=j=>{v(j),N({name:j.name,email:j.email,phone:j.phone||"",password:"",role:j.role}),i(!0)},K=()=>{v(null),N(o),i(!0)},G=()=>{i(!1),v(null)},ge=j=>{r(j),T(j.email),_(j.phone||""),E(""),M(""),F(null),D(!0)},U=()=>{D(!1),r(null),window.recaptchaVerifier&&window.recaptchaVerifier.clear()},ee=j=>{const{name:L,value:Y}=j.target;N(L==="phone"?B=>({...B,[L]:st(Y)}):B=>({...B,[L]:Y}))},oe=async j=>{j.preventDefault(),a(!0);try{if(p){if(d.some(J=>J.email===g.email&&J.id!==p.id)){alert("이미 사용 중인 이메일입니다.");return}const{doc:L,updateDoc:Y,serverTimestamp:B}=await q(async()=>{const{doc:J,updateDoc:de,serverTimestamp:Ie}=await import("./firebase-DnP1Uaxu.js").then(Oe=>Oe.M);return{doc:J,updateDoc:de,serverTimestamp:Ie}},[],import.meta.url),{db:Q}=await q(async()=>{const{db:J}=await Promise.resolve().then(()=>ne);return{db:J}},void 0,import.meta.url),fe={name:g.name,email:g.email,phone:g.phone.replace(/-/g,"")||null,role:g.role,updatedAt:B()};await Y(L(Q,"users",p.id),fe),s&&s(J=>J.map(de=>de.id===p.id?{...de,name:g.name,email:g.email,phone:g.phone.replace(/-/g,""),role:g.role}:de)),alert("사용자 정보가 수정되었습니다.")}else{if(d.some(B=>B.email===g.email)){alert("이미 등록된 이메일입니다.");return}if(!g.password){alert("신규 사용자는 비밀번호가 필요합니다.");return}const{httpsCallable:L}=await q(async()=>{const{httpsCallable:B}=await import("./firebase-DnP1Uaxu.js").then(Q=>Q.N);return{httpsCallable:B}},[],import.meta.url),{functions:Y}=await q(async()=>{const{functions:B}=await Promise.resolve().then(()=>ne);return{functions:B}},void 0,import.meta.url);try{const Q=await L(Y,"createUserByAdmin")({name:g.name,email:g.email,phone:g.phone.replace(/-/g,"")||null,password:g.password,role:g.role});if(Q.data.success){if(alert(`새 사용자 '${g.name}'이 생성되었습니다.

관리자가 생성한 계정이므로 이메일 인증 없이 바로 로그인할 수 있습니다.`),s){const fe={id:Q.data.uid,name:g.name,email:g.email,phone:g.phone.replace(/-/g,""),role:g.role};s(J=>[...J,fe])}}else throw new Error(Q.data.error||"사용자 생성에 실패했습니다.")}catch(B){console.warn("Cloud Functions 사용자 생성 실패, 직접 생성 방식으로 전환:",B);const{createUserWithEmailAndPassword:Q,sendEmailVerification:fe,updateProfile:J,signOut:de}=await q(async()=>{const{createUserWithEmailAndPassword:me,sendEmailVerification:xe,updateProfile:Re,signOut:Ve}=await import("./firebase-DnP1Uaxu.js").then(bt=>bt.L);return{createUserWithEmailAndPassword:me,sendEmailVerification:xe,updateProfile:Re,signOut:Ve}},[],import.meta.url),{doc:Ie,setDoc:Oe,serverTimestamp:Ye}=await q(async()=>{const{doc:me,setDoc:xe,serverTimestamp:Re}=await import("./firebase-DnP1Uaxu.js").then(Ve=>Ve.M);return{doc:me,setDoc:xe,serverTimestamp:Re}},[],import.meta.url),{auth:Le,db:ft}=await q(async()=>{const{auth:me,db:xe}=await Promise.resolve().then(()=>ne);return{auth:me,db:xe}},void 0,import.meta.url);if(!Le.currentUser)throw new Error("관리자 로그인이 필요합니다.");const Fe=(await Q(Le,g.email,g.password)).user;if(await J(Fe,{displayName:g.name||g.email.split("@")[0]}),await Oe(Ie(ft,"users",Fe.uid),{name:g.name,email:g.email,phone:g.phone.replace(/-/g,"")||null,role:g.role,isActive:!0,adminCreated:!0,createdAt:Ye(),updatedAt:Ye()}),console.log("관리자가 직접 생성한 사용자이므로 이메일 인증 메일을 발송하지 않습니다."),await de(Le),alert(`새 사용자 '${g.name}'이 생성되었습니다.

⚠️ 새 사용자 생성으로 인해 자동 로그아웃되었습니다.
관리자 계정으로 다시 로그인해주세요.

생성된 사용자는 이메일 인증 없이 바로 로그인할 수 있습니다.`),s){const me={id:Fe.uid,name:g.name,email:g.email,phone:g.phone.replace(/-/g,""),role:g.role};s(xe=>[...xe,me])}}}G()}catch(L){console.error("User creation/update error:",L);const Y=je(L);alert(Y)}finally{a(!1)}},ce=j=>{if(j.role==="admin"&&d.filter(L=>L.role==="admin").length<=1){alert("마지막 관리자 계정은 삭제할 수 없습니다.");return}y(j)},ve=async()=>{if(u){try{const{deleteDoc:j,doc:L}=await q(async()=>{const{deleteDoc:B,doc:Q}=await import("./firebase-DnP1Uaxu.js").then(fe=>fe.M);return{deleteDoc:B,doc:Q}},[],import.meta.url),{db:Y}=await q(async()=>{const{db:B}=await Promise.resolve().then(()=>ne);return{db:B}},void 0,import.meta.url);await j(L(Y,"users",u.id)),alert("사용자가 삭제되었습니다."),s&&s(B=>B.filter(Q=>Q.id!==u.id))}catch(j){console.error("사용자 삭제 오류:",j),alert("사용자 삭제에 실패했습니다.")}y(null)}},Ne=j=>{let L="asc";V&&V.key===j&&V.direction==="asc"&&(L="desc"),O({key:j,direction:L})},De=async()=>{if(!C){alert("휴대폰 번호를 입력하세요.");return}z(!0);try{const j=window.recaptchaVerifier,L=await Lt($,C,j);F(L),alert("인증 코드를 발송했습니다.")}catch(j){console.error("SMS Error:",j),alert("SMS 인증 코드 요청에 실패했습니다.")}finally{z(!1)}},Ce=async()=>{if(!I){alert("인증 코드를 입력하세요.");return}if(!P){alert("먼저 인증 코드를 요청하세요.");return}z(!0);try{await P.confirm(I),alert("휴대폰 인증이 완료되었습니다.")}catch(j){console.error("Verification Error:",j),alert("인증 코드가 잘못되었습니다.")}finally{z(!1)}},ke=async()=>{if(!k||!x){alert("새 이메일과 현재 비밀번호를 입력하세요.");return}if($.currentUser){z(!0);try{const j=Ft.credential($.currentUser.email,x);await Rt($.currentUser,j),await Vt($.currentUser,k),alert("이메일 주소가 변경되었습니다. 새 주소로 인증 메일을 확인하세요."),U()}catch(j){console.error("Email Update Error:",j),alert("이메일 변경에 실패했습니다. 비밀번호를 확인하세요.")}finally{z(!1)}}},pe=n.useMemo(()=>{const j=d.filter(L=>X==="all"||L.role===X).filter(L=>{if(!b)return!0;const Y=b.toLowerCase();return(L[R]?.toLowerCase()||"").includes(Y)});return V!==null&&j.sort((L,Y)=>{const B=L[V.key]||"",Q=Y[V.key]||"";return B<Q?V.direction==="asc"?-1:1:B>Q?V.direction==="asc"?1:-1:0}),j},[d,b,R,X,V]),le=({columnKey:j,title:L})=>e.jsx("th",{onClick:()=>Ne(j),className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100 transition-colors",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:L}),V?.key===j&&e.jsx(ts,{className:"w-4 h-4 ml-2"})]})});return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsx("div",{id:"recaptcha-container"}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"회원 관리"}),e.jsx("p",{className:"text-gray-600",children:"사용자 추가, 수정, 삭제"})]}),e.jsxs("button",{onClick:K,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(Xe,{className:"w-5 h-5"}),e.jsx("span",{children:"새 사용자 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:R,onChange:j=>Z(j.target.value),className:"border rounded-lg px-2 py-1 text-sm",children:[e.jsx("option",{value:"name",children:"이름"}),e.jsx("option",{value:"email",children:"이메일"}),e.jsx("option",{value:"phone",children:"전화번호"})]}),e.jsx("input",{value:b,onChange:j=>S(j.target.value),placeholder:"검색어 입력",className:"flex-1 outline-none"})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:h?e.jsxs("div",{className:"flex items-center justify-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"사용자 정보를 불러오는 중..."})]}):pe.length===0?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-500 text-lg mb-2",children:"등록된 사용자가 없습니다."}),e.jsx("p",{className:"text-gray-400 text-sm",children:"새 사용자 추가 버튼을 클릭해서 사용자를 추가해보세요."})]})}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx(le,{columnKey:"name",title:"이름"}),e.jsx(le,{columnKey:"email",title:"이메일"}),e.jsx(le,{columnKey:"phone",title:"전화번호"}),e.jsx(le,{columnKey:"role",title:"권한"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:pe.map(j=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:j.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j.phone}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${j.role==="admin"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:j.role})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>ge(j),className:"p-2 text-gray-500 hover:text-green-600 rounded-lg transition-all hover:scale-110",children:e.jsx(es,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(j),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ce(j),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(We,{className:"w-4 h-4"})})]})]},j.id))})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:p?"사용자 정보 수정":"새 사용자 추가"}),e.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이름"}),e.jsx("input",{type:"text",name:"name",value:g.name,onChange:ee,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이메일"}),e.jsx("input",{type:"email",name:"email",value:g.email,onChange:ee,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"전화번호"}),e.jsx("input",{type:"tel",name:"phone",value:g.phone,onChange:ee,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["비밀번호 ",p&&"(변경시에만 입력)"]}),e.jsx("input",{type:"password",name:"password",value:g.password,onChange:ee,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"권한"}),e.jsxs("select",{name:"role",value:g.role,onChange:ee,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:G,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:"저장"})]})]})]})}),f&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 space-y-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:["계정 설정: ",l.name]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"휴대폰 인증"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"tel",value:C,onChange:j=>_(st(j.target.value)),placeholder:"휴대폰 번호",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:De,disabled:w,className:"py-3 px-4 bg-gray-200 rounded-xl hover:bg-gray-300 font-medium transition-colors disabled:opacity-50",children:w?"전송중...":"인증코드 받기"})]}),P&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:I,onChange:j=>M(j.target.value),placeholder:"인증 코드 6자리",className:"flex-1 p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:Ce,disabled:w,className:"py-3 px-4 bg-green-500 text-white rounded-xl hover:bg-green-600 font-medium transition-colors disabled:opacity-50",children:w?"확인중...":"인증하기"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:"이메일 주소 변경"}),e.jsx("input",{type:"email",value:k,onChange:j=>T(j.target.value),placeholder:"새 이메일 주소",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("input",{type:"password",value:x,onChange:j=>E(j.target.value),placeholder:"현재 비밀번호",className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("button",{onClick:ke,disabled:w,className:"w-full py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors disabled:opacity-50",children:w?"변경중...":"이메일 변경"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"button",onClick:U,className:"py-3 px-6 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"닫기"})})]})}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"사용자 삭제 확인"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["정말로 ",e.jsx("strong",{className:"text-red-600",children:u.name})," 사용자를 삭제하시겠습니까?"]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>y(null),className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{onClick:ve,className:"flex-1 py-3 px-4 bg-red-500 text-white rounded-xl hover:bg-red-600 font-medium transition-colors",children:"삭제"})]})]})})]})},Ls=()=>{const{facilities:t}=Ae(),[s,c]=n.useState(!1),[h,d]=n.useState(null),m={name:"",type:"gym",capacity:1,bufferMinutes:0,bookingPolicy:{allowOverlap:!1,maxConcurrent:1,timeSlotMinutes:60}},[i,f]=n.useState(m),D=()=>{d(null),f(m),c(!0)},p=r=>{d(r),f({...r,bookingPolicy:r.bookingPolicy||{allowOverlap:!1,maxConcurrent:1,timeSlotMinutes:60}}),c(!0)},v=()=>{c(!1),d(null)},u=r=>{const{name:o,value:g,type:N}=r.target,k=N==="number";f(T=>({...T,[o]:k?Number(g):g}))},y=async r=>{if(r.preventDefault(),!i.name||i.capacity<=0){alert("시설 이름과 수용 인원을 확인해주세요.");return}try{if(h){const o=ae(W,"facilities",h.id);await zt(o,i),alert("시설 정보가 성공적으로 수정되었습니다.")}else await Ht(ye(W,"facilities"),i),alert("새 시설이 추가되었습니다.");v()}catch(o){console.error("Error saving facility: ",o),alert("처리 중 오류가 발생했습니다.")}},l=async r=>{if(window.confirm("정말로 이 시설을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{await Bt(ae(W,"facilities",r)),alert("시설이 삭제되었습니다.")}catch(o){console.error("Error deleting facility: ",o),alert("삭제 중 오류가 발생했습니다.")}};return e.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"시설 관리"}),e.jsx("p",{className:"text-gray-600",children:"체육관 시설을 추가, 수정, 삭제합니다."})]}),e.jsxs("button",{onClick:D,className:"flex items-center space-x-2 bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all duration-300 font-medium shadow hover:shadow-lg hover:-translate-y-0.5",children:[e.jsx(Xe,{className:"w-5 h-5"}),e.jsx("span",{children:"새 시설 추가"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"이름"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"종류"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수용 인원"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"버퍼(분)"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"중복 정책"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"작업"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(r=>{const o=r.bookingPolicy,g=o?.allowOverlap?`🔄 중복허용 (최대${o.maxConcurrent||1}팀)`:"🚫 단독사용";return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:r.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.type}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.capacity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.bufferMinutes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o?.allowOverlap?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:g})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>p(r),className:"p-2 text-gray-500 hover:text-blue-600 rounded-lg transition-all hover:scale-110",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>l(r.id),className:"p-2 text-gray-500 hover:text-red-600 rounded-lg transition-all hover:scale-110",children:e.jsx(We,{className:"w-4 h-4"})})]})]},r.id)})})]})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:h?"시설 정보 수정":"새 시설 추가"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시설 이름"}),e.jsx("input",{type:"text",name:"name",value:i.name,onChange:u,required:!0,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"수용 인원"}),e.jsx("input",{type:"number",name:"capacity",value:i.capacity,onChange:u,required:!0,min:1,className:"w-full p-3 border border-gray-200 rounded-xl"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"버퍼 시간 (분)"}),e.jsx("input",{type:"number",name:"bufferMinutes",value:i.bufferMinutes,onChange:u,required:!0,min:0,className:"w-full p-3 border border-gray-200 rounded-xl"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"시설 종류"}),e.jsxs("select",{name:"type",value:i.type,onChange:u,className:"w-full p-3 border border-gray-200 rounded-xl bg-white",children:[e.jsx("option",{value:"gym",children:"체육관"}),e.jsx("option",{value:"court",children:"코트"}),e.jsx("option",{value:"field",children:"운동장"}),e.jsx("option",{value:"pool",children:"수영장"}),e.jsx("option",{value:"room",children:"다목적실"})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-3",children:"중복 사용 설정"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:i.bookingPolicy?.allowOverlap||!1,onChange:r=>f(o=>({...o,bookingPolicy:{...o.bookingPolicy,allowOverlap:r.target.checked,maxConcurrent:r.target.checked?o.bookingPolicy?.maxConcurrent||2:1}})),className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"중복 사용 허용 (같은 시간에 여러 팀 사용 가능)"})]}),i.bookingPolicy?.allowOverlap&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"최대 동시 사용 팀"}),e.jsx("input",{type:"number",min:"2",max:"10",value:i.bookingPolicy?.maxConcurrent||2,onChange:r=>f(o=>({...o,bookingPolicy:{...o.bookingPolicy,maxConcurrent:parseInt(r.target.value)}})),className:"w-full p-3 border border-gray-200 rounded-xl"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"같은 시간에 이용할 수 있는 최대 팀 수"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:v,className:"flex-1 py-3 px-4 border rounded-xl hover:bg-gray-50 font-medium transition-colors",children:"취소"}),e.jsx("button",{type:"submit",className:"flex-1 py-3 px-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-colors",children:h?"수정하기":"추가하기"})]})]})]})})]})},Fs={success:e.jsx(ls,{className:"w-6 h-6 text-green-500"}),error:e.jsx(rs,{className:"w-6 h-6 text-red-500"}),warning:e.jsx(as,{className:"w-6 h-6 text-yellow-500"}),info:e.jsx(ss,{className:"w-6 h-6 text-blue-500"})},Rs=({notification:t,onRemove:s})=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden mb-4 animate-on-load",style:{animationName:"fadeInRight"},children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:Fs[t.type]}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.message})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{onClick:()=>s(t.id),className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(dt,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})}),Vs=()=>{const{notifications:t,removeNotification:s}=_e();return e.jsx("div",{className:"fixed inset-0 flex items-end justify-end px-4 py-6 pointer-events-none sm:p-6 z-50",children:e.jsx("div",{className:"w-full max-w-sm",children:t.map(c=>e.jsx(Rs,{notification:c,onRemove:s},c.id))})})};function Bs(){const{user:t,login:s,logout:c,signup:h,adminLogin:d,googleLogin:m,loading:i}=os(),{loading:f,syncing:D,bookings:p,setBookings:v,programs:u,setPrograms:y,applications:l,setApplications:r,users:o,setUsers:g,facilities:N}=Ae(),[k,T]=n.useState("dashboard");n.useEffect(()=>{t&&!f&&T("dashboard")},[t,f]);const x=async(P,F)=>{try{if(!P.trim()||!F.trim())throw new Error("이메일과 비밀번호를 입력해주세요.");return await s(P,F),[!0,null]}catch(w){return console.error("Login failed:",w),[!1,je(w)]}},E=async(P,F)=>{try{if(!P.trim()||!F.trim())throw new Error("이메일과 비밀번호를 입력해주세요.");return await d(P,F),[!0,null]}catch(w){return console.error("Admin login failed:",w),[!1,je(w)]}},C=async P=>{try{const{name:F,email:w,password:z}=P;if(!F?.trim())throw new Error("이름을 입력해주세요.");if(!w?.trim())throw new Error("이메일을 입력해주세요.");if(!z?.trim())throw new Error("비밀번호를 입력해주세요.");return await h(P),[!0,"회원가입이 완료되었습니다. 이메일 인증을 확인해주세요."]}catch(F){return console.error("Signup failed:",F),[!1,je(F)]}},_=async()=>{try{return await m(),[!0,null]}catch(P){return console.error("Google login failed:",P),[!1,je(P)]}},I=async()=>{await c(),T("dashboard")},M=()=>{if(!t)return null;try{switch(k){case"dashboard":return e.jsx(nt,{currentUser:t,bookings:p,applications:l,programs:u,setActiveTab:T,syncing:D});case"booking":return e.jsx(ks,{currentUser:t,bookings:p,setBookings:v,syncing:D});case"program":return e.jsx(Ps,{currentUser:t,programs:u,setPrograms:y,applications:l,setApplications:r});case"admin":return e.jsx(Is,{currentUser:t,bookings:p,setBookings:v,applications:l,setApplications:r,programs:u,setPrograms:y,users:o,facilities:N});case"userManagement":return e.jsx(Os,{users:o,setUsers:g});case"facilities":return e.jsx(Ls,{});default:return e.jsx(nt,{currentUser:t,bookings:p,applications:l,programs:u,setActiveTab:T,syncing:D})}}catch(P){return console.error("Component rendering error:",P),e.jsx("div",{className:"min-h-96 bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"화면을 불러오는 중 오류가 발생했습니다"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"다른 메뉴를 선택하거나 페이지를 새로고침해주세요."}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>T("dashboard"),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"대시보드로 이동"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"새로고침"})]})]})})}};return f||i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"로딩 중..."})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Vs,{}),t?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(us,{currentUser:t,activeTab:k,setActiveTab:T,onLogout:I}),e.jsx("main",{children:M()})]}):e.jsx(xs,{onLogin:x,onSignup:C,onAdminLogin:E,onGoogleLogin:_})]})}const ot=document.getElementById("root");ot?yt.createRoot(ot).render(e.jsx(jt.StrictMode,{children:e.jsx(cs,{children:e.jsx(Bs,{})})})):console.error("Failed to find the root element");
