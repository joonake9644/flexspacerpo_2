const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginForm-DDg2tCGo.js","assets/react-C1G-q6RG.js","assets/firebase-C3mMOVup.js","assets/icons-CN_tAE-L.js","assets/Navigation-D7KvDKWA.js","assets/Dashboard-CcxbvuR3.js","assets/BookingSection-DmqnahXv.js","assets/firebase-functions-NK7uq-RQ.js","assets/ProgramSection-BI9xunex.js","assets/AdminSection-Dm7C6BGy.js","assets/UserManagement-OoMuZG1p.js","assets/FacilityManagement-CXq_wnVw.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,R as H,a as K}from"./react-C1G-q6RG.js";import{g as I,i as X,a as G,b as Q,c as Z,d as J,e as Y,f as ee,o as te,s as O,h as S,j as R,k,l as se,m as re,n as C,p as j,q as N,r as P,t as L}from"./firebase-C3mMOVup.js";import{X as ne,I as oe,T as ae,C as ie,a as ce}from"./icons-CN_tAE-L.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))g(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&g(r)}).observe(document,{childList:!0,subtree:!0});function m(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function g(i){if(i.ep)return;i.ep=!0;const c=m(i);fetch(i.href,c)}})();const le="modulepreload",ue=function(s){return"/"+s},D={},E=function(d,m,g){let i=Promise.resolve();if(m&&m.length>0){let f=function(l){return Promise.all(l.map(a=>Promise.resolve(a).then(n=>({status:"fulfilled",value:n}),n=>({status:"rejected",reason:n}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),t=r?.nonce||r?.getAttribute("nonce");i=f(m.map(l=>{if(l=ue(l),l in D)return;D[l]=!0;const a=l.endsWith(".css"),n=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${n}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":le,a||(u.as="script"),u.crossOrigin="",u.href=l,t&&u.setAttribute("nonce",t),document.head.appendChild(u),a)return new Promise((p,b)=>{u.addEventListener("load",p),u.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${l}`)))})}))}function c(r){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=r,window.dispatchEvent(t),!t.defaultPrevented)throw r}return i.then(r=>{for(const t of r||[])t.status==="rejected"&&c(t.reason);return d().catch(c)})},A={},de={apiKey:"AIzaSyBvlPy3BOyrRCokGAHkzuX6IoVZNjWTU-0",authDomain:"flexspaceprowin.firebaseapp.com",projectId:"flexspaceprowin",storageBucket:"flexspaceprowin.firebasestorage.app",messagingSenderId:"545144229496",appId:"1:545144229496:web:a833b961cf4b8a7ce9678d",measurementId:"G-D81Q76VKZQ"},T=I().length?I()[0]:X(de),_=G(T),y=Q(T),me=A?.VITE_USE_EMULATOR==="true";if(me){const s=A?.VITE_EMULATOR_HOST||"127.0.0.1",d=Number(A?.VITE_EMULATOR_AUTH_PORT||9099),m=Number(A?.VITE_EMULATOR_FIRESTORE_PORT||8080);try{Z(_,`http://${s}:${d}`,{disableWarnings:!0})}catch{}try{J(y,s,m)}catch{}}Y().then(s=>s?ee(T):null).catch(()=>null);const fe=()=>{const[s,d]=o.useState(null);o.useEffect(()=>{const r=te(_,async t=>{if(!t){d(null);return}try{const f=S(y,"users",t.uid),l=await R(f),a=l.exists()?l.data():{},n=a.role||"user",u=a.name||t.displayName||(t.email?.split("@")[0]??"user"),p=a.phone;d({id:t.uid,name:u,email:t.email??"",phone:p,role:n})}catch{d({id:t.uid,name:t.email?.split("@")[0]??"user",email:t.email??"",role:"user"})}});return()=>r()},[]);const m=o.useCallback(async(r,t)=>(await O(_,r,t),!0),[]),g=o.useCallback(async(r,t)=>{const f=await O(_,r,t),l=S(y,"users",f.user.uid),a=await R(l);if((a.exists()?a.data().role:void 0)!=="admin")throw await k(_),new Error("관리자 권한이 없습니다.");return!0},[]),i=o.useCallback(async r=>{const{name:t,email:f,phone:l,password:a}=r;if(!f||!a)throw new Error("이메일과 비밀번호가 필요합니다.");const n=await se(_,f,a),u=S(y,"users",n.user.uid);return await re(u,{name:t||(f.split("@")[0]??"user"),email:f,phone:l||null,role:"user",isActive:!0,createdAt:C(),updatedAt:C()},{merge:!0}),!0},[]),c=o.useCallback(async()=>{await k(_),d(null)},[]);return o.useMemo(()=>({user:s,login:m,logout:c,signup:i,adminLogin:g}),[s,m,c,i,g])},pe=()=>{const[s,d]=o.useState(!0),[m,g]=o.useState([]),[i,c]=o.useState([]),[r,t]=o.useState([]),[f,l]=o.useState([]);return o.useEffect(()=>{const a=[];return a.push(j(N(y,"users"),n=>{const u=n.docs.map(p=>({id:p.id,...p.data()}));l(u)},n=>{console.error("Error fetching users:",n)})),a.push(j(P(N(y,"bookings"),L("createdAt","desc")),n=>{const u=n.docs.map(p=>({id:p.id,...p.data()}));g(u)},n=>{console.error("Error fetching bookings:",n)})),a.push(j(P(N(y,"programs"),L("startDate","asc")),n=>{const u=n.docs.map(p=>({id:p.id,...p.data()}));c(u)},n=>{console.error("Error fetching programs:",n)})),a.push(j(P(N(y,"applications"),L("appliedAt","desc")),n=>{const u=n.docs.map(p=>({id:p.id,...p.data()}));t(u)},n=>{console.error("Error fetching applications:",n)})),d(!1),()=>a.forEach(n=>n())},[]),o.useMemo(()=>({loading:s,bookings:m,setBookings:g,programs:i,setPrograms:c,applications:r,setApplications:t,users:f,setUsers:l}),[s,m,i,r,f])},z=o.createContext(void 0),ge=({children:s})=>{const[d,m]=o.useState([]),g=o.useCallback(c=>{m(r=>r.filter(t=>t.id!==c))},[]),i=o.useCallback((c,r="info",t=5e3)=>{const f=`notification-${Date.now()}-${Math.random()}`,l={id:f,message:c,type:r,duration:t};m(a=>[...a,l]),t>0&&setTimeout(()=>{g(f)},t)},[g]);return e.jsx(z.Provider,{value:{notifications:d,showNotification:i,removeNotification:g},children:s})},he=()=>{const s=o.useContext(z);if(s===void 0)throw new Error("useNotification must be used within a NotificationProvider");return s},xe={success:e.jsx(ce,{className:"w-6 h-6 text-green-500"}),error:e.jsx(ie,{className:"w-6 h-6 text-red-500"}),warning:e.jsx(ae,{className:"w-6 h-6 text-yellow-500"}),info:e.jsx(oe,{className:"w-6 h-6 text-blue-500"})},ye=({notification:s,onRemove:d})=>e.jsx("div",{className:"bg-white rounded-xl shadow-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden mb-4 animate-on-load",style:{animationName:"fadeInRight"},children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:xe[s.type]}),e.jsx("div",{className:"ml-3 w-0 flex-1 pt-0.5",children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.message})}),e.jsx("div",{className:"ml-4 flex-shrink-0 flex",children:e.jsxs("button",{onClick:()=>d(s.id),className:"bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(ne,{className:"h-5 w-5","aria-hidden":"true"})]})})]})})}),Ee=()=>{const{notifications:s,removeNotification:d}=he();return e.jsx("div",{className:"fixed inset-0 flex items-end justify-end px-4 py-6 pointer-events-none sm:p-6 z-50",children:e.jsx("div",{className:"w-full max-w-sm",children:s.map(m=>e.jsx(ye,{notification:m,onRemove:d},m.id))})})},_e=o.lazy(()=>E(()=>import("./LoginForm-DDg2tCGo.js"),__vite__mapDeps([0,1,2,3]))),ve=o.lazy(()=>E(()=>import("./Navigation-D7KvDKWA.js"),__vite__mapDeps([4,1,2,3]))),M=o.lazy(()=>E(()=>import("./Dashboard-CcxbvuR3.js"),__vite__mapDeps([5,1,3,2]))),we=o.lazy(()=>E(()=>import("./BookingSection-DmqnahXv.js"),__vite__mapDeps([6,1,2,7,3]))),be=o.lazy(()=>E(()=>import("./ProgramSection-BI9xunex.js"),__vite__mapDeps([8,1,2,7,3]))),je=o.lazy(()=>E(()=>import("./AdminSection-Dm7C6BGy.js"),__vite__mapDeps([9,1,2,7,3]))),Ne=o.lazy(()=>E(()=>import("./UserManagement-OoMuZG1p.js"),__vite__mapDeps([10,1,3]))),Ae=o.lazy(()=>E(()=>import("./FacilityManagement-CXq_wnVw.js"),__vite__mapDeps([11,1,2,3])));function Se(){const{user:s,login:d,logout:m,signup:g,adminLogin:i}=fe(),{loading:c,bookings:r,setBookings:t,programs:f,setPrograms:l,applications:a,setApplications:n,users:u,setUsers:p}=pe(),[b,v]=o.useState("dashboard");o.useEffect(()=>{s&&!c&&v("dashboard")},[s,c]);const B=async(w,x)=>{try{return await d(w,x),[!0,null]}catch(h){return console.error("Login failed:",h),[!1,h instanceof Error?h.message:String(h)]}},F=async(w,x)=>{try{return await i(w,x),[!0,null]}catch(h){return console.error("Admin login failed:",h),[!1,h instanceof Error?h.message:String(h)]}},U=async w=>{try{return await g(w),[!0,null]}catch(x){return console.error("Signup failed:",x),[!1,x instanceof Error?x.message:String(x)]}},$=async()=>{await m(),v("dashboard")},q=()=>{if(!s)return null;switch(b){case"dashboard":return e.jsx(M,{currentUser:s,bookings:r,applications:a,programs:f,setActiveTab:v});case"booking":return e.jsx(we,{currentUser:s,bookings:r,setBookings:t});case"program":return e.jsx(be,{currentUser:s,programs:f,setPrograms:l,applications:a,setApplications:n});case"admin":return e.jsx(je,{bookings:r,setBookings:t,applications:a,setApplications:n,programs:f,setPrograms:l,users:u});case"userManagement":return e.jsx(Ne,{users:u,setUsers:p});case"facilities":return e.jsx(Ae,{});default:return e.jsx(M,{currentUser:s,bookings:r,applications:a,programs:f,setActiveTab:v})}};return c?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}),children:s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(ve,{currentUser:s,activeTab:b,setActiveTab:v,onLogout:$}),e.jsx("main",{children:q()})]}):e.jsx(_e,{onLogin:B,onSignup:U,onAdminLogin:F})})]})}const V=document.getElementById("root");V?H.createRoot(V).render(e.jsx(K.StrictMode,{children:e.jsx(ge,{children:e.jsx(Se,{})})})):console.error("Failed to find the root element");export{E as _,_ as a,pe as b,T as c,y as d,he as u};
